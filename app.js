/*! For license information please see app.js.LICENSE.txt */
var __webpack_modules__={5:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.elements=void 0;const n=r(14);t.elements={440786851:{name:"ebml",container:{17030:{name:"ebmlVersion",value:n.DataType.uint},17143:{name:"ebmlReadVersion",value:n.DataType.uint},17138:{name:"ebmlMaxIDWidth",value:n.DataType.uint},17139:{name:"ebmlMaxSizeWidth",value:n.DataType.uint},17026:{name:"docType",value:n.DataType.string},17031:{name:"docTypeVersion",value:n.DataType.uint},17029:{name:"docTypeReadVersion",value:n.DataType.uint}}},408125543:{name:"segment",container:{290298740:{name:"seekHead",container:{19899:{name:"seek",container:{21419:{name:"seekId",value:n.DataType.binary},21420:{name:"seekPosition",value:n.DataType.uint}}}}},357149030:{name:"info",container:{29604:{name:"uid",value:n.DataType.uid},29572:{name:"filename",value:n.DataType.string},3979555:{name:"prevUID",value:n.DataType.uid},3965867:{name:"prevFilename",value:n.DataType.string},4110627:{name:"nextUID",value:n.DataType.uid},4096955:{name:"nextFilename",value:n.DataType.string},2807729:{name:"timecodeScale",value:n.DataType.uint},17545:{name:"duration",value:n.DataType.float},17505:{name:"dateUTC",value:n.DataType.uint},31657:{name:"title",value:n.DataType.string},19840:{name:"muxingApp",value:n.DataType.string},22337:{name:"writingApp",value:n.DataType.string}}},524531317:{name:"cluster",multiple:!0,container:{231:{name:"timecode",value:n.DataType.uid},163:{name:"unknown",value:n.DataType.binary},167:{name:"position",value:n.DataType.uid},171:{name:"prevSize",value:n.DataType.uid}}},374648427:{name:"tracks",container:{174:{name:"entries",multiple:!0,container:{215:{name:"trackNumber",value:n.DataType.uint},29637:{name:"uid",value:n.DataType.uid},131:{name:"trackType",value:n.DataType.uint},185:{name:"flagEnabled",value:n.DataType.bool},136:{name:"flagDefault",value:n.DataType.bool},21930:{name:"flagForced",value:n.DataType.bool},156:{name:"flagLacing",value:n.DataType.bool},28135:{name:"minCache",value:n.DataType.uint},28136:{name:"maxCache",value:n.DataType.uint},2352003:{name:"defaultDuration",value:n.DataType.uint},2306383:{name:"timecodeScale",value:n.DataType.float},21358:{name:"name",value:n.DataType.string},2274716:{name:"language",value:n.DataType.string},134:{name:"codecID",value:n.DataType.string},25506:{name:"codecPrivate",value:n.DataType.binary},2459272:{name:"codecName",value:n.DataType.string},3839639:{name:"codecSettings",value:n.DataType.string},3883072:{name:"codecInfoUrl",value:n.DataType.string},2536e3:{name:"codecDownloadUrl",value:n.DataType.string},170:{name:"codecDecodeAll",value:n.DataType.bool},28587:{name:"trackOverlay",value:n.DataType.uint},224:{name:"video",container:{154:{name:"flagInterlaced",value:n.DataType.bool},21432:{name:"stereoMode",value:n.DataType.uint},176:{name:"pixelWidth",value:n.DataType.uint},186:{name:"pixelHeight",value:n.DataType.uint},21680:{name:"displayWidth",value:n.DataType.uint},21690:{name:"displayHeight",value:n.DataType.uint},21683:{name:"aspectRatioType",value:n.DataType.uint},3061028:{name:"colourSpace",value:n.DataType.uint},3126563:{name:"gammaValue",value:n.DataType.float}}},225:{name:"audio",container:{181:{name:"samplingFrequency",value:n.DataType.float},30901:{name:"outputSamplingFrequency",value:n.DataType.float},159:{name:"channels",value:n.DataType.uint},148:{name:"channels",value:n.DataType.uint},32123:{name:"channelPositions",value:n.DataType.binary},25188:{name:"bitDepth",value:n.DataType.uint}}},28032:{name:"contentEncodings",container:{25152:{name:"contentEncoding",container:{20529:{name:"order",value:n.DataType.uint},20530:{name:"scope",value:n.DataType.bool},20531:{name:"type",value:n.DataType.uint},20532:{name:"contentEncoding",container:{16980:{name:"contentCompAlgo",value:n.DataType.uint},16981:{name:"contentCompSettings",value:n.DataType.binary}}},20533:{name:"contentEncoding",container:{18401:{name:"contentEncAlgo",value:n.DataType.uint},18402:{name:"contentEncKeyID",value:n.DataType.binary},18403:{name:"contentSignature ",value:n.DataType.binary},18404:{name:"ContentSigKeyID  ",value:n.DataType.binary},18405:{name:"contentSigAlgo ",value:n.DataType.uint},18406:{name:"contentSigHashAlgo ",value:n.DataType.uint}}},25188:{name:"bitDepth",value:n.DataType.uint}}}}}}}}},475249515:{name:"cues",container:{187:{name:"cuePoint",container:{179:{name:"cueTime",value:n.DataType.uid},183:{name:"positions",container:{247:{name:"track",value:n.DataType.uint},241:{name:"clusterPosition",value:n.DataType.uint},21368:{name:"blockNumber",value:n.DataType.uint},234:{name:"codecState",value:n.DataType.uint},219:{name:"reference",container:{150:{name:"time",value:n.DataType.uint},151:{name:"cluster",value:n.DataType.uint},21343:{name:"number",value:n.DataType.uint},235:{name:"codecState",value:n.DataType.uint}}},240:{name:"relativePosition",value:n.DataType.uint}}}}}}},423732329:{name:"attachments",container:{24999:{name:"attachedFiles",multiple:!0,container:{18046:{name:"description",value:n.DataType.string},18030:{name:"name",value:n.DataType.string},18016:{name:"mimeType",value:n.DataType.string},18012:{name:"data",value:n.DataType.binary},18094:{name:"uid",value:n.DataType.uid}}}}},272869232:{name:"chapters",container:{17849:{name:"editionEntry",container:{182:{name:"chapterAtom",container:{29636:{name:"uid",value:n.DataType.uid},145:{name:"timeStart",value:n.DataType.uint},146:{name:"timeEnd",value:n.DataType.uid},152:{name:"hidden",value:n.DataType.bool},17816:{name:"enabled",value:n.DataType.uid},143:{name:"track",container:{137:{name:"trackNumber",value:n.DataType.uid},128:{name:"display",container:{133:{name:"string",value:n.DataType.string},17276:{name:"language ",value:n.DataType.string},17278:{name:"country ",value:n.DataType.string}}}}}}}}}}},307544935:{name:"tags",container:{29555:{name:"tag",multiple:!0,container:{25536:{name:"target",container:{25541:{name:"tagTrackUID",value:n.DataType.uid},25540:{name:"tagChapterUID",value:n.DataType.uint},25542:{name:"tagAttachmentUID",value:n.DataType.uid},25546:{name:"targetType",value:n.DataType.string},26826:{name:"targetTypeValue",value:n.DataType.uint},25545:{name:"tagEditionUID",value:n.DataType.uid}}},26568:{name:"simpleTags",multiple:!0,container:{17827:{name:"name",value:n.DataType.string},17543:{name:"string",value:n.DataType.string},17541:{name:"binary",value:n.DataType.binary},17530:{name:"language",value:n.DataType.string},17531:{name:"languageIETF",value:n.DataType.string},17540:{name:"default",value:n.DataType.bool}}}}}}}}}}},14:(e,t)=>{var r,n,a;Object.defineProperty(t,"__esModule",{value:!0}),t.TrackType=t.TargetType=t.DataType=void 0,(a=t.DataType||(t.DataType={}))[a.string=0]="string",a[a.uint=1]="uint",a[a.uid=2]="uid",a[a.bool=3]="bool",a[a.binary=4]="binary",a[a.float=5]="float",(n=t.TargetType||(t.TargetType={}))[n.shot=10]="shot",n[n.scene=20]="scene",n[n.track=30]="track",n[n.part=40]="part",n[n.album=50]="album",n[n.edition=60]="edition",n[n.collection=70]="collection",(r=t.TrackType||(t.TrackType={}))[r.video=1]="video",r[r.audio=2]="audio",r[r.complex=3]="complex",r[r.logo=4]="logo",r[r.subtitle=17]="subtitle",r[r.button=18]="button",r[r.control=32]="control"},134:e=>{e.exports={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]}},251:(e,t)=>{t.read=function(e,t,r,n,a){var i,o,s=8*a-n-1,l=(1<<s)-1,c=l>>1,u=-7,d=r?a-1:0,p=r?-1:1,f=e[t+d];for(d+=p,i=f&(1<<-u)-1,f>>=-u,u+=s;u>0;i=256*i+e[t+d],d+=p,u-=8);for(o=i&(1<<-u)-1,i>>=-u,u+=n;u>0;o=256*o+e[t+d],d+=p,u-=8);if(0===i)i=1-c;else{if(i===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),i-=c}return(f?-1:1)*o*Math.pow(2,i-n)},t.write=function(e,t,r,n,a,i){var o,s,l,c=8*i-a-1,u=(1<<c)-1,d=u>>1,p=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:i-1,h=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+d>=1?p/l:p*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=u?(s=0,o=u):o+d>=1?(s=(t*l-1)*Math.pow(2,a),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,a),o=0));a>=8;e[r+f]=255&s,f+=h,s/=256,a-=8);for(o=o<<a|s,c+=a;c>0;e[r+f]=255&o,f+=h,o/=256,c-=8);e[r+f-h]|=128*m}},277:(e,t,r)=>{const{ArrayIsArray:n,ArrayPrototypeIncludes:a,ArrayPrototypeJoin:i,ArrayPrototypeMap:o,NumberIsInteger:s,NumberIsNaN:l,NumberMAX_SAFE_INTEGER:c,NumberMIN_SAFE_INTEGER:u,NumberParseInt:d,ObjectPrototypeHasOwnProperty:p,RegExpPrototypeExec:f,String:h,StringPrototypeToUpperCase:m,StringPrototypeTrim:g}=r(4134),{hideStackFrames:y,codes:{ERR_SOCKET_BAD_PORT:b,ERR_INVALID_ARG_TYPE:w,ERR_INVALID_ARG_VALUE:T,ERR_OUT_OF_RANGE:v,ERR_UNKNOWN_SIGNAL:_}}=r(6371),{normalizeEncoding:E}=r(7760),{isAsyncFunction:S,isArrayBufferView:I}=r(7760).types,k={},A=/^[0-7]+$/,C=y((e,t,r=u,n=c)=>{if("number"!=typeof e)throw new w(t,"number",e);if(!s(e))throw new v(t,"an integer",e);if(e<r||e>n)throw new v(t,`>= ${r} && <= ${n}`,e)}),x=y((e,t,r=-2147483648,n=2147483647)=>{if("number"!=typeof e)throw new w(t,"number",e);if(!s(e))throw new v(t,"an integer",e);if(e<r||e>n)throw new v(t,`>= ${r} && <= ${n}`,e)}),B=y((e,t,r=!1)=>{if("number"!=typeof e)throw new w(t,"number",e);if(!s(e))throw new v(t,"an integer",e);const n=r?1:0,a=4294967295;if(e<n||e>a)throw new v(t,`>= ${n} && <= ${a}`,e)});function D(e,t){if("string"!=typeof e)throw new w(t,"string",e)}const P=y((e,t,r)=>{if(!a(r,e)){const n=i(o(r,e=>"string"==typeof e?`'${e}'`:h(e)),", ");throw new T(t,e,"must be one of: "+n)}});function R(e,t){if("boolean"!=typeof e)throw new w(t,"boolean",e)}function M(e,t,r){return null!=e&&p(e,t)?e[t]:r}const F=y((e,t,r=null)=>{const a=M(r,"allowArray",!1),i=M(r,"allowFunction",!1);if(!M(r,"nullable",!1)&&null===e||!a&&n(e)||"object"!=typeof e&&(!i||"function"!=typeof e))throw new w(t,"Object",e)}),L=y((e,t)=>{if(null!=e&&"object"!=typeof e&&"function"!=typeof e)throw new w(t,"a dictionary",e)}),O=y((e,t,r=0)=>{if(!n(e))throw new w(t,"Array",e);if(e.length<r)throw new T(t,e,`must be longer than ${r}`)}),N=y((e,t="buffer")=>{if(!I(e))throw new w(t,["Buffer","TypedArray","DataView"],e)}),U=y((e,t)=>{if(void 0!==e&&(null===e||"object"!=typeof e||!("aborted"in e)))throw new w(t,"AbortSignal",e)}),z=y((e,t)=>{if("function"!=typeof e)throw new w(t,"Function",e)}),j=y((e,t)=>{if("function"!=typeof e||S(e))throw new w(t,"Function",e)}),W=y((e,t)=>{if(void 0!==e)throw new w(t,"undefined",e)}),$=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function H(e,t){if(void 0===e||!f($,e))throw new T(t,e,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}e.exports={isInt32:function(e){return e===(0|e)},isUint32:function(e){return e===e>>>0},parseFileMode:function(e,t,r){if(void 0===e&&(e=r),"string"==typeof e){if(null===f(A,e))throw new T(t,e,"must be a 32-bit unsigned integer or an octal string");e=d(e,8)}return B(e,t),e},validateArray:O,validateStringArray:function(e,t){O(e,t);for(let r=0;r<e.length;r++)D(e[r],`${t}[${r}]`)},validateBooleanArray:function(e,t){O(e,t);for(let r=0;r<e.length;r++)R(e[r],`${t}[${r}]`)},validateAbortSignalArray:function(e,t){O(e,t);for(let r=0;r<e.length;r++){const n=e[r],a=`${t}[${r}]`;if(null==n)throw new w(a,"AbortSignal",n);U(n,a)}},validateBoolean:R,validateBuffer:N,validateDictionary:L,validateEncoding:function(e,t){const r=E(t),n=e.length;if("hex"===r&&n%2!=0)throw new T("encoding",t,`is invalid for data of length ${n}`)},validateFunction:z,validateInt32:x,validateInteger:C,validateNumber:function(e,t,r=void 0,n){if("number"!=typeof e)throw new w(t,"number",e);if(null!=r&&e<r||null!=n&&e>n||(null!=r||null!=n)&&l(e))throw new v(t,`${null!=r?`>= ${r}`:""}${null!=r&&null!=n?" && ":""}${null!=n?`<= ${n}`:""}`,e)},validateObject:F,validateOneOf:P,validatePlainFunction:j,validatePort:function(e,t="Port",r=!0){if("number"!=typeof e&&"string"!=typeof e||"string"==typeof e&&0===g(e).length||+e!==+e>>>0||e>65535||0===e&&!r)throw new b(t,e,r);return 0|e},validateSignalName:function(e,t="signal"){if(D(e,t),void 0===k[e]){if(void 0!==k[m(e)])throw new _(e+" (signals must use all capital letters)");throw new _(e)}},validateString:D,validateUint32:B,validateUndefined:W,validateUnion:function(e,t,r){if(!a(r,e))throw new w(t,`('${i(r,"|")}')`,e)},validateAbortSignal:U,validateLinkHeaderValue:function(e){if("string"==typeof e)return H(e,"hints"),e;if(n(e)){const t=e.length;let r="";if(0===t)return r;for(let n=0;n<t;n++){const a=e[n];H(a,"hints"),r+=a,n!==t-1&&(r+=", ")}return r}throw new T("hints",e,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}}},345:(e,t,r)=>{const{StringPrototypeSlice:n,SymbolIterator:a,TypedArrayPrototypeSet:i,Uint8Array:o}=r(4134),{Buffer:s}=r(8287),{inspect:l}=r(7760);e.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){const t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}unshift(e){const t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}shift(){if(0===this.length)return;const e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(0===this.length)return"";let t=this.head,r=""+t.data;for(;null!==(t=t.next);)r+=e+t.data;return r}concat(e){if(0===this.length)return s.alloc(0);const t=s.allocUnsafe(e>>>0);let r=this.head,n=0;for(;r;)i(t,r.data,n),n+=r.data.length,r=r.next;return t}consume(e,t){const r=this.head.data;if(e<r.length){const t=r.slice(0,e);return this.head.data=r.slice(e),t}return e===r.length?this.shift():t?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[a](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let t="",r=this.head,a=0;do{const i=r.data;if(!(e>i.length)){e===i.length?(t+=i,++a,r.next?this.head=r.next:this.head=this.tail=null):(t+=n(i,0,e),this.head=r,r.data=n(i,e));break}t+=i,e-=i.length,++a}while(null!==(r=r.next));return this.length-=a,t}_getBuffer(e){const t=s.allocUnsafe(e),r=e;let n=this.head,a=0;do{const s=n.data;if(!(e>s.length)){e===s.length?(i(t,s,r-e),++a,n.next?this.head=n.next:this.head=this.tail=null):(i(t,new o(s.buffer,s.byteOffset,e),r-e),this.head=n,n.data=s.slice(e));break}i(t,s,r-e),e-=s.length,++a}while(null!==(n=n.next));return this.length-=a,t}[Symbol.for("nodejs.util.inspect.custom")](e,t){return l(this,{...t,depth:0,customInspect:!1})}}},431:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.IdentificationHeader=t.CommonHeader=t.VorbisPictureToken=void 0;const a=r(1028),i=r(2298);class o{static fromBase64(e){return this.fromBuffer(n.from(e,"base64"))}static fromBuffer(e){return new o(e.length).get(e,0)}constructor(e){this.len=e}get(e,t){const r=i.AttachedPictureType[a.UINT32_BE.get(e,t)],o=a.UINT32_BE.get(e,t+=4),s=e.toString("utf-8",t+=4,t+o),l=a.UINT32_BE.get(e,t+=o),c=e.toString("utf-8",t+=4,t+l),u=a.UINT32_BE.get(e,t+=l),d=a.UINT32_BE.get(e,t+=4),p=a.UINT32_BE.get(e,t+=4),f=a.UINT32_BE.get(e,t+=4),h=a.UINT32_BE.get(e,t+=4);return{type:r,format:s,description:c,width:u,height:d,colour_depth:p,indexed_color:f,data:n.from(e.slice(t+=4,t+h))}}}t.VorbisPictureToken=o,t.CommonHeader={len:7,get:(e,t)=>({packetType:e.readUInt8(t),vorbis:new a.StringType(6,"ascii").get(e,t+1)})},t.IdentificationHeader={len:23,get:(e,t)=>{const r=new DataView(e.buffer,e.byteOffset);return{version:r.getUint32(t+0,!0),channelMode:r.getUint8(t+4),sampleRate:r.getUint32(t+5,!0),bitrateMax:r.getUint32(t+9,!0),bitrateNominal:r.getUint32(t+13,!0),bitrateMin:r.getUint32(t+17,!0)}}}},609:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RiffInfoTagMapper=t.riffInfoTagMap=void 0;const n=r(8872);t.riffInfoTagMap={IART:"artist",ICRD:"date",INAM:"title",TITL:"title",IPRD:"album",ITRK:"track",IPRT:"track",COMM:"comment",ICMT:"comment",ICNT:"releasecountry",GNRE:"genre",IWRI:"writer",RATE:"rating",YEAR:"year",ISFT:"encodedby",CODE:"encodedby",TURL:"website",IGNR:"genre",IENG:"engineer",ITCH:"technician",IMED:"media",IRPD:"album"};class a extends n.CommonTagMapper{constructor(){super(["exif"],t.riffInfoTagMap)}}t.RiffInfoTagMapper=a},668:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.VorbisDecoder=void 0;const a=r(1028);t.VorbisDecoder=class{constructor(e,t){this.data=e,this.offset=t}readInt32(){const e=a.UINT32_LE.get(this.data,this.offset);return this.offset+=4,e}readStringUtf8(){const e=this.readInt32(),t=n.from(this.data).toString("utf-8",this.offset,this.offset+e);return this.offset+=e,t}parseUserComment(){const e=this.offset,t=this.readStringUtf8(),r=t.indexOf("=");return{key:t.slice(0,r).toUpperCase(),value:t.slice(r+1),len:this.offset-e}}}},736:(e,t,r)=>{e.exports=function(e){function t(e){let r,a,i,o=null;function s(...e){if(!s.enabled)return;const n=s,a=Number(new Date),i=a-(r||a);n.diff=i,n.prev=r,n.curr=a,r=a,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,a)=>{if("%%"===r)return"%";o++;const i=t.formatters[a];if("function"==typeof i){const t=e[o];r=i.call(n,t),e.splice(o,1),o--}return r}),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=n,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(a!==t.namespaces&&(a=t.namespaces,i=t.enabled(e)),i),set:e=>{o=e}}),"function"==typeof t.init&&t.init(s),s}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function a(e,t){let r=0,n=0,a=-1,i=0;for(;r<e.length;)if(n<t.length&&(t[n]===e[r]||"*"===t[n]))"*"===t[n]?(a=n,i=r,n++):(r++,n++);else{if(-1===a)return!1;n=a+1,i++,r=i}for(;n<t.length&&"*"===t[n];)n++;return n===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const e of r)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const r of t.skips)if(a(e,r))return!1;for(const r of t.names)if(a(e,r))return!0;return!1},t.humanize=r(6585),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(r=>{t[r]=e[r]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},823:(e,t,r)=>{const n=globalThis.AbortController||r(5568).AbortController,{codes:{ERR_INVALID_ARG_VALUE:a,ERR_INVALID_ARG_TYPE:i,ERR_MISSING_ARGS:o,ERR_OUT_OF_RANGE:s},AbortError:l}=r(6371),{validateAbortSignal:c,validateInteger:u,validateObject:d}=r(277),p=r(4134).Symbol("kWeak"),f=r(4134).Symbol("kResistStopPropagation"),{finished:h}=r(6238),m=r(7830),{addAbortSignalNoValidate:g}=r(4147),{isWritable:y,isNodeStream:b}=r(6115),{deprecate:w}=r(7760),{ArrayPrototypePush:T,Boolean:v,MathFloor:_,Number:E,NumberIsNaN:S,Promise:I,PromiseReject:k,PromiseResolve:A,PromisePrototypeThen:C,Symbol:x}=r(4134),B=x("kEmpty"),D=x("kEof");function P(e,t){if("function"!=typeof e)throw new i("fn",["Function","AsyncFunction"],e);null!=t&&d(t,"options"),null!=(null==t?void 0:t.signal)&&c(t.signal,"options.signal");let n=1;null!=(null==t?void 0:t.concurrency)&&(n=_(t.concurrency));let a=n-1;return null!=(null==t?void 0:t.highWaterMark)&&(a=_(t.highWaterMark)),u(n,"options.concurrency",1),u(a,"options.highWaterMark",0),a+=n,async function*(){const i=r(7760).AbortSignalAny([null==t?void 0:t.signal].filter(v)),o=this,s=[],c={signal:i};let u,d,p=!1,f=0;function h(){p=!0,m()}function m(){f-=1,g()}function g(){d&&!p&&f<n&&s.length<a&&(d(),d=null)}!async function(){try{for await(let t of o){if(p)return;if(i.aborted)throw new l;try{if(t=e(t,c),t===B)continue;t=A(t)}catch(e){t=k(e)}f+=1,C(t,m,h),s.push(t),u&&(u(),u=null),!p&&(s.length>=a||f>=n)&&await new I(e=>{d=e})}s.push(D)}catch(e){const t=k(e);C(t,m,h),s.push(t)}finally{p=!0,u&&(u(),u=null)}}();try{for(;;){for(;s.length>0;){const e=await s[0];if(e===D)return;if(i.aborted)throw new l;e!==B&&(yield e),s.shift(),g()}await new I(e=>{u=e})}}finally{p=!0,d&&(d(),d=null)}}.call(this)}async function R(e,t=void 0){for await(const r of M.call(this,e,t))return!0;return!1}function M(e,t){if("function"!=typeof e)throw new i("fn",["Function","AsyncFunction"],e);return P.call(this,async function(t,r){return await e(t,r)?t:B},t)}class F extends o{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}function L(e){if(e=E(e),S(e))return 0;if(e<0)throw new s("number",">= 0",e);return e}e.exports.streamReturningOperators={asIndexedPairs:w(function(e=void 0){return null!=e&&d(e,"options"),null!=(null==e?void 0:e.signal)&&c(e.signal,"options.signal"),async function*(){let t=0;for await(const n of this){var r;if(null!=e&&null!==(r=e.signal)&&void 0!==r&&r.aborted)throw new l({cause:e.signal.reason});yield[t++,n]}}.call(this)},"readable.asIndexedPairs will be removed in a future version."),drop:function(e,t=void 0){return null!=t&&d(t,"options"),null!=(null==t?void 0:t.signal)&&c(t.signal,"options.signal"),e=L(e),async function*(){var r;if(null!=t&&null!==(r=t.signal)&&void 0!==r&&r.aborted)throw new l;for await(const r of this){var n;if(null!=t&&null!==(n=t.signal)&&void 0!==n&&n.aborted)throw new l;e--<=0&&(yield r)}}.call(this)},filter:M,flatMap:function(e,t){const r=P.call(this,e,t);return async function*(){for await(const e of r)yield*e}.call(this)},map:P,take:function(e,t=void 0){return null!=t&&d(t,"options"),null!=(null==t?void 0:t.signal)&&c(t.signal,"options.signal"),e=L(e),async function*(){var r;if(null!=t&&null!==(r=t.signal)&&void 0!==r&&r.aborted)throw new l;for await(const r of this){var n;if(null!=t&&null!==(n=t.signal)&&void 0!==n&&n.aborted)throw new l;if(e-- >0&&(yield r),e<=0)return}}.call(this)},compose:function(e,t){if(null!=t&&d(t,"options"),null!=(null==t?void 0:t.signal)&&c(t.signal,"options.signal"),b(e)&&!y(e))throw new a("stream",e,"must be writable");const r=m(this,e);return null!=t&&t.signal&&g(t.signal,r),r}},e.exports.promiseReturningOperators={every:async function(e,t=void 0){if("function"!=typeof e)throw new i("fn",["Function","AsyncFunction"],e);return!await R.call(this,async(...t)=>!await e(...t),t)},forEach:async function(e,t){if("function"!=typeof e)throw new i("fn",["Function","AsyncFunction"],e);for await(const r of P.call(this,async function(t,r){return await e(t,r),B},t));},reduce:async function(e,t,r){var a;if("function"!=typeof e)throw new i("reducer",["Function","AsyncFunction"],e);null!=r&&d(r,"options"),null!=(null==r?void 0:r.signal)&&c(r.signal,"options.signal");let o=arguments.length>1;if(null!=r&&null!==(a=r.signal)&&void 0!==a&&a.aborted){const e=new l(void 0,{cause:r.signal.reason});throw this.once("error",()=>{}),await h(this.destroy(e)),e}const s=new n,u=s.signal;if(null!=r&&r.signal){const e={once:!0,[p]:this,[f]:!0};r.signal.addEventListener("abort",()=>s.abort(),e)}let m=!1;try{for await(const n of this){var g;if(m=!0,null!=r&&null!==(g=r.signal)&&void 0!==g&&g.aborted)throw new l;o?t=await e(t,n,{signal:u}):(t=n,o=!0)}if(!m&&!o)throw new F}finally{s.abort()}return t},toArray:async function(e){null!=e&&d(e,"options"),null!=(null==e?void 0:e.signal)&&c(e.signal,"options.signal");const t=[];for await(const n of this){var r;if(null!=e&&null!==(r=e.signal)&&void 0!==r&&r.aborted)throw new l(void 0,{cause:e.signal.reason});T(t,n)}return t},some:R,find:async function(e,t){for await(const r of M.call(this,e,t))return r}}},864:(e,t)=>{var r=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/,n=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/,a=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;function i(e,t,r){this.type=e,this.subtype=t,this.suffix=r}t.format=function(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var t=e.subtype,a=e.suffix,i=e.type;if(!i||!n.test(i))throw new TypeError("invalid type");if(!t||!r.test(t))throw new TypeError("invalid subtype");var o=i+"/"+t;if(a){if(!n.test(a))throw new TypeError("invalid suffix");o+="+"+a}return o},t.parse=function(e){if(!e)throw new TypeError("argument string is required");if("string"!=typeof e)throw new TypeError("argument string is required to be a string");var t=a.exec(e.toLowerCase());if(!t)throw new TypeError("invalid media type");var r,n=t[1],o=t[2],s=o.lastIndexOf("+");return-1!==s&&(r=o.substr(s+1),o=o.substr(0,s)),new i(n,o,r)},t.test=function(e){if(!e)throw new TypeError("argument string is required");if("string"!=typeof e)throw new TypeError("argument string is required to be a string");return a.test(e.toLowerCase())}},906:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferTokenizer=void 0;const n=r(8705),a=r(9838);class i extends a.AbstractTokenizer{constructor(e,t){super(t),this.uint8Array=e,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:e.length}async readBuffer(e,t){if(t&&t.position){if(t.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=t.position}const r=await this.peekBuffer(e,t);return this.position+=r,r}async peekBuffer(e,t){const r=this.normalizeOptions(e,t),a=Math.min(this.uint8Array.length-r.position,r.length);if(!r.mayBeLess&&a<r.length)throw new n.EndOfStreamError;return e.set(this.uint8Array.subarray(r.position,r.position+a),r.offset),a}async close(){}}t.BufferTokenizer=i},1028:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.AnsiStringType=t.StringType=t.BufferType=t.Uint8ArrayType=t.IgnoreType=t.Float80_LE=t.Float80_BE=t.Float64_LE=t.Float64_BE=t.Float32_LE=t.Float32_BE=t.Float16_LE=t.Float16_BE=t.INT64_BE=t.UINT64_BE=t.INT64_LE=t.UINT64_LE=t.INT32_LE=t.INT32_BE=t.INT24_BE=t.INT24_LE=t.INT16_LE=t.INT16_BE=t.INT8=t.UINT32_BE=t.UINT32_LE=t.UINT24_BE=t.UINT24_LE=t.UINT16_BE=t.UINT16_LE=t.UINT8=void 0;const a=r(251);function i(e){return new DataView(e.buffer,e.byteOffset)}t.UINT8={len:1,get:(e,t)=>i(e).getUint8(t),put:(e,t,r)=>(i(e).setUint8(t,r),t+1)},t.UINT16_LE={len:2,get:(e,t)=>i(e).getUint16(t,!0),put:(e,t,r)=>(i(e).setUint16(t,r,!0),t+2)},t.UINT16_BE={len:2,get:(e,t)=>i(e).getUint16(t),put:(e,t,r)=>(i(e).setUint16(t,r),t+2)},t.UINT24_LE={len:3,get(e,t){const r=i(e);return r.getUint8(t)+(r.getUint16(t+1,!0)<<8)},put(e,t,r){const n=i(e);return n.setUint8(t,255&r),n.setUint16(t+1,r>>8,!0),t+3}},t.UINT24_BE={len:3,get(e,t){const r=i(e);return(r.getUint16(t)<<8)+r.getUint8(t+2)},put(e,t,r){const n=i(e);return n.setUint16(t,r>>8),n.setUint8(t+2,255&r),t+3}},t.UINT32_LE={len:4,get:(e,t)=>i(e).getUint32(t,!0),put:(e,t,r)=>(i(e).setUint32(t,r,!0),t+4)},t.UINT32_BE={len:4,get:(e,t)=>i(e).getUint32(t),put:(e,t,r)=>(i(e).setUint32(t,r),t+4)},t.INT8={len:1,get:(e,t)=>i(e).getInt8(t),put:(e,t,r)=>(i(e).setInt8(t,r),t+1)},t.INT16_BE={len:2,get:(e,t)=>i(e).getInt16(t),put:(e,t,r)=>(i(e).setInt16(t,r),t+2)},t.INT16_LE={len:2,get:(e,t)=>i(e).getInt16(t,!0),put:(e,t,r)=>(i(e).setInt16(t,r,!0),t+2)},t.INT24_LE={len:3,get(e,r){const n=t.UINT24_LE.get(e,r);return n>8388607?n-16777216:n},put(e,t,r){const n=i(e);return n.setUint8(t,255&r),n.setUint16(t+1,r>>8,!0),t+3}},t.INT24_BE={len:3,get(e,r){const n=t.UINT24_BE.get(e,r);return n>8388607?n-16777216:n},put(e,t,r){const n=i(e);return n.setUint16(t,r>>8),n.setUint8(t+2,255&r),t+3}},t.INT32_BE={len:4,get:(e,t)=>i(e).getInt32(t),put:(e,t,r)=>(i(e).setInt32(t,r),t+4)},t.INT32_LE={len:4,get:(e,t)=>i(e).getInt32(t,!0),put:(e,t,r)=>(i(e).setInt32(t,r,!0),t+4)},t.UINT64_LE={len:8,get:(e,t)=>i(e).getBigUint64(t,!0),put:(e,t,r)=>(i(e).setBigUint64(t,r,!0),t+8)},t.INT64_LE={len:8,get:(e,t)=>i(e).getBigInt64(t,!0),put:(e,t,r)=>(i(e).setBigInt64(t,r,!0),t+8)},t.UINT64_BE={len:8,get:(e,t)=>i(e).getBigUint64(t),put:(e,t,r)=>(i(e).setBigUint64(t,r),t+8)},t.INT64_BE={len:8,get:(e,t)=>i(e).getBigInt64(t),put:(e,t,r)=>(i(e).setBigInt64(t,r),t+8)},t.Float16_BE={len:2,get(e,t){return a.read(e,t,!1,10,this.len)},put(e,t,r){return a.write(e,r,t,!1,10,this.len),t+this.len}},t.Float16_LE={len:2,get(e,t){return a.read(e,t,!0,10,this.len)},put(e,t,r){return a.write(e,r,t,!0,10,this.len),t+this.len}},t.Float32_BE={len:4,get:(e,t)=>i(e).getFloat32(t),put:(e,t,r)=>(i(e).setFloat32(t,r),t+4)},t.Float32_LE={len:4,get:(e,t)=>i(e).getFloat32(t,!0),put:(e,t,r)=>(i(e).setFloat32(t,r,!0),t+4)},t.Float64_BE={len:8,get:(e,t)=>i(e).getFloat64(t),put:(e,t,r)=>(i(e).setFloat64(t,r),t+8)},t.Float64_LE={len:8,get:(e,t)=>i(e).getFloat64(t,!0),put:(e,t,r)=>(i(e).setFloat64(t,r,!0),t+8)},t.Float80_BE={len:10,get(e,t){return a.read(e,t,!1,63,this.len)},put(e,t,r){return a.write(e,r,t,!1,63,this.len),t+this.len}},t.Float80_LE={len:10,get(e,t){return a.read(e,t,!0,63,this.len)},put(e,t,r){return a.write(e,r,t,!0,63,this.len),t+this.len}},t.IgnoreType=class{constructor(e){this.len=e}get(e,t){}},t.Uint8ArrayType=class{constructor(e){this.len=e}get(e,t){return e.subarray(t,t+this.len)}},t.BufferType=class{constructor(e){this.len=e}get(e,t){return n.from(e.subarray(t,t+this.len))}},t.StringType=class{constructor(e,t){this.len=e,this.encoding=t}get(e,t){return n.from(e).toString(this.encoding,t,t+this.len)}};class o{constructor(e){this.len=e}static decode(e,t,r){let n="";for(let a=t;a<r;++a)n+=o.codePointToString(o.singleByteDecoder(e[a]));return n}static inRange(e,t,r){return t<=e&&e<=r}static codePointToString(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}static singleByteDecoder(e){if(o.inRange(e,0,127))return e;const t=o.windows1252[e-128];if(null===t)throw Error("invaliding encoding");return t}get(e,t=0){return o.decode(e,t,t+this.len)}}t.AnsiStringType=o,o.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]},1032:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamReader=void 0;const n=r(1028),a=r(7833),i=r(6378),o=(0,a.default)("music-metadata:parser:musepack:sv8"),s=new n.StringType(2,"binary"),l={len:5,get:(e,t)=>({crc:n.UINT32_LE.get(e,t),streamVersion:n.UINT8.get(e,t+4)})},c={len:2,get:(e,t)=>({sampleFrequency:[44100,48e3,37800,32e3][i.getBitAllignedNumber(e,t,0,3)],maxUsedBands:i.getBitAllignedNumber(e,t,3,5),channelCount:i.getBitAllignedNumber(e,t+1,0,4)+1,msUsed:i.isBitSet(e,t+1,4),audioBlockFrames:i.getBitAllignedNumber(e,t+1,5,3)})};t.StreamReader=class{constructor(e){this.tokenizer=e}async readPacketHeader(){const e=await this.tokenizer.readToken(s),t=await this.readVariableSizeField();return{key:e,payloadLength:t.value-2-t.len}}async readStreamHeader(e){const t={};o(`Reading SH at offset=${this.tokenizer.position}`);const r=await this.tokenizer.readToken(l);e-=l.len,Object.assign(t,r),o(`SH.streamVersion = ${r.streamVersion}`);const n=await this.readVariableSizeField();e-=n.len,t.sampleCount=n.value;const a=await this.readVariableSizeField();e-=a.len,t.beginningOfSilence=a.value;const i=await this.tokenizer.readToken(c);return e-=c.len,Object.assign(t,i),await this.tokenizer.ignore(e),t}async readVariableSizeField(e=1,t=0){let r=await this.tokenizer.readNumber(n.UINT8);return 128&r?(r&=127,r+=t,this.readVariableSizeField(e+1,r<<7)):{len:e,value:t+r}}}},1110:(e,t)=>{t.stringToBytes=e=>[...e].map(e=>e.charCodeAt(0)),t.tarHeaderChecksumMatches=(e,t=0)=>{const r=parseInt(e.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(r))return!1;let n=256;for(let r=t;r<t+148;r++)n+=e[r];for(let r=t+156;r<t+512;r++)n+=e[r];return r===n},t.uint32SyncSafeToken={get:(e,t)=>127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4}},1158:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.APEv2TagMapper=void 0;const n=r(4151),a={Title:"title",Artist:"artist",Artists:"artists","Album Artist":"albumartist",Album:"album",Year:"date",Originalyear:"originalyear",Originaldate:"originaldate",Comment:"comment",Track:"track",Disc:"disk",DISCNUMBER:"disk",Genre:"genre","Cover Art (Front)":"picture","Cover Art (Back)":"picture",Composer:"composer",Lyrics:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",Lyricist:"lyricist",Writer:"writer",Conductor:"conductor",MixArtist:"remixer",Arranger:"arranger",Engineer:"engineer",Producer:"producer",DJMixer:"djmixer",Mixer:"mixer",Label:"label",Grouping:"grouping",Subtitle:"subtitle",DiscSubtitle:"discsubtitle",Compilation:"compilation",BPM:"bpm",Mood:"mood",Media:"media",CatalogNumber:"catalognumber",MUSICBRAINZ_ALBUMSTATUS:"releasestatus",MUSICBRAINZ_ALBUMTYPE:"releasetype",RELEASECOUNTRY:"releasecountry",Script:"script",Language:"language",Copyright:"copyright",LICENSE:"license",EncodedBy:"encodedby",EncoderSettings:"encodersettings",Barcode:"barcode",ISRC:"isrc",ASIN:"asin",musicbrainz_trackid:"musicbrainz_recordingid",musicbrainz_releasetrackid:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",Acoustid_Id:"acoustid_id",ACOUSTID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",Weblink:"website",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",MP3GAIN_MINMAX:"replaygain_track_minmax",MP3GAIN_UNDO:"replaygain_undo"};class i extends n.CaseInsensitiveTagMap{constructor(){super(["APEv2"],a)}}t.APEv2TagMapper=i},1319:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Header=void 0;const n=r(1028),a=r(6378);t.Header={len:80,get:(e,t)=>({speex:new n.StringType(8,"ascii").get(e,t+0),version:a.trimRightNull(new n.StringType(20,"ascii").get(e,t+8)),version_id:e.readInt32LE(t+28),header_size:e.readInt32LE(t+32),rate:e.readInt32LE(t+36),mode:e.readInt32LE(t+40),mode_bitstream_version:e.readInt32LE(t+44),nb_channels:e.readInt32LE(t+48),bitrate:e.readInt32LE(t+52),frame_size:e.readInt32LE(t+56),vbr:e.readInt32LE(t+60),frames_per_packet:e.readInt32LE(t+64),extra_headers:e.readInt32LE(t+68),reserved1:e.readInt32LE(t+72),reserved2:e.readInt32LE(t+76)})}},1403:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IdHeader=void 0;const n=r(1028);t.IdHeader=class{constructor(e){if(this.len=e,e<19)throw new Error("ID-header-page 0 should be at least 19 bytes long")}get(e,t){return{magicSignature:new n.StringType(8,"ascii").get(e,t+0),version:e.readUInt8(t+8),channelCount:e.readUInt8(t+9),preSkip:e.readInt16LE(t+10),inputSampleRate:e.readInt32LE(t+12),outputGain:e.readInt16LE(t+16),channelMapping:e.readUInt8(t+18)}}}},1426:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FormatChunk=t.ChannelType=t.DsdChunk=t.ChunkHeader=void 0;const n=r(1028),a=r(3232);var i;t.ChunkHeader={len:12,get:(e,t)=>({id:a.FourCcToken.get(e,t),size:n.UINT64_LE.get(e,t+4)})},t.DsdChunk={len:16,get:(e,t)=>({fileSize:n.INT64_LE.get(e,t),metadataPointer:n.INT64_LE.get(e,t+8)})},(i=t.ChannelType||(t.ChannelType={}))[i.mono=1]="mono",i[i.stereo=2]="stereo",i[i.channels=3]="channels",i[i.quad=4]="quad",i[i["4 channels"]=5]="4 channels",i[i["5 channels"]=6]="5 channels",i[i["5.1 channels"]=7]="5.1 channels",t.FormatChunk={len:40,get:(e,t)=>({formatVersion:n.INT32_LE.get(e,t),formatID:n.INT32_LE.get(e,t+4),channelType:n.INT32_LE.get(e,t+8),channelNum:n.INT32_LE.get(e,t+12),samplingFrequency:n.INT32_LE.get(e,t+16),bitsPerSample:n.INT32_LE.get(e,t+20),sampleCount:n.INT64_LE.get(e,t+24),blockSizePerChannel:n.INT32_LE.get(e,t+32)})}},1446:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(7833),a=r(1028),i=r(7270),o=r(8058),s=r(5056),l=(0,n.default)("music-metadata:parser:musepack");class c extends i.AbstractID3Parser{async postId3v2Parse(){let e;switch(await this.tokenizer.peekToken(new a.StringType(3,"binary"))){case"MP+":l("Musepack stream-version 7"),e=new s.MpcSv7Parser;break;case"MPC":l("Musepack stream-version 8"),e=new o.MpcSv8Parser;break;default:throw new Error("Invalid Musepack signature prefix")}return e.init(this.metadata,this.tokenizer,this.options),e.parse()}}t.default=c},1510:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamReader=t.EndOfStreamError=void 0;const n=r(5523),a=r(8122);var i=r(5523);Object.defineProperty(t,"EndOfStreamError",{enumerable:!0,get:function(){return i.EndOfStreamError}}),t.StreamReader=class{constructor(e){if(this.s=e,this.deferred=null,this.endOfStream=!1,this.peekQueue=[],!e.read||!e.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",()=>this.reject(new n.EndOfStreamError)),this.s.once("error",e=>this.reject(e)),this.s.once("close",()=>this.reject(new Error("Stream closed")))}async peek(e,t,r){const n=await this.read(e,t,r);return this.peekQueue.push(e.subarray(t,t+n)),n}async read(e,t,r){if(0===r)return 0;if(0===this.peekQueue.length&&this.endOfStream)throw new n.EndOfStreamError;let a=r,i=0;for(;this.peekQueue.length>0&&a>0;){const r=this.peekQueue.pop();if(!r)throw new Error("peekData should be defined");const n=Math.min(r.length,a);e.set(r.subarray(0,n),t+i),i+=n,a-=n,n<r.length&&this.peekQueue.push(r.subarray(n))}for(;a>0&&!this.endOfStream;){const r=Math.min(a,1048576),n=await this.readFromStream(e,t+i,r);if(i+=n,n<r)break;a-=n}return i}async readFromStream(e,t,r){const n=this.s.read(r);if(n)return e.set(n,t),n.length;{const n={buffer:e,offset:t,length:r,deferred:new a.Deferred};return this.deferred=n.deferred,this.s.once("readable",()=>{this.readDeferred(n)}),n.deferred.promise}}readDeferred(e){const t=this.s.read(e.length);t?(e.buffer.set(t,e.offset),e.deferred.resolve(t.length),this.deferred=null):this.s.once("readable",()=>{this.readDeferred(e)})}reject(e){this.endOfStream=!0,this.deferred&&(this.deferred.reject(e),this.deferred=null)}}},1650:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FlacParser=void 0;const n=r(1028),a=r(7833),i=r(6378),o=r(431),s=r(7270),l=r(3232),c=r(2668),u=r(668),d=(0,a.default)("music-metadata:parser:FLAC");var p;!function(e){e[e.STREAMINFO=0]="STREAMINFO",e[e.PADDING=1]="PADDING",e[e.APPLICATION=2]="APPLICATION",e[e.SEEKTABLE=3]="SEEKTABLE",e[e.VORBIS_COMMENT=4]="VORBIS_COMMENT",e[e.CUESHEET=5]="CUESHEET",e[e.PICTURE=6]="PICTURE"}(p||(p={}));class f extends s.AbstractID3Parser{constructor(){super(...arguments),this.padding=0}init(e,t,r){return super.init(e,t,r),this.vorbisParser=new c.VorbisParser(e,r),this}async postId3v2Parse(){if("fLaC"!==(await this.tokenizer.readToken(l.FourCcToken)).toString())throw new Error("Invalid FLAC preamble");let e;do{e=await this.tokenizer.readToken(h.BlockHeader),await this.parseDataBlock(e)}while(!e.lastBlock);if(this.tokenizer.fileInfo.size&&this.metadata.format.duration){const e=this.tokenizer.fileInfo.size-this.tokenizer.position;this.metadata.setFormat("bitrate",8*e/this.metadata.format.duration)}}parseDataBlock(e){switch(d(`blockHeader type=${e.type}, length=${e.length}`),e.type){case p.STREAMINFO:return this.parseBlockStreamInfo(e.length);case p.PADDING:this.padding+=e.length;break;case p.APPLICATION:case p.SEEKTABLE:break;case p.VORBIS_COMMENT:return this.parseComment(e.length);case p.CUESHEET:break;case p.PICTURE:return this.parsePicture(e.length).then();default:this.metadata.addWarning("Unknown block type: "+e.type)}return this.tokenizer.ignore(e.length).then()}async parseBlockStreamInfo(e){if(e!==h.BlockStreamInfo.len)throw new Error("Unexpected block-stream-info length");const t=await this.tokenizer.readToken(h.BlockStreamInfo);this.metadata.setFormat("container","FLAC"),this.metadata.setFormat("codec","FLAC"),this.metadata.setFormat("lossless",!0),this.metadata.setFormat("numberOfChannels",t.channels),this.metadata.setFormat("bitsPerSample",t.bitsPerSample),this.metadata.setFormat("sampleRate",t.sampleRate),t.totalSamples>0&&this.metadata.setFormat("duration",t.totalSamples/t.sampleRate)}async parseComment(e){const t=await this.tokenizer.readToken(new n.Uint8ArrayType(e)),r=new u.VorbisDecoder(t,0);r.readStringUtf8();const a=r.readInt32();for(let e=0;e<a;e++){const e=r.parseUserComment();this.vorbisParser.addTag(e.key,e.value)}}async parsePicture(e){if(this.options.skipCovers)return this.tokenizer.ignore(e);{const t=await this.tokenizer.readToken(new o.VorbisPictureToken(e));this.vorbisParser.addTag("METADATA_BLOCK_PICTURE",t)}}}t.FlacParser=f;class h{}h.BlockHeader={len:4,get:(e,t)=>({lastBlock:i.getBit(e,t,7),type:i.getBitAllignedNumber(e,t,1,7),length:n.UINT24_BE.get(e,t+1)})},h.BlockStreamInfo={len:34,get:(e,t)=>({minimumBlockSize:n.UINT16_BE.get(e,t),maximumBlockSize:n.UINT16_BE.get(e,t+2)/1e3,minimumFrameSize:n.UINT24_BE.get(e,t+4),maximumFrameSize:n.UINT24_BE.get(e,t+7),sampleRate:n.UINT24_BE.get(e,t+10)>>4,channels:i.getBitAllignedNumber(e,t+12,4,3)+1,bitsPerSample:i.getBitAllignedNumber(e,t+12,7,5)+1,totalSamples:i.getBitAllignedNumber(e,t+13,4,36),fileMD5:new n.Uint8ArrayType(16).get(e,t+18)})}},1919:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Atom=void 0;const n=r(7833),a=r(7550),i=(0,n.default)("music-metadata:parser:MP4:Atom");class o{static async readAtom(e,t,r,n){const s=e.position,l=await e.readToken(a.Header);l.length===BigInt(1)&&(l.length=await e.readToken(a.ExtendedSize));const c=new o(l,l.length===BigInt(1),r),u=c.getPayloadLength(n);return i(`parse atom name=${c.atomPath}, extended=${c.extended}, offset=${s}, len=${c.header.length}`),await c.readData(e,t,u),c}constructor(e,t,r){this.header=e,this.extended=t,this.parent=r,this.children=[],this.atomPath=(this.parent?this.parent.atomPath+".":"")+this.header.name}getHeaderLength(){return this.extended?16:8}getPayloadLength(e){return(this.header.length===BigInt(0)?e:Number(this.header.length))-this.getHeaderLength()}async readAtoms(e,t,r){for(;r>0;){const n=await o.readAtom(e,t,this,r);this.children.push(n),r-=n.header.length===BigInt(0)?r:Number(n.header.length)}}async readData(e,t,r){switch(this.header.name){case"moov":case"udta":case"trak":case"mdia":case"minf":case"stbl":case"<id>":case"ilst":case"tref":return this.readAtoms(e,t,this.getPayloadLength(r));case"meta":const n="hdlr"===(await e.peekToken(a.Header)).name?0:4;return await e.ignore(n),this.readAtoms(e,t,this.getPayloadLength(r)-n);default:return t(this,r)}}}t.Atom=o},2030:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.MatroskaParser=void 0;const a=r(1028),i=r(7833),o=r(6373),s=r(14),l=r(5),c=(0,i.default)("music-metadata:parser:matroska");class u extends o.BasicParser{constructor(){super(),this.padding=0,this.parserMap=new Map,this.ebmlMaxIDLength=4,this.ebmlMaxSizeLength=8,this.parserMap.set(s.DataType.uint,e=>this.readUint(e)),this.parserMap.set(s.DataType.string,e=>this.readString(e)),this.parserMap.set(s.DataType.binary,e=>this.readBuffer(e)),this.parserMap.set(s.DataType.uid,async e=>1===await this.readUint(e)),this.parserMap.set(s.DataType.bool,e=>this.readFlag(e)),this.parserMap.set(s.DataType.float,e=>this.readFloat(e))}init(e,t,r){return super.init(e,t,r),this}async parse(){const e=await this.parseContainer(l.elements,this.tokenizer.fileInfo.size,[]);if(this.metadata.setFormat("container",`EBML/${e.ebml.docType}`),e.segment){const t=e.segment.info;if(t){const e=t.timecodeScale?t.timecodeScale:1e6;if("number"==typeof t.duration){const r=t.duration*e/1e9;this.addTag("segment:title",t.title),this.metadata.setFormat("duration",r)}}const r=e.segment.tracks;if(r&&r.entries){r.entries.forEach(e=>{const t={codecName:e.codecID.replace("A_","").replace("V_",""),codecSettings:e.codecSettings,flagDefault:e.flagDefault,flagLacing:e.flagLacing,flagEnabled:e.flagEnabled,language:e.language,name:e.name,type:e.trackType,audio:e.audio,video:e.video};this.metadata.addStreamInfo(t)});const t=r.entries.filter(e=>e.trackType===s.TrackType.audio.valueOf()).reduce((e,t)=>e?!e.flagDefault&&t.flagDefault||t.trackNumber&&t.trackNumber<e.trackNumber?t:e:t,null);t&&(this.metadata.setFormat("codec",t.codecID.replace("A_","")),this.metadata.setFormat("sampleRate",t.audio.samplingFrequency),this.metadata.setFormat("numberOfChannels",t.audio.channels)),e.segment.tags&&e.segment.tags.tag.forEach(e=>{const t=e.target,r=(null==t?void 0:t.targetTypeValue)?s.TargetType[t.targetTypeValue]:(null==t?void 0:t.targetType)?t.targetType:"track";e.simpleTags.forEach(e=>{const t=e.string?e.string:e.binary;this.addTag(`${r}:${e.name}`,t)})}),e.segment.attachments&&e.segment.attachments.attachedFiles.filter(e=>e.mimeType.startsWith("image/")).map(e=>({data:e.data,format:e.mimeType,description:e.description,name:e.name})).forEach(e=>{this.addTag("picture",e)})}}}async parseContainer(e,t,r){const n={};for(;this.tokenizer.position<t;){let t;try{t=await this.readElement()}catch(e){if("End-Of-Stream"===e.message)break;throw e}const a=e[t.id];if(a)if(c(`Element: name=${a.name}, container=${!!a.container}`),a.container){const e=await this.parseContainer(a.container,t.len>=0?this.tokenizer.position+t.len:-1,r.concat([a.name]));a.multiple?(n[a.name]||(n[a.name]=[]),n[a.name].push(e)):n[a.name]=e}else n[a.name]=await this.parserMap.get(a.value)(t);else 236===t.id?(this.padding+=t.len,await this.tokenizer.ignore(t.len)):(c(`parseEbml: path=${r.join("/")}, unknown element: id=${t.id.toString(16)}`),this.padding+=t.len,await this.tokenizer.ignore(t.len))}return n}async readVintData(e){const t=await this.tokenizer.peekNumber(a.UINT8);let r=128,i=1;for(;0===(t&r);){if(i>e)throw new Error("VINT value exceeding maximum size");++i,r>>=1}const o=n.alloc(i);return await this.tokenizer.readBuffer(o),o}async readElement(){const e=await this.readVintData(this.ebmlMaxIDLength),t=await this.readVintData(this.ebmlMaxSizeLength);t[0]^=128>>t.length-1;const r=Math.min(6,t.length);return{id:e.readUIntBE(0,e.length),len:t.readUIntBE(t.length-r,r)}}isMaxValue(e){if(e.length===this.ebmlMaxSizeLength){for(let t=1;t<this.ebmlMaxSizeLength;++t)if(255!==e[t])return!1;return!0}return!1}async readFloat(e){switch(e.len){case 0:return 0;case 4:return this.tokenizer.readNumber(a.Float32_BE);case 8:case 10:return this.tokenizer.readNumber(a.Float64_BE);default:throw new Error(`Invalid IEEE-754 float length: ${e.len}`)}}async readFlag(e){return 1===await this.readUint(e)}async readUint(e){const t=await this.readBuffer(e),r=Math.min(6,e.len);return t.readUIntBE(e.len-r,r)}async readString(e){return(await this.tokenizer.readToken(new a.StringType(e.len,"utf-8"))).replace(/\00.*$/g,"")}async readBuffer(e){const t=n.alloc(e.len);return await this.tokenizer.readBuffer(t),t}addTag(e,t){this.metadata.addTag("matroska",e,t)}}t.MatroskaParser=u},2268:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0});class a{static fromBin(e,t=0){return new a(this.decode(e,t))}static decode(e,t=0){return(e.readUInt32LE(t).toString(16)+"-"+e.readUInt16LE(t+4).toString(16)+"-"+e.readUInt16LE(t+6).toString(16)+"-"+e.readUInt16BE(t+8).toString(16)+"-"+e.slice(t+10,t+16).toString("hex")).toUpperCase()}static decodeMediaType(e){switch(e.str){case a.AudioMedia.str:return"audio";case a.VideoMedia.str:return"video";case a.CommandMedia.str:return"command";case a.Degradable_JPEG_Media.str:return"degradable-jpeg";case a.FileTransferMedia.str:return"file-transfer";case a.BinaryMedia.str:return"binary"}}static encode(e){const t=n.alloc(16);return t.writeUInt32LE(parseInt(e.slice(0,8),16),0),t.writeUInt16LE(parseInt(e.slice(9,13),16),4),t.writeUInt16LE(parseInt(e.slice(14,18),16),6),n.from(e.slice(19,23),"hex").copy(t,8),n.from(e.slice(24),"hex").copy(t,10),t}constructor(e){this.str=e}equals(e){return this.str===e.str}toBin(){return a.encode(this.str)}}a.HeaderObject=new a("75B22630-668E-11CF-A6D9-00AA0062CE6C"),a.DataObject=new a("75B22636-668E-11CF-A6D9-00AA0062CE6C"),a.SimpleIndexObject=new a("33000890-E5B1-11CF-89F4-00A0C90349CB"),a.IndexObject=new a("D6E229D3-35DA-11D1-9034-00A0C90349BE"),a.MediaObjectIndexObject=new a("FEB103F8-12AD-4C64-840F-2A1D2F7AD48C"),a.TimecodeIndexObject=new a("3CB73FD0-0C4A-4803-953D-EDF7B6228F0C"),a.FilePropertiesObject=new a("8CABDCA1-A947-11CF-8EE4-00C00C205365"),a.StreamPropertiesObject=new a("B7DC0791-A9B7-11CF-8EE6-00C00C205365"),a.HeaderExtensionObject=new a("5FBF03B5-A92E-11CF-8EE3-00C00C205365"),a.CodecListObject=new a("86D15240-311D-11D0-A3A4-00A0C90348F6"),a.ScriptCommandObject=new a("1EFB1A30-0B62-11D0-A39B-00A0C90348F6"),a.MarkerObject=new a("F487CD01-A951-11CF-8EE6-00C00C205365"),a.BitrateMutualExclusionObject=new a("D6E229DC-35DA-11D1-9034-00A0C90349BE"),a.ErrorCorrectionObject=new a("75B22635-668E-11CF-A6D9-00AA0062CE6C"),a.ContentDescriptionObject=new a("75B22633-668E-11CF-A6D9-00AA0062CE6C"),a.ExtendedContentDescriptionObject=new a("D2D0A440-E307-11D2-97F0-00A0C95EA850"),a.ContentBrandingObject=new a("2211B3FA-BD23-11D2-B4B7-00A0C955FC6E"),a.StreamBitratePropertiesObject=new a("7BF875CE-468D-11D1-8D82-006097C9A2B2"),a.ContentEncryptionObject=new a("2211B3FB-BD23-11D2-B4B7-00A0C955FC6E"),a.ExtendedContentEncryptionObject=new a("298AE614-2622-4C17-B935-DAE07EE9289C"),a.DigitalSignatureObject=new a("2211B3FC-BD23-11D2-B4B7-00A0C955FC6E"),a.PaddingObject=new a("1806D474-CADF-4509-A4BA-9AABCB96AAE8"),a.ExtendedStreamPropertiesObject=new a("14E6A5CB-C672-4332-8399-A96952065B5A"),a.AdvancedMutualExclusionObject=new a("A08649CF-4775-4670-8A16-6E35357566CD"),a.GroupMutualExclusionObject=new a("D1465A40-5A79-4338-B71B-E36B8FD6C249"),a.StreamPrioritizationObject=new a("D4FED15B-88D3-454F-81F0-ED5C45999E24"),a.BandwidthSharingObject=new a("A69609E6-517B-11D2-B6AF-00C04FD908E9"),a.LanguageListObject=new a("7C4346A9-EFE0-4BFC-B229-393EDE415C85"),a.MetadataObject=new a("C5F8CBEA-5BAF-4877-8467-AA8C44FA4CCA"),a.MetadataLibraryObject=new a("44231C94-9498-49D1-A141-1D134E457054"),a.IndexParametersObject=new a("D6E229DF-35DA-11D1-9034-00A0C90349BE"),a.MediaObjectIndexParametersObject=new a("6B203BAD-3F11-48E4-ACA8-D7613DE2CFA7"),a.TimecodeIndexParametersObject=new a("F55E496D-9797-4B5D-8C8B-604DFE9BFB24"),a.CompatibilityObject=new a("26F18B5D-4584-47EC-9F5F-0E651F0452C9"),a.AdvancedContentEncryptionObject=new a("43058533-6981-49E6-9B74-AD12CB86D58C"),a.AudioMedia=new a("F8699E40-5B4D-11CF-A8FD-00805F5C442B"),a.VideoMedia=new a("BC19EFC0-5B4D-11CF-A8FD-00805F5C442B"),a.CommandMedia=new a("59DACFC0-59E6-11D0-A3AC-00A0C90348F6"),a.JFIF_Media=new a("B61BE100-5B4E-11CF-A8FD-00805F5C442B"),a.Degradable_JPEG_Media=new a("35907DE0-E415-11CF-A917-00805F5C442B"),a.FileTransferMedia=new a("91BD222C-F21C-497A-8B6D-5AA86BFC0185"),a.BinaryMedia=new a("3AFB65E2-47EF-40F2-AC2C-70A90D71D343"),a.ASF_Index_Placeholder_Object=new a("D9AADE20-7C17-4F9C-BC28-8555DD98E2A2"),t.default=a},2298:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextEncodingToken=t.ExtendedHeader=t.ID3v2Header=t.UINT32SYNCSAFE=t.AttachedPictureType=void 0;const n=r(1028),a=r(6378);var i;(i=t.AttachedPictureType||(t.AttachedPictureType={}))[i.Other=0]="Other",i[i["32x32 pixels 'file icon' (PNG only)"]=1]="32x32 pixels 'file icon' (PNG only)",i[i["Other file icon"]=2]="Other file icon",i[i["Cover (front)"]=3]="Cover (front)",i[i["Cover (back)"]=4]="Cover (back)",i[i["Leaflet page"]=5]="Leaflet page",i[i["Media (e.g. label side of CD)"]=6]="Media (e.g. label side of CD)",i[i["Lead artist/lead performer/soloist"]=7]="Lead artist/lead performer/soloist",i[i["Artist/performer"]=8]="Artist/performer",i[i.Conductor=9]="Conductor",i[i["Band/Orchestra"]=10]="Band/Orchestra",i[i.Composer=11]="Composer",i[i["Lyricist/text writer"]=12]="Lyricist/text writer",i[i["Recording Location"]=13]="Recording Location",i[i["During recording"]=14]="During recording",i[i["During performance"]=15]="During performance",i[i["Movie/video screen capture"]=16]="Movie/video screen capture",i[i["A bright coloured fish"]=17]="A bright coloured fish",i[i.Illustration=18]="Illustration",i[i["Band/artist logotype"]=19]="Band/artist logotype",i[i["Publisher/Studio logotype"]=20]="Publisher/Studio logotype",t.UINT32SYNCSAFE={get:(e,t)=>127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4},t.ID3v2Header={len:10,get:(e,r)=>({fileIdentifier:new n.StringType(3,"ascii").get(e,r),version:{major:n.INT8.get(e,r+3),revision:n.INT8.get(e,r+4)},flags:{unsynchronisation:a.getBit(e,r+5,7),isExtendedHeader:a.getBit(e,r+5,6),expIndicator:a.getBit(e,r+5,5),footer:a.getBit(e,r+5,4)},size:t.UINT32SYNCSAFE.get(e,r+6)})},t.ExtendedHeader={len:10,get:(e,t)=>({size:n.UINT32_BE.get(e,t),extendedFlags:n.UINT16_BE.get(e,t+4),sizeOfPadding:n.UINT32_BE.get(e,t+6),crcDataPresent:a.getBit(e,t+4,31)})},t.TextEncodingToken={len:1,get:(e,t)=>{switch(e[t]){case 0:return{encoding:"latin1"};case 1:return{encoding:"utf16le",bom:!0};case 2:return{encoding:"utf16le",bom:!1};default:return{encoding:"utf8",bom:!1}}}}},2668:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.VorbisParser=void 0;const a=r(1028),i=r(7833),o=r(668),s=r(431),l=(0,i.default)("music-metadata:parser:ogg:vorbis1");t.VorbisParser=class{constructor(e,t){this.metadata=e,this.options=t,this.pageSegments=[]}parsePage(e,t){if(e.headerType.firstPage)this.parseFirstPage(e,t);else{if(e.headerType.continued){if(0===this.pageSegments.length)throw new Error("Cannot continue on previous page");this.pageSegments.push(t)}if(e.headerType.lastPage||!e.headerType.continued){if(this.pageSegments.length>0){const e=n.concat(this.pageSegments);this.parseFullPage(e)}this.pageSegments=e.headerType.lastPage?[]:[t]}}e.headerType.lastPage&&this.calculateDuration(e)}flush(){this.parseFullPage(n.concat(this.pageSegments))}parseUserComment(e,t){const r=new o.VorbisDecoder(e,t).parseUserComment();return this.addTag(r.key,r.value),r.len}addTag(e,t){if("METADATA_BLOCK_PICTURE"===e&&"string"==typeof t){if(this.options.skipCovers)return void l("Ignore picture");t=s.VorbisPictureToken.fromBase64(t),l(`Push picture: id=${e}, format=${t.format}`)}else l(`Push tag: id=${e}, value=${t}`);this.metadata.addTag("vorbis",e,t)}calculateDuration(e){this.metadata.format.sampleRate&&e.absoluteGranulePosition>=0&&(this.metadata.setFormat("numberOfSamples",e.absoluteGranulePosition),this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate))}parseFirstPage(e,t){this.metadata.setFormat("codec","Vorbis I"),l("Parse first page");const r=s.CommonHeader.get(t,0);if("vorbis"!==r.vorbis)throw new Error("Metadata does not look like Vorbis");if(1!==r.packetType)throw new Error("First Ogg page should be type 1: the identification header");{const e=s.IdentificationHeader.get(t,s.CommonHeader.len);this.metadata.setFormat("sampleRate",e.sampleRate),this.metadata.setFormat("bitrate",e.bitrateNominal),this.metadata.setFormat("numberOfChannels",e.channelMode),l("sample-rate=%s[hz], bitrate=%s[b/s], channel-mode=%s",e.sampleRate,e.bitrateNominal,e.channelMode)}}parseFullPage(e){const t=s.CommonHeader.get(e,0);if(l("Parse full page: type=%s, byteLength=%s",t.packetType,e.byteLength),3===t.packetType)return this.parseUserCommentList(e,s.CommonHeader.len)}parseUserCommentList(e,t){const r=a.UINT32_LE.get(e,t);t+=4,t+=r;let n=a.UINT32_LE.get(e,t);for(t+=4;n-- >0;)t+=this.parseUserComment(e,t)}}},2724:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpeexParser=void 0;const n=r(7833),a=r(2668),i=r(1319),o=(0,n.default)("music-metadata:parser:ogg:speex");class s extends a.VorbisParser{constructor(e,t,r){super(e,t),this.tokenizer=r}parseFirstPage(e,t){o("First Ogg/Speex page");const r=i.Header.get(t,0);this.metadata.setFormat("codec",`Speex ${r.version}`),this.metadata.setFormat("numberOfChannels",r.nb_channels),this.metadata.setFormat("sampleRate",r.rate),-1!==r.bitrate&&this.metadata.setFormat("bitrate",r.bitrate)}}t.SpeexParser=s},2861:(e,t,r)=>{var n=r(8287),a=n.Buffer;function i(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return a(e,t,r)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?e.exports=n:(i(n,t),t.Buffer=o),o.prototype=Object.create(a.prototype),i(a,o),o.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return a(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=a(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return a(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},2986:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DsdiffParser=void 0;const n=r(1028),a=r(7833),i=r(5534),o=r(3232),s=r(6373),l=r(8344),c=r(5384),u=(0,a.default)("music-metadata:parser:aiff");class d extends s.BasicParser{async parse(){const e=await this.tokenizer.readToken(c.ChunkHeader64);if("FRM8"!==e.chunkID)throw new Error("Unexpected chunk-ID");const t=(await this.tokenizer.readToken(o.FourCcToken)).trim();if("DSD"===t)return this.metadata.setFormat("container",`DSDIFF/${t}`),this.metadata.setFormat("lossless",!0),this.readFmt8Chunks(e.chunkSize-BigInt(o.FourCcToken.len));throw Error(`Unsupported DSDIFF type: ${t}`)}async readFmt8Chunks(e){for(;e>=c.ChunkHeader64.len;){const t=await this.tokenizer.readToken(c.ChunkHeader64);u(`Chunk id=${t.chunkID}`),await this.readData(t),e-=BigInt(c.ChunkHeader64.len)+t.chunkSize}}async readData(e){u(`Reading data of chunk[ID=${e.chunkID}, size=${e.chunkSize}]`);const t=this.tokenizer.position;switch(e.chunkID.trim()){case"FVER":const t=await this.tokenizer.readToken(n.UINT32_LE);u(`DSDIFF version=${t}`);break;case"PROP":if("SND "!==await this.tokenizer.readToken(o.FourCcToken))throw new Error("Unexpected PROP-chunk ID");await this.handleSoundPropertyChunks(e.chunkSize-BigInt(o.FourCcToken.len));break;case"ID3":const r=await this.tokenizer.readToken(new n.Uint8ArrayType(Number(e.chunkSize))),a=i.fromBuffer(r);await(new l.ID3v2Parser).parse(this.metadata,a,this.options);break;default:u(`Ignore chunk[ID=${e.chunkID}, size=${e.chunkSize}]`);break;case"DSD":this.metadata.setFormat("numberOfSamples",Number(e.chunkSize*BigInt(8)/BigInt(this.metadata.format.numberOfChannels))),this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate)}const r=e.chunkSize-BigInt(this.tokenizer.position-t);r>0&&(u(`After Parsing chunk, remaining ${r} bytes`),await this.tokenizer.ignore(Number(r)))}async handleSoundPropertyChunks(e){for(u(`Parsing sound-property-chunks, remainingSize=${e}`);e>0;){const t=await this.tokenizer.readToken(c.ChunkHeader64);u(`Sound-property-chunk[ID=${t.chunkID}, size=${t.chunkSize}]`);const r=this.tokenizer.position;switch(t.chunkID.trim()){case"FS":const e=await this.tokenizer.readToken(n.UINT32_BE);this.metadata.setFormat("sampleRate",e);break;case"CHNL":const r=await this.tokenizer.readToken(n.UINT16_BE);this.metadata.setFormat("numberOfChannels",r),await this.handleChannelChunks(t.chunkSize-BigInt(n.UINT16_BE.len));break;case"CMPR":const a=(await this.tokenizer.readToken(o.FourCcToken)).trim(),i=await this.tokenizer.readToken(n.UINT8),s=await this.tokenizer.readToken(new n.StringType(i,"ascii"));"DSD"===a&&(this.metadata.setFormat("lossless",!0),this.metadata.setFormat("bitsPerSample",1)),this.metadata.setFormat("codec",`${a} (${s})`);break;case"ABSS":const l=await this.tokenizer.readToken(n.UINT16_BE),c=await this.tokenizer.readToken(n.UINT8),d=await this.tokenizer.readToken(n.UINT8),p=await this.tokenizer.readToken(n.UINT32_BE);u(`ABSS ${l}:${c}:${d}.${p}`);break;case"LSCO":const f=await this.tokenizer.readToken(n.UINT16_BE);u(`LSCO lsConfig=${f}`);break;default:u(`Unknown sound-property-chunk[ID=${t.chunkID}, size=${t.chunkSize}]`),await this.tokenizer.ignore(Number(t.chunkSize))}const a=t.chunkSize-BigInt(this.tokenizer.position-r);a>0&&(u(`After Parsing sound-property-chunk ${t.chunkSize}, remaining ${a} bytes`),await this.tokenizer.ignore(Number(a))),e-=BigInt(c.ChunkHeader64.len)+t.chunkSize,u(`Parsing sound-property-chunks, remainingSize=${e}`)}if(this.metadata.format.lossless&&this.metadata.format.sampleRate&&this.metadata.format.numberOfChannels&&this.metadata.format.bitsPerSample){const e=this.metadata.format.sampleRate*this.metadata.format.numberOfChannels*this.metadata.format.bitsPerSample;this.metadata.setFormat("bitrate",e)}}async handleChannelChunks(e){u(`Parsing channel-chunks, remainingSize=${e}`);const t=[];for(;e>=o.FourCcToken.len;){const r=await this.tokenizer.readToken(o.FourCcToken);u(`Channel[ID=${r}]`),t.push(r),e-=BigInt(o.FourCcToken.len)}return u(`Channels: ${t.join(", ")}`),t}}t.DsdiffParser=d},3095:(e,t,r)=>{const{ArrayPrototypePop:n,Promise:a}=r(4134),{isIterable:i,isNodeStream:o,isWebStream:s}=r(6115),{pipelineImpl:l}=r(7758),{finished:c}=r(6238);r(5506),e.exports={finished:c,pipeline:function(...e){return new a((t,r)=>{let a,c;const u=e[e.length-1];if(u&&"object"==typeof u&&!o(u)&&!i(u)&&!s(u)){const t=n(e);a=t.signal,c=t.end}l(e,(e,n)=>{e?r(e):t(n)},{signal:a,end:c})})}}},3141:(e,t,r)=>{var n=r(2861).Buffer,a=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===a||!a(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=p,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function u(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=i,i.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},i.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},i.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var a=o(t[n]);return a>=0?(a>0&&(e.lastNeed=a-1),a):--n<r||-2===a?0:(a=o(t[n]))>=0?(a>0&&(e.lastNeed=a-2),a):--n<r||-2===a?0:(a=o(t[n]))>=0?(a>0&&(2===a?a=0:e.lastNeed=a-3),a):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},i.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},3232:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.FourCcToken=void 0;const a=r(6378),i=/^[\x21-\x7e][\x20-\x7e\x00()]{3}/;t.FourCcToken={len:4,get:(e,r)=>{const n=e.toString("binary",r,r+t.FourCcToken.len);if(!n.match(i))throw new Error(`FourCC contains invalid characters: ${a.a2hex(n)} "${n}"`);return n},put:(e,t,r)=>{const a=n.from(r,"binary");if(4!==a.length)throw new Error("Invalid length");return a.copy(e,t)}}},3340:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.joinArtists=t.MetadataCollector=void 0;const n=r(7338),a=r(7833),i=r(9056),o=r(4824),s=r(8872),l=r(6378),c=r(9549),u=(0,a.default)("music-metadata:collector"),d=["matroska","APEv2","vorbis","ID3v2.4","ID3v2.3","ID3v2.2","exif","asf","iTunes","AIFF","ID3v1"];function p(e){return e.length>2?e.slice(0,e.length-1).join(", ")+" & "+e[e.length-1]:e.join(" & ")}t.MetadataCollector=class{constructor(e){this.opts=e,this.format={tagTypes:[],trackInfo:[]},this.native={},this.common={track:{no:null,of:null},disk:{no:null,of:null},movementIndex:{}},this.quality={warnings:[]},this.commonOrigin={},this.originPriority={},this.tagMapper=new o.CombinedTagMapper;let t=1;for(const e of d)this.originPriority[e]=t++;this.originPriority.artificial=500,this.originPriority.id3v1=600}hasAny(){return Object.keys(this.native).length>0}addStreamInfo(e){u(`streamInfo: type=${n.TrackType[e.type]}, codec=${e.codecName}`),this.format.trackInfo.push(e)}setFormat(e,t){u(`format: ${e} = ${t}`),this.format[e]=t,this.opts.observer&&this.opts.observer({metadata:this,tag:{type:"format",id:e,value:t}})}addTag(e,t,r){u(`tag ${e}.${t} = ${r}`),this.native[e]||(this.format.tagTypes.push(e),this.native[e]=[]),this.native[e].push({id:t,value:r}),this.toCommon(e,t,r)}addWarning(e){this.quality.warnings.push({message:e})}postMap(e,t){switch(t.id){case"artist":if(this.commonOrigin.artist===this.originPriority[e])return this.postMap("artificial",{id:"artists",value:t.value});this.common.artists||this.setGenericTag("artificial",{id:"artists",value:t.value});break;case"artists":if(!(this.common.artist&&this.commonOrigin.artist!==this.originPriority.artificial||this.common.artists&&-1!==this.common.artists.indexOf(t.value))){const e={id:"artist",value:p((this.common.artists||[]).concat([t.value]))};this.setGenericTag("artificial",e)}break;case"picture":return void this.postFixPicture(t.value).then(r=>{null!==r&&(t.value=r,this.setGenericTag(e,t))});case"totaltracks":return void(this.common.track.of=s.CommonTagMapper.toIntOrNull(t.value));case"totaldiscs":return void(this.common.disk.of=s.CommonTagMapper.toIntOrNull(t.value));case"movementTotal":return void(this.common.movementIndex.of=s.CommonTagMapper.toIntOrNull(t.value));case"track":case"disk":case"movementIndex":const r=this.common[t.id].of;return this.common[t.id]=s.CommonTagMapper.normalizeTrack(t.value),void(this.common[t.id].of=null!=r?r:this.common[t.id].of);case"bpm":case"year":case"originalyear":t.value=parseInt(t.value,10);break;case"date":const n=parseInt(t.value.substr(0,4),10);isNaN(n)||(this.common.year=n);break;case"discogs_label_id":case"discogs_release_id":case"discogs_master_release_id":case"discogs_artist_id":case"discogs_votes":t.value="string"==typeof t.value?parseInt(t.value,10):t.value;break;case"replaygain_track_gain":case"replaygain_track_peak":case"replaygain_album_gain":case"replaygain_album_peak":t.value=(0,l.toRatio)(t.value);break;case"replaygain_track_minmax":t.value=t.value.split(",").map(e=>parseInt(e,10));break;case"replaygain_undo":const a=t.value.split(",").map(e=>parseInt(e,10));t.value={leftChannel:a[0],rightChannel:a[1]};break;case"gapless":case"compilation":case"podcast":case"showMovement":t.value="1"===t.value||1===t.value;break;case"isrc":if(this.common[t.id]&&-1!==this.common[t.id].indexOf(t.value))return}null!==t.value&&this.setGenericTag(e,t)}toCommonMetadata(){return{format:this.format,native:this.native,quality:this.quality,common:this.common}}async postFixPicture(e){if(e.data&&e.data.length>0){if(!e.format){const t=await c.fromBuffer(e.data);if(!t)return null;e.format=t.mime}return e.format=e.format.toLocaleLowerCase(),"image/jpg"===e.format&&(e.format="image/jpeg"),e}return this.addWarning("Empty picture tag found"),null}toCommon(e,t,r){const n={id:t,value:r},a=this.tagMapper.mapTag(e,n,this);a&&this.postMap(e,a)}setGenericTag(e,t){u(`common.${t.id} = ${t.value}`);const r=this.commonOrigin[t.id]||1e3,n=this.originPriority[e];if((0,i.isSingleton)(t.id)){if(!(n<=r))return u(`Ignore native tag (singleton): ${e}.${t.id} = ${t.value}`);this.common[t.id]=t.value,this.commonOrigin[t.id]=n}else if(n===r)(0,i.isUnique)(t.id)&&-1!==this.common[t.id].indexOf(t.value)?u(`Ignore duplicate value: ${e}.${t.id} = ${t.value}`):this.common[t.id].push(t.value);else{if(!(n<r))return u(`Ignore native tag (list): ${e}.${t.id} = ${t.value}`);this.common[t.id]=[t.value],this.commonOrigin[t.id]=n}this.opts.observer&&this.opts.observer({metadata:this,tag:{type:"common",id:t.id,value:t.value}})}},t.joinArtists=p},3370:(e,t,r)=>{const{ObjectDefineProperties:n,ObjectGetOwnPropertyDescriptor:a,ObjectKeys:i,ObjectSetPrototypeOf:o}=r(4134);e.exports=c;const s=r(7576),l=r(8584);o(c.prototype,s.prototype),o(c,s);{const e=i(l.prototype);for(let t=0;t<e.length;t++){const r=e[t];c.prototype[r]||(c.prototype[r]=l.prototype[r])}}function c(e){if(!(this instanceof c))return new c(e);s.call(this,e),l.call(this,e),e?(this.allowHalfOpen=!1!==e.allowHalfOpen,!1===e.readable&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),!1===e.writable&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}let u,d;function p(){return void 0===u&&(u={}),u}n(c.prototype,{writable:{__proto__:null,...a(l.prototype,"writable")},writableHighWaterMark:{__proto__:null,...a(l.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...a(l.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...a(l.prototype,"writableBuffer")},writableLength:{__proto__:null,...a(l.prototype,"writableLength")},writableFinished:{__proto__:null,...a(l.prototype,"writableFinished")},writableCorked:{__proto__:null,...a(l.prototype,"writableCorked")},writableEnded:{__proto__:null,...a(l.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...a(l.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set(e){this._readableState&&this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}}),c.fromWeb=function(e,t){return p().newStreamDuplexFromReadableWritablePair(e,t)},c.toWeb=function(e){return p().newReadableWritablePairFromDuplex(e)},c.from=function(e){return d||(d=r(6706)),d(e,"body")}},3407:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.AsfUtil=void 0;const a=r(1028),i=r(6378);class o{static getParserForAttr(e){return o.attributeParsers[e]}static parseUnicodeAttr(e){return i.stripNulls(i.decodeString(e,"utf16le"))}static parseByteArrayAttr(e){return n.from(e)}static parseBoolAttr(e,t=0){return 1===o.parseWordAttr(e,t)}static parseDWordAttr(e,t=0){return e.readUInt32LE(t)}static parseQWordAttr(e,t=0){return a.UINT64_LE.get(e,t)}static parseWordAttr(e,t=0){return e.readUInt16LE(t)}}o.attributeParsers=[o.parseUnicodeAttr,o.parseByteArrayAttr,o.parseBoolAttr,o.parseDWordAttr,o.parseQWordAttr,o.parseWordAttr,o.parseByteArrayAttr],t.AsfUtil=o},3512:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.hasID3v1Header=t.ID3v1Parser=t.Genres=void 0;const a=r(7833),i=r(1028),o=r(6378),s=r(6373),l=r(9156),c=(0,a.default)("music-metadata:parser:ID3v1");t.Genres=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","Alt. Rock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta Rap","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast-Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","JPop","Synthpop","Abstract","Art Rock","Baroque","Bhangra","Big Beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math Rock","New Romantic","Nu-Breakz","Post-Punk","Post-Rock","Psytrance","Shoegaze","Space Rock","Trop Rock","World Music","Neoclassical","Audiobook","Audio Theatre","Neue Deutsche Welle","Podcast","Indie Rock","G-Funk","Dubstep","Garage Rock","Psybient"];const u={len:128,get:(e,t)=>{const r=new d(3).get(e,t);return"TAG"===r?{header:r,title:new d(30).get(e,t+3),artist:new d(30).get(e,t+33),album:new d(30).get(e,t+63),year:new d(4).get(e,t+93),comment:new d(28).get(e,t+97),zeroByte:i.UINT8.get(e,t+127),track:i.UINT8.get(e,t+126),genre:i.UINT8.get(e,t+127)}:null}};class d extends i.StringType{constructor(e){super(e,"binary")}get(e,t){let r=super.get(e,t);return r=o.trimRightNull(r),r=r.trim(),r.length>0?r:void 0}}class p extends s.BasicParser{static getGenre(e){if(e<t.Genres.length)return t.Genres[e]}async parse(){if(!this.tokenizer.fileInfo.size)return void c("Skip checking for ID3v1 because the file-size is unknown");if(this.options.apeHeader){this.tokenizer.ignore(this.options.apeHeader.offset-this.tokenizer.position);const e=new l.APEv2Parser;e.init(this.metadata,this.tokenizer,this.options),await e.parseTags(this.options.apeHeader.footer)}const e=this.tokenizer.fileInfo.size-u.len;if(this.tokenizer.position>e)return void c("Already consumed the last 128 bytes");const t=await this.tokenizer.readToken(u,e);if(t){c("ID3v1 header found at: pos=%s",this.tokenizer.fileInfo.size-u.len);for(const e of["title","artist","album","comment","track","year"])t[e]&&""!==t[e]&&this.addTag(e,t[e]);const e=p.getGenre(t.genre);e&&this.addTag("genre",e)}else c("ID3v1 header not found at: pos=%s",this.tokenizer.fileInfo.size-u.len)}addTag(e,t){this.metadata.addTag("ID3v1",e,t)}}t.ID3v1Parser=p,t.hasID3v1Header=async function(e){if(e.fileSize>=128){const t=n.alloc(3);return await e.randomRead(t,0,t.length,e.fileSize-128),"TAG"===t.toString("binary")}return!1}},3515:(e,t,r)=>{const n=r(5606),{aggregateTwoErrors:a,codes:{ERR_MULTIPLE_CALLBACK:i},AbortError:o}=r(6371),{Symbol:s}=r(4134),{kIsDestroyed:l,isDestroyed:c,isFinished:u,isServerRequest:d}=r(6115),p=s("kDestroy"),f=s("kConstruct");function h(e,t,r){e&&(e.stack,t&&!t.errored&&(t.errored=e),r&&!r.errored&&(r.errored=e))}function m(e,t,r){let a=!1;function i(t){if(a)return;a=!0;const i=e._readableState,o=e._writableState;h(t,o,i),o&&(o.closed=!0),i&&(i.closed=!0),"function"==typeof r&&r(t),t?n.nextTick(g,e,t):n.nextTick(y,e)}try{e._destroy(t||null,i)}catch(t){i(t)}}function g(e,t){b(e,t),y(e)}function y(e){const t=e._readableState,r=e._writableState;r&&(r.closeEmitted=!0),t&&(t.closeEmitted=!0),(null!=r&&r.emitClose||null!=t&&t.emitClose)&&e.emit("close")}function b(e,t){const r=e._readableState,n=e._writableState;null!=n&&n.errorEmitted||null!=r&&r.errorEmitted||(n&&(n.errorEmitted=!0),r&&(r.errorEmitted=!0),e.emit("error",t))}function w(e,t,r){const a=e._readableState,i=e._writableState;if(null!=i&&i.destroyed||null!=a&&a.destroyed)return this;null!=a&&a.autoDestroy||null!=i&&i.autoDestroy?e.destroy(t):t&&(t.stack,i&&!i.errored&&(i.errored=t),a&&!a.errored&&(a.errored=t),r?n.nextTick(b,e,t):b(e,t))}function T(e){let t=!1;function r(r){if(t)return void w(e,null!=r?r:new i);t=!0;const a=e._readableState,o=e._writableState,s=o||a;a&&(a.constructed=!0),o&&(o.constructed=!0),s.destroyed?e.emit(p,r):r?w(e,r,!0):n.nextTick(v,e)}try{e._construct(e=>{n.nextTick(r,e)})}catch(e){n.nextTick(r,e)}}function v(e){e.emit(f)}function _(e){return(null==e?void 0:e.setHeader)&&"function"==typeof e.abort}function E(e){e.emit("close")}function S(e,t){e.emit("error",t),n.nextTick(E,e)}e.exports={construct:function(e,t){if("function"!=typeof e._construct)return;const r=e._readableState,a=e._writableState;r&&(r.constructed=!1),a&&(a.constructed=!1),e.once(f,t),e.listenerCount(f)>1||n.nextTick(T,e)},destroyer:function(e,t){e&&!c(e)&&(t||u(e)||(t=new o),d(e)?(e.socket=null,e.destroy(t)):_(e)?e.abort():_(e.req)?e.req.abort():"function"==typeof e.destroy?e.destroy(t):"function"==typeof e.close?e.close():t?n.nextTick(S,e,t):n.nextTick(E,e),e.destroyed||(e[l]=!0))},destroy:function(e,t){const r=this._readableState,n=this._writableState,i=n||r;return null!=n&&n.destroyed||null!=r&&r.destroyed?("function"==typeof t&&t(),this):(h(e,n,r),n&&(n.destroyed=!0),r&&(r.destroyed=!0),i.constructed?m(this,e,t):this.once(p,function(r){m(this,a(r,e),t)}),this)},undestroy:function(){const e=this._readableState,t=this._writableState;e&&(e.constructed=!0,e.closed=!1,e.closeEmitted=!1,e.destroyed=!1,e.errored=null,e.errorEmitted=!1,e.reading=!1,e.ended=!1===e.readable,e.endEmitted=!1===e.readable),t&&(t.constructed=!0,t.destroyed=!1,t.closed=!1,t.closeEmitted=!1,t.errored=null,t.errorEmitted=!1,t.finalCalled=!1,t.prefinished=!1,t.ended=!1===t.writable,t.ending=!1===t.writable,t.finished=!1===t.writable)},errorOrDestroy:w}},3571:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.FrameParser=t.parseGenre=void 0;const a=r(7833),i=r(1028),o=r(6378),s=r(2298),l=r(3512),c=(0,a.default)("music-metadata:id3v2:frame-parser"),u="latin1";function d(e){const t=[];let r,n="";for(const a of e)if("string"==typeof r)if("("===a&&""===r)n+="(",r=void 0;else if(")"===a){""!==n&&(t.push(n),n="");const e=p(r);e&&t.push(e),r=void 0}else r+=a;else"("===a?r="":n+=a;return n&&(0===t.length&&n.match(/^\d*$/)&&(n=l.Genres[n]),t.push(n)),t}function p(e){return"RX"===e?"Remix":"CR"===e?"Cover":e.match(/^\d*$/)?l.Genres[e]:void 0}t.parseGenre=d;class f{constructor(e,t){this.major=e,this.warningCollector=t}readData(e,t,r){if(0===e.length)return void this.warningCollector.addWarning(`id3v2.${this.major} header has empty tag type=${t}`);const{encoding:a,bom:l}=s.TextEncodingToken.get(e,0),p=e.length;let h=0,m=[];const g=f.getNullTerminatorLength(a);let y;const b={};switch(c(`Parsing tag type=${t}, encoding=${a}, bom=${l}`),"TXXX"!==t&&"T"===t[0]?"T*":t){case"T*":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":let l;try{l=o.decodeString(e.slice(1),a).replace(/\x00+$/,"")}catch(e){this.warningCollector.addWarning(`id3v2.${this.major} type=${t} header has invalid string value: ${e.message}`)}switch(t){case"TMCL":case"TIPL":case"IPLS":m=this.splitValue(t,l),m=f.functionList(m);break;case"TRK":case"TRCK":case"TPOS":m=l;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":m=this.splitValue(t,l);break;case"TCO":case"TCON":m=this.splitValue(t,l).map(e=>d(e)).reduce((e,t)=>e.concat(t),[]);break;case"PCS":case"PCST":m=this.major>=4?this.splitValue(t,l):[l],m=Array.isArray(m)&&""===m[0]?1:0;break;default:m=this.major>=4?this.splitValue(t,l):[l]}break;case"TXXX":m=f.readIdentifierAndData(e,h+1,p,a),m={description:m.id,text:this.splitValue(t,o.decodeString(m.data,a).replace(/\x00+$/,""))};break;case"PIC":case"APIC":if(r){const t={};switch(h+=1,this.major){case 2:t.format=o.decodeString(e.slice(h,h+3),"latin1"),h+=3;break;case 3:case 4:y=o.findZero(e,h,p,u),t.format=o.decodeString(e.slice(h,y),u),h=y+1;break;default:throw new Error("Warning: unexpected major versionIndex: "+this.major)}t.format=f.fixPictureMimeType(t.format),t.type=s.AttachedPictureType[e[h]],h+=1,y=o.findZero(e,h,p,a),t.description=o.decodeString(e.slice(h,y),a),h=y+g,t.data=n.from(e.slice(h,p)),m=t}break;case"CNT":case"PCNT":m=i.UINT32_BE.get(e,0);break;case"SYLT":for(h+=7,m=[];h<p;){const t=e.slice(h,h=o.findZero(e,h,p,a));h+=5,m.push(o.decodeString(t,a))}break;case"ULT":case"USLT":case"COM":case"COMM":h+=1,b.language=o.decodeString(e.slice(h,h+3),u),h+=3,y=o.findZero(e,h,p,a),b.description=o.decodeString(e.slice(h,y),a),h=y+g,b.text=o.decodeString(e.slice(h,p),a).replace(/\x00+$/,""),m=[b];break;case"UFID":m=f.readIdentifierAndData(e,h,p,u),m={owner_identifier:m.id,identifier:m.data};break;case"PRIV":m=f.readIdentifierAndData(e,h,p,u),m={owner_identifier:m.id,data:m.data};break;case"POPM":y=o.findZero(e,h,p,u);const w=o.decodeString(e.slice(h,y),u);h=y+1;const T=p-h;m={email:w,rating:i.UINT8.get(e,h),counter:T>=5?i.UINT32_BE.get(e,h+1):void 0};break;case"GEOB":{y=o.findZero(e,h+1,p,a);const t=o.decodeString(e.slice(h+1,y),u);h=y+1,y=o.findZero(e,h,p-h,a);const r=o.decodeString(e.slice(h,y),u);h=y+1,y=o.findZero(e,h,p-h,a),m={type:t,filename:r,description:o.decodeString(e.slice(h,y),u),data:e.slice(h+1,p)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":m=o.decodeString(e.slice(h,y),u);break;case"WXXX":{y=o.findZero(e,h+1,p,a);const t=o.decodeString(e.slice(h+1,y),a);h=y+("utf16le"===a?2:1),m={description:t,url:o.decodeString(e.slice(h,p),u)};break}case"WFD":case"WFED":m=o.decodeString(e.slice(h+1,o.findZero(e,h+1,p,a)),a);break;case"MCDI":m=e.slice(0,p);break;default:c("Warning: unsupported id3v2-tag-type: "+t)}return m}static fixPictureMimeType(e){switch(e=e.toLocaleLowerCase()){case"jpg":return"image/jpeg";case"png":return"image/png"}return e}static functionList(e){const t={};for(let r=0;r+1<e.length;r+=2){const n=e[r+1].split(",");t[e[r]]=t.hasOwnProperty(e[r])?t[e[r]].concat(n):n}return t}splitValue(e,t){let r;return this.major<4?(r=t.split(/\x00/g),r.length>1?this.warningCollector.addWarning(`ID3v2.${this.major} ${e} uses non standard null-separator.`):r=t.split(/\//g)):r=t.split(/\x00/g),f.trimArray(r)}static trimArray(e){return e.map(e=>e.replace(/\x00+$/,"").trim())}static readIdentifierAndData(e,t,r,n){const a=o.findZero(e,t,r,n),i=o.decodeString(e.slice(t,a),n);return t=a+f.getNullTerminatorLength(n),{id:i,data:e.slice(t,r)}}static getNullTerminatorLength(e){return"utf16le"===e?2:1}}t.FrameParser=f},3595:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.getLyricsHeaderLength=t.endTag2=void 0,t.endTag2="LYRICS200",t.getLyricsHeaderLength=async function(e){if(e.fileSize>=143){const r=n.alloc(15);await e.randomRead(r,0,r.length,e.fileSize-143);const a=r.toString("binary");if(a.substr(6)===t.endTag2)return parseInt(a.substr(0,6),10)+15}return 0}},3674:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WavPack=void 0;const n=r(1028),a=r(3232),i=[6e3,8e3,9600,11025,12e3,16e3,22050,24e3,32e3,44100,48e3,64e3,88200,96e3,192e3,-1];class o{static isBitSet(e,t){return 1===o.getBitAllignedNumber(e,t,1)}static getBitAllignedNumber(e,t,r){return e>>>t&4294967295>>>32-r}}o.BlockHeaderToken={len:32,get:(e,t)=>{const r=n.UINT32_LE.get(e,t+24),s={BlockID:a.FourCcToken.get(e,t),blockSize:n.UINT32_LE.get(e,t+4),version:n.UINT16_LE.get(e,t+8),totalSamples:n.UINT32_LE.get(e,t+12),blockIndex:n.UINT32_LE.get(e,t+16),blockSamples:n.UINT32_LE.get(e,t+20),flags:{bitsPerSample:8*(1+o.getBitAllignedNumber(r,0,2)),isMono:o.isBitSet(r,2),isHybrid:o.isBitSet(r,3),isJointStereo:o.isBitSet(r,4),crossChannel:o.isBitSet(r,5),hybridNoiseShaping:o.isBitSet(r,6),floatingPoint:o.isBitSet(r,7),samplingRate:i[o.getBitAllignedNumber(r,23,4)],isDSD:o.isBitSet(r,31)},crc:new n.Uint8ArrayType(4).get(e,t+28)};return s.flags.isDSD&&(s.totalSamples*=8),s}},o.MetadataIdToken={len:1,get:(e,t)=>({functionId:o.getBitAllignedNumber(e[t],0,6),isOptional:o.isBitSet(e[t],5),isOddSize:o.isBitSet(e[t],6),largeBlock:o.isBitSet(e[t],7)})},t.WavPack=o},3814:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ID3v24TagMapper=void 0;const n=r(8872),a=r(4151),i=r(6378),o={TIT2:"title",TPE1:"artist","TXXX:Artists":"artists",TPE2:"albumartist",TALB:"album",TDRV:"date",TORY:"originalyear",TPOS:"disk",TCON:"genre",APIC:"picture",TCOM:"composer","USLT:description":"lyrics",TSOA:"albumsort",TSOT:"titlesort",TOAL:"originalalbum",TSOP:"artistsort",TSO2:"albumartistsort",TSOC:"composersort",TEXT:"lyricist","TXXX:Writer":"writer",TPE3:"conductor",TPE4:"remixer","IPLS:arranger":"arranger","IPLS:engineer":"engineer","IPLS:producer":"producer","IPLS:DJ-mix":"djmixer","IPLS:mix":"mixer",TPUB:"label",TIT1:"grouping",TIT3:"subtitle",TRCK:"track",TCMP:"compilation",POPM:"rating",TBPM:"bpm",TMED:"media","TXXX:CATALOGNUMBER":"catalognumber","TXXX:MusicBrainz Album Status":"releasestatus","TXXX:MusicBrainz Album Type":"releasetype","TXXX:MusicBrainz Album Release Country":"releasecountry","TXXX:RELEASECOUNTRY":"releasecountry","TXXX:SCRIPT":"script",TLAN:"language",TCOP:"copyright",WCOP:"license",TENC:"encodedby",TSSE:"encodersettings","TXXX:BARCODE":"barcode","TXXX:ISRC":"isrc",TSRC:"isrc","TXXX:ASIN":"asin","TXXX:originalyear":"originalyear","UFID:http://musicbrainz.org":"musicbrainz_recordingid","TXXX:MusicBrainz Release Track Id":"musicbrainz_trackid","TXXX:MusicBrainz Album Id":"musicbrainz_albumid","TXXX:MusicBrainz Artist Id":"musicbrainz_artistid","TXXX:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","TXXX:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","TXXX:MusicBrainz Work Id":"musicbrainz_workid","TXXX:MusicBrainz TRM Id":"musicbrainz_trmid","TXXX:MusicBrainz Disc Id":"musicbrainz_discid","TXXX:ACOUSTID_ID":"acoustid_id","TXXX:Acoustid Id":"acoustid_id","TXXX:Acoustid Fingerprint":"acoustid_fingerprint","TXXX:MusicIP PUID":"musicip_puid","TXXX:MusicMagic Fingerprint":"musicip_fingerprint",WOAR:"website",TDRC:"date",TYER:"year",TDOR:"originaldate","TIPL:arranger":"arranger","TIPL:engineer":"engineer","TIPL:producer":"producer","TIPL:DJ-mix":"djmixer","TIPL:mix":"mixer",TMOO:"mood",SYLT:"lyrics",TSST:"discsubtitle",TKEY:"key",COMM:"comment",TOPE:"originalartist","PRIV:AverageLevel":"averageLevel","PRIV:PeakLevel":"peakLevel","TXXX:DISCOGS_ARTIST_ID":"discogs_artist_id","TXXX:DISCOGS_ARTISTS":"artists","TXXX:DISCOGS_ARTIST_NAME":"artists","TXXX:DISCOGS_ALBUM_ARTISTS":"albumartist","TXXX:DISCOGS_CATALOG":"catalognumber","TXXX:DISCOGS_COUNTRY":"releasecountry","TXXX:DISCOGS_DATE":"originaldate","TXXX:DISCOGS_LABEL":"label","TXXX:DISCOGS_LABEL_ID":"discogs_label_id","TXXX:DISCOGS_MASTER_RELEASE_ID":"discogs_master_release_id","TXXX:DISCOGS_RATING":"discogs_rating","TXXX:DISCOGS_RELEASED":"date","TXXX:DISCOGS_RELEASE_ID":"discogs_release_id","TXXX:DISCOGS_VOTES":"discogs_votes","TXXX:CATALOGID":"catalognumber","TXXX:STYLE":"genre","TXXX:REPLAYGAIN_TRACK_PEAK":"replaygain_track_peak","TXXX:REPLAYGAIN_TRACK_GAIN":"replaygain_track_gain","TXXX:REPLAYGAIN_ALBUM_PEAK":"replaygain_album_peak","TXXX:REPLAYGAIN_ALBUM_GAIN":"replaygain_album_gain","TXXX:MP3GAIN_MINMAX":"replaygain_track_minmax","TXXX:MP3GAIN_ALBUM_MINMAX":"replaygain_album_minmax","TXXX:MP3GAIN_UNDO":"replaygain_undo",MVNM:"movement",MVIN:"movementIndex",PCST:"podcast",TCAT:"category",TDES:"description",TDRL:"date",TGID:"podcastId",TKWD:"keywords",WFED:"podcasturl"};class s extends a.CaseInsensitiveTagMap{static toRating(e){return{source:e.email,rating:e.rating>0?(e.rating-1)/254*n.CommonTagMapper.maxRatingScore:void 0}}constructor(){super(["ID3v2.3","ID3v2.4"],o)}postMap(e,t){switch(e.id){case"UFID":"http://musicbrainz.org"===e.value.owner_identifier&&(e.id+=":"+e.value.owner_identifier,e.value=i.decodeString(e.value.identifier,"latin1"));break;case"PRIV":switch(e.value.owner_identifier){case"AverageLevel":case"PeakValue":e.id+=":"+e.value.owner_identifier,e.value=4===e.value.data.length?e.value.data.readUInt32LE(0):null,null===e.value&&t.addWarning("Failed to parse PRIV:PeakValue");break;default:t.addWarning(`Unknown PRIV owner-identifier: ${e.value.owner_identifier}`)}break;case"COMM":e.value=e.value?e.value.text:null;break;case"POPM":e.value=s.toRating(e.value)}}}t.ID3v24TagMapper=s},3960:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.MpegParser=void 0;const a=r(1028),i=r(5534),o=r(7833),s=r(6378),l=r(7270),c=r(9128),u=(0,o.default)("music-metadata:parser:mpeg"),d={AudioObjectTypes:["AAC Main","AAC LC","AAC SSR","AAC LTP"],SamplingFrequencies:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,void 0,void 0,-1]},p=[void 0,["front-center"],["front-left","front-right"],["front-center","front-left","front-right"],["front-center","front-left","front-right","back-center"],["front-center","front-left","front-right","back-left","back-right"],["front-center","front-left","front-right","back-left","back-right","LFE-channel"],["front-center","front-left","front-right","side-left","side-right","back-left","back-right","LFE-channel"]];class f{constructor(e,t){this.versionIndex=s.getBitAllignedNumber(e,t+1,3,2),this.layer=f.LayerDescription[s.getBitAllignedNumber(e,t+1,5,2)],this.versionIndex>1&&0===this.layer?this.parseAdtsHeader(e,t):this.parseMpegHeader(e,t),this.isProtectedByCRC=!s.isBitSet(e,t+1,7)}calcDuration(e){return e*this.calcSamplesPerFrame()/this.samplingRate}calcSamplesPerFrame(){return f.samplesInFrameTable[1===this.version?0:1][this.layer]}calculateSideInfoLength(){if(3!==this.layer)return 2;if(3===this.channelModeIndex){if(1===this.version)return 17;if(2===this.version||2.5===this.version)return 9}else{if(1===this.version)return 32;if(2===this.version||2.5===this.version)return 17}}calcSlotSize(){return[null,4,1,1][this.layer]}parseMpegHeader(e,t){this.container="MPEG",this.bitrateIndex=s.getBitAllignedNumber(e,t+2,0,4),this.sampRateFreqIndex=s.getBitAllignedNumber(e,t+2,4,2),this.padding=s.isBitSet(e,t+2,6),this.privateBit=s.isBitSet(e,t+2,7),this.channelModeIndex=s.getBitAllignedNumber(e,t+3,0,2),this.modeExtension=s.getBitAllignedNumber(e,t+3,2,2),this.isCopyrighted=s.isBitSet(e,t+3,4),this.isOriginalMedia=s.isBitSet(e,t+3,5),this.emphasis=s.getBitAllignedNumber(e,t+3,7,2),this.version=f.VersionID[this.versionIndex],this.channelMode=f.ChannelMode[this.channelModeIndex],this.codec=`MPEG ${this.version} Layer ${this.layer}`;const r=this.calcBitrate();if(!r)throw new Error("Cannot determine bit-rate");if(this.bitrate=1e3*r,this.samplingRate=this.calcSamplingRate(),null==this.samplingRate)throw new Error("Cannot determine sampling-rate")}parseAdtsHeader(e,t){u("layer=0 => ADTS"),this.version=2===this.versionIndex?4:2,this.container="ADTS/MPEG-"+this.version;const r=s.getBitAllignedNumber(e,t+2,0,2);this.codec="AAC",this.codecProfile=d.AudioObjectTypes[r],u(`MPEG-4 audio-codec=${this.codec}`);const n=s.getBitAllignedNumber(e,t+2,2,4);this.samplingRate=d.SamplingFrequencies[n],u(`sampling-rate=${this.samplingRate}`);const a=s.getBitAllignedNumber(e,t+2,7,3);this.mp4ChannelConfig=p[a],u(`channel-config=${this.mp4ChannelConfig.join("+")}`),this.frameLength=s.getBitAllignedNumber(e,t+3,6,2)<<11}calcBitrate(){if(0===this.bitrateIndex||15===this.bitrateIndex)return;const e=`${Math.floor(this.version)}${this.layer}`;return f.bitrate_index[this.bitrateIndex][e]}calcSamplingRate(){return 3===this.sampRateFreqIndex?null:f.sampling_rate_freq_index[this.version][this.sampRateFreqIndex]}}f.SyncByte1=255,f.SyncByte2=224,f.VersionID=[2.5,null,2,1],f.LayerDescription=[0,3,2,1],f.ChannelMode=["stereo","joint_stereo","dual_channel","mono"],f.bitrate_index={1:{11:32,12:32,13:32,21:32,22:8,23:8},2:{11:64,12:48,13:40,21:48,22:16,23:16},3:{11:96,12:56,13:48,21:56,22:24,23:24},4:{11:128,12:64,13:56,21:64,22:32,23:32},5:{11:160,12:80,13:64,21:80,22:40,23:40},6:{11:192,12:96,13:80,21:96,22:48,23:48},7:{11:224,12:112,13:96,21:112,22:56,23:56},8:{11:256,12:128,13:112,21:128,22:64,23:64},9:{11:288,12:160,13:128,21:144,22:80,23:80},10:{11:320,12:192,13:160,21:160,22:96,23:96},11:{11:352,12:224,13:192,21:176,22:112,23:112},12:{11:384,12:256,13:224,21:192,22:128,23:128},13:{11:416,12:320,13:256,21:224,22:144,23:144},14:{11:448,12:384,13:320,21:256,22:160,23:160}},f.sampling_rate_freq_index={1:{0:44100,1:48e3,2:32e3},2:{0:22050,1:24e3,2:16e3},2.5:{0:11025,1:12e3,2:8e3}},f.samplesInFrameTable=[[0,384,1152,1152],[0,384,1152,576]];class h extends l.AbstractID3Parser{constructor(){super(...arguments),this.frameCount=0,this.syncFrameCount=-1,this.countSkipFrameData=0,this.totalDataLength=0,this.bitrates=[],this.calculateEofDuration=!1,this.buf_frame_header=n.alloc(4),this.syncPeek={buf:n.alloc(1024),len:0}}async postId3v2Parse(){this.metadata.setFormat("lossless",!1);try{let e=!1;for(;!e;)await this.sync(),e=await this.parseCommonMpegHeader()}catch(e){if(!(e instanceof i.EndOfStreamError))throw e;if(u("End-of-stream"),this.calculateEofDuration){const e=this.frameCount*this.samplesPerFrame;this.metadata.setFormat("numberOfSamples",e);const t=e/this.metadata.format.sampleRate;u(`Calculate duration at EOF: ${t} sec.`,t),this.metadata.setFormat("duration",t)}}}finalize(){const e=this.metadata.format,t=this.metadata.native.hasOwnProperty("ID3v1");if(e.duration&&this.tokenizer.fileInfo.size){const r=this.tokenizer.fileInfo.size-this.mpegOffset-(t?128:0);e.codecProfile&&"V"===e.codecProfile[0]&&this.metadata.setFormat("bitrate",8*r/e.duration)}else if(this.tokenizer.fileInfo.size&&"CBR"===e.codecProfile){const r=this.tokenizer.fileInfo.size-this.mpegOffset-(t?128:0),n=Math.round(r/this.frame_size)*this.samplesPerFrame;this.metadata.setFormat("numberOfSamples",n);const a=n/e.sampleRate;u("Calculate CBR duration based on file size: %s",a),this.metadata.setFormat("duration",a)}}async sync(){let e=!1;for(;;){let t=0;if(this.syncPeek.len=await this.tokenizer.peekBuffer(this.syncPeek.buf,{length:1024,mayBeLess:!0}),this.syncPeek.len<=163)throw new i.EndOfStreamError;for(;;){if(e&&!(224&~this.syncPeek.buf[t]))return this.buf_frame_header[0]=f.SyncByte1,this.buf_frame_header[1]=this.syncPeek.buf[t],await this.tokenizer.ignore(t),u(`Sync at offset=${this.tokenizer.position-1}, frameCount=${this.frameCount}`),this.syncFrameCount===this.frameCount&&(u(`Re-synced MPEG stream, frameCount=${this.frameCount}`),this.frameCount=0,this.frame_size=0),void(this.syncFrameCount=this.frameCount);if(e=!1,t=this.syncPeek.buf.indexOf(f.SyncByte1,t),-1===t){if(this.syncPeek.len<this.syncPeek.buf.length)throw new i.EndOfStreamError;await this.tokenizer.ignore(this.syncPeek.len);break}++t,e=!0}}}async parseCommonMpegHeader(){let e;0===this.frameCount&&(this.mpegOffset=this.tokenizer.position-1),await this.tokenizer.peekBuffer(this.buf_frame_header,{offset:1,length:3});try{t=this.buf_frame_header,e=new f(t,0)}catch(e){return await this.tokenizer.ignore(1),this.metadata.addWarning("Parse error: "+e.message),!1}var t;return await this.tokenizer.ignore(3),this.metadata.setFormat("container",e.container),this.metadata.setFormat("codec",e.codec),this.metadata.setFormat("lossless",!1),this.metadata.setFormat("sampleRate",e.samplingRate),this.frameCount++,e.version>=2&&0===e.layer?this.parseAdts(e):this.parseAudioFrameHeader(e)}async parseAudioFrameHeader(e){this.metadata.setFormat("numberOfChannels","mono"===e.channelMode?1:2),this.metadata.setFormat("bitrate",e.bitrate),this.frameCount<2e5&&u("offset=%s MP%s bitrate=%s sample-rate=%s",this.tokenizer.position-4,e.layer,e.bitrate,e.samplingRate);const t=e.calcSlotSize();if(null===t)throw new Error("invalid slot_size");const r=e.calcSamplesPerFrame();u(`samples_per_frame=${r}`);const n=r/8*e.bitrate/e.samplingRate+(e.padding?t:0);if(this.frame_size=Math.floor(n),this.audioFrameHeader=e,this.bitrates.push(e.bitrate),1===this.frameCount)return this.offset=4,await this.skipSideInformation(),!1;if(3===this.frameCount){if(this.areAllSame(this.bitrates)){if(this.samplesPerFrame=r,this.metadata.setFormat("codecProfile","CBR"),this.tokenizer.fileInfo.size)return!0}else if(this.metadata.format.duration)return!0;if(!this.options.duration)return!0}return this.options.duration&&4===this.frameCount&&(this.samplesPerFrame=r,this.calculateEofDuration=!0),this.offset=4,e.isProtectedByCRC?(await this.parseCrc(),!1):(await this.skipSideInformation(),!1)}async parseAdts(e){const t=n.alloc(3);await this.tokenizer.readBuffer(t),e.frameLength+=s.getBitAllignedNumber(t,0,0,11),this.totalDataLength+=e.frameLength,this.samplesPerFrame=1024;const r=e.samplingRate/this.samplesPerFrame,a=8*(0===this.frameCount?0:this.totalDataLength/this.frameCount)*r+.5;if(this.metadata.setFormat("bitrate",a),u(`frame-count=${this.frameCount}, size=${e.frameLength} bytes, bit-rate=${a}`),await this.tokenizer.ignore(e.frameLength>7?e.frameLength-7:1),3===this.frameCount){if(this.metadata.setFormat("codecProfile",e.codecProfile),e.mp4ChannelConfig&&this.metadata.setFormat("numberOfChannels",e.mp4ChannelConfig.length),!this.options.duration)return!0;this.calculateEofDuration=!0}return!1}async parseCrc(){return this.crc=await this.tokenizer.readNumber(a.INT16_BE),this.offset+=2,this.skipSideInformation()}async skipSideInformation(){const e=this.audioFrameHeader.calculateSideInfoLength();await this.tokenizer.readToken(new a.Uint8ArrayType(e)),this.offset+=e,await this.readXtraInfoHeader()}async readXtraInfoHeader(){const e=await this.tokenizer.readToken(c.InfoTagHeaderTag);switch(this.offset+=c.InfoTagHeaderTag.len,e){case"Info":return this.metadata.setFormat("codecProfile","CBR"),this.readXingInfoHeader();case"Xing":const e=(t=(await this.readXingInfoHeader()).vbrScale,"V"+Math.floor((100-t)/10));return this.metadata.setFormat("codecProfile",e),null;case"Xtra":break;case"LAME":const r=await this.tokenizer.readToken(c.LameEncoderVersion);if(this.frame_size>=this.offset+c.LameEncoderVersion.len)return this.offset+=c.LameEncoderVersion.len,this.metadata.setFormat("tool","LAME "+r),await this.skipFrameData(this.frame_size-this.offset),null;this.metadata.addWarning("Corrupt LAME header")}var t;const r=this.frame_size-this.offset;return r<0?this.metadata.addWarning("Frame "+this.frameCount+"corrupt: negative frameDataLeft"):await this.skipFrameData(r),null}async readXingInfoHeader(){const e=this.tokenizer.position,t=await(0,c.readXingHeader)(this.tokenizer);if(this.offset+=this.tokenizer.position-e,t.lame&&(this.metadata.setFormat("tool","LAME "+s.stripNulls(t.lame.version)),t.lame.extended&&(this.metadata.setFormat("trackPeakLevel",t.lame.extended.track_peak),t.lame.extended.track_gain&&this.metadata.setFormat("trackGain",t.lame.extended.track_gain.adjustment),t.lame.extended.album_gain&&this.metadata.setFormat("albumGain",t.lame.extended.album_gain.adjustment),this.metadata.setFormat("duration",t.lame.extended.music_length/1e3))),t.streamSize){const e=this.audioFrameHeader.calcDuration(t.numFrames);return this.metadata.setFormat("duration",e),u("Get duration from Xing header: %s",this.metadata.format.duration),t}const r=this.frame_size-this.offset;return await this.skipFrameData(r),t}async skipFrameData(e){if(e<0)throw new Error("frame-data-left cannot be negative");await this.tokenizer.ignore(e),this.countSkipFrameData+=e}areAllSame(e){const t=e[0];return e.every(e=>e===t)}}t.MpegParser=h},4082:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AIFFParser=void 0;const n=r(1028),a=r(7833),i=r(5534),o=r(8344),s=r(3232),l=r(6373),c=r(4432),u=r(7636),d=(0,a.default)("music-metadata:parser:aiff"),p={NONE:"not compressed\tPCM\tApple Computer",sowt:"PCM (byte swapped)",fl32:"32-bit floating point IEEE 32-bit float",fl64:"64-bit floating point IEEE 64-bit float\tApple Computer",alaw:"ALaw 2:1\t8-bit ITU-T G.711 A-law",ulaw:"Law 2:1\t8-bit ITU-T G.711 -law\tApple Computer",ULAW:"CCITT G.711 u-law 8-bit ITU-T G.711 -law",ALAW:"CCITT G.711 A-law 8-bit ITU-T G.711 A-law",FL32:"Float 32\tIEEE 32-bit float "};class f extends l.BasicParser{async parse(){if("FORM"!==(await this.tokenizer.readToken(u.Header)).chunkID)throw new Error("Invalid Chunk-ID, expected 'FORM'");const e=await this.tokenizer.readToken(s.FourCcToken);switch(e){case"AIFF":this.metadata.setFormat("container",e),this.isCompressed=!1;break;case"AIFC":this.metadata.setFormat("container","AIFF-C"),this.isCompressed=!0;break;default:throw Error("Unsupported AIFF type: "+e)}this.metadata.setFormat("lossless",!this.isCompressed);try{for(;!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=u.Header.len;){d("Reading AIFF chunk at offset="+this.tokenizer.position);const e=await this.tokenizer.readToken(u.Header),t=2*Math.round(e.chunkSize/2),r=await this.readData(e);await this.tokenizer.ignore(t-r)}}catch(e){if(!(e instanceof i.EndOfStreamError))throw e;d("End-of-stream")}}async readData(e){var t;switch(e.chunkID){case"COMM":const r=await this.tokenizer.readToken(new c.Common(e,this.isCompressed));return this.metadata.setFormat("bitsPerSample",r.sampleSize),this.metadata.setFormat("sampleRate",r.sampleRate),this.metadata.setFormat("numberOfChannels",r.numChannels),this.metadata.setFormat("numberOfSamples",r.numSampleFrames),this.metadata.setFormat("duration",r.numSampleFrames/r.sampleRate),this.metadata.setFormat("codec",null!==(t=r.compressionName)&&void 0!==t?t:p[r.compressionType]),e.chunkSize;case"ID3 ":const a=await this.tokenizer.readToken(new n.Uint8ArrayType(e.chunkSize)),s=i.fromBuffer(a);return await(new o.ID3v2Parser).parse(this.metadata,s,this.options),e.chunkSize;case"SSND":return this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*e.chunkSize/this.metadata.format.duration),0;case"NAME":case"AUTH":case"(c) ":case"ANNO":return this.readTextChunk(e);default:return d(`Ignore chunk id=${e.chunkID}, size=${e.chunkSize}`),0}}async readTextChunk(e){return(await this.tokenizer.readToken(new n.StringType(e.chunkSize,"ascii"))).split("\0").map(e=>e.trim()).filter(e=>e&&e.length>0).forEach(t=>{this.metadata.addTag("AIFF",e.chunkID,t.trim())}),e.chunkSize}}t.AIFFParser=f},4134:e=>{class t extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError("Expected input to be an Array, got "+typeof e);let t="";for(let r=0;r<e.length;r++)t+=`    ${e[r].stack}\n`;super(t),this.name="AggregateError",this.errors=e}}e.exports={AggregateError:t,ArrayIsArray:e=>Array.isArray(e),ArrayPrototypeIncludes:(e,t)=>e.includes(t),ArrayPrototypeIndexOf:(e,t)=>e.indexOf(t),ArrayPrototypeJoin:(e,t)=>e.join(t),ArrayPrototypeMap:(e,t)=>e.map(t),ArrayPrototypePop:(e,t)=>e.pop(t),ArrayPrototypePush:(e,t)=>e.push(t),ArrayPrototypeSlice:(e,t,r)=>e.slice(t,r),Error,FunctionPrototypeCall:(e,t,...r)=>e.call(t,...r),FunctionPrototypeSymbolHasInstance:(e,t)=>Function.prototype[Symbol.hasInstance].call(e,t),MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties:(e,t)=>Object.defineProperties(e,t),ObjectDefineProperty:(e,t,r)=>Object.defineProperty(e,t,r),ObjectGetOwnPropertyDescriptor:(e,t)=>Object.getOwnPropertyDescriptor(e,t),ObjectKeys:e=>Object.keys(e),ObjectSetPrototypeOf:(e,t)=>Object.setPrototypeOf(e,t),Promise,PromisePrototypeCatch:(e,t)=>e.catch(t),PromisePrototypeThen:(e,t,r)=>e.then(t,r),PromiseReject:e=>Promise.reject(e),PromiseResolve:e=>Promise.resolve(e),ReflectApply:Reflect.apply,RegExpPrototypeTest:(e,t)=>e.test(t),SafeSet:Set,String,StringPrototypeSlice:(e,t,r)=>e.slice(t,r),StringPrototypeToLowerCase:e=>e.toLowerCase(),StringPrototypeToUpperCase:e=>e.toUpperCase(),StringPrototypeTrim:e=>e.trim(),Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet:(e,t,r)=>e.set(t,r),Boolean,Uint8Array}},4147:(e,t,r)=>{const{SymbolDispose:n}=r(4134),{AbortError:a,codes:i}=r(6371),{isNodeStream:o,isWebStream:s,kControllerErrorFunction:l}=r(6115),c=r(6238),{ERR_INVALID_ARG_TYPE:u}=i;let d;e.exports.addAbortSignal=function(t,r){if((e=>{if("object"!=typeof e||!("aborted"in e))throw new u("signal","AbortSignal",e)})(t),!o(r)&&!s(r))throw new u("stream",["ReadableStream","WritableStream","Stream"],r);return e.exports.addAbortSignalNoValidate(t,r)},e.exports.addAbortSignalNoValidate=function(e,t){if("object"!=typeof e||!("aborted"in e))return t;const i=o(t)?()=>{t.destroy(new a(void 0,{cause:e.reason}))}:()=>{t[l](new a(void 0,{cause:e.reason}))};if(e.aborted)i();else{d=d||r(7760).addAbortListener;const a=d(e,i);c(t,a[n])}return t}},4151:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaseInsensitiveTagMap=void 0;const n=r(8872);class a extends n.CommonTagMapper{constructor(e,t){const r={};for(const e of Object.keys(t))r[e.toUpperCase()]=t[e];super(e,r)}getCommonName(e){return this.tagMap[e.toUpperCase()]}}t.CaseInsensitiveTagMap=a},4256:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.WmPictureToken=t.MetadataLibraryObjectState=t.MetadataObjectState=t.ExtendedStreamPropertiesObjectState=t.ExtendedContentDescriptionObjectState=t.ContentDescriptionObjectState=t.readCodecEntries=t.HeaderExtensionObject=t.StreamPropertiesObject=t.FilePropertiesObject=t.IgnoreObjectState=t.State=t.HeaderObjectToken=t.TopLevelHeaderObjectToken=t.DataType=void 0;const a=r(6378),i=r(1028),o=r(2268),s=r(3407),l=r(2298);var c;(c=t.DataType||(t.DataType={}))[c.UnicodeString=0]="UnicodeString",c[c.ByteArray=1]="ByteArray",c[c.Bool=2]="Bool",c[c.DWord=3]="DWord",c[c.QWord=4]="QWord",c[c.Word=5]="Word",t.TopLevelHeaderObjectToken={len:30,get:(e,t)=>({objectId:o.default.fromBin(new i.BufferType(16).get(e,t)),objectSize:Number(i.UINT64_LE.get(e,t+16)),numberOfHeaderObjects:i.UINT32_LE.get(e,t+24)})},t.HeaderObjectToken={len:24,get:(e,t)=>({objectId:o.default.fromBin(new i.BufferType(16).get(e,t)),objectSize:Number(i.UINT64_LE.get(e,t+16))})};class u{constructor(e){this.len=Number(e.objectSize)-t.HeaderObjectToken.len}postProcessTag(e,t,r,n){if("WM/Picture"===t)e.push({id:t,value:E.fromBuffer(n)});else{const a=s.AsfUtil.getParserForAttr(r);if(!a)throw new Error("unexpected value headerType: "+r);e.push({id:t,value:a(n)})}}}t.State=u,t.IgnoreObjectState=class extends u{constructor(e){super(e)}get(e,t){return null}};class d extends u{constructor(e){super(e)}get(e,t){return{fileId:o.default.fromBin(e,t),fileSize:i.UINT64_LE.get(e,t+16),creationDate:i.UINT64_LE.get(e,t+24),dataPacketsCount:i.UINT64_LE.get(e,t+32),playDuration:i.UINT64_LE.get(e,t+40),sendDuration:i.UINT64_LE.get(e,t+48),preroll:i.UINT64_LE.get(e,t+56),flags:{broadcast:a.getBit(e,t+64,24),seekable:a.getBit(e,t+64,25)},minimumDataPacketSize:i.UINT32_LE.get(e,t+68),maximumDataPacketSize:i.UINT32_LE.get(e,t+72),maximumBitrate:i.UINT32_LE.get(e,t+76)}}}d.guid=o.default.FilePropertiesObject,t.FilePropertiesObject=d;class p extends u{constructor(e){super(e)}get(e,t){return{streamType:o.default.decodeMediaType(o.default.fromBin(e,t)),errorCorrectionType:o.default.fromBin(e,t+8)}}}p.guid=o.default.StreamPropertiesObject,t.StreamPropertiesObject=p;class f{constructor(){this.len=22}get(e,t){return{reserved1:o.default.fromBin(e,t),reserved2:e.readUInt16LE(t+16),extensionDataSize:e.readUInt32LE(t+18)}}}f.guid=o.default.HeaderExtensionObject,t.HeaderExtensionObject=f;const h={len:20,get:(e,t)=>({entryCount:e.readUInt16LE(t+16)})};async function m(e){const t=await e.readNumber(i.UINT16_LE);return(await e.readToken(new i.StringType(2*t,"utf16le"))).replace("\0","")}async function g(e){const t=await e.readNumber(i.UINT16_LE),r=n.alloc(t);return await e.readBuffer(r),r}async function y(e){const t=await e.readNumber(i.UINT16_LE);return{type:{videoCodec:!(1&~t),audioCodec:!(2&~t)},codecName:await m(e),description:await m(e),information:await g(e)}}t.readCodecEntries=async function(e){const t=await e.readToken(h),r=[];for(let n=0;n<t.entryCount;++n)r.push(await y(e));return r};class b extends u{constructor(e){super(e)}get(e,t){const r=[];let n=t+10;for(let a=0;a<b.contentDescTags.length;++a){const i=e.readUInt16LE(t+2*a);if(i>0){const t=b.contentDescTags[a],o=n+i;r.push({id:t,value:s.AsfUtil.parseUnicodeAttr(e.slice(n,o))}),n=o}}return r}}b.guid=o.default.ContentDescriptionObject,b.contentDescTags=["Title","Author","Copyright","Description","Rating"],t.ContentDescriptionObjectState=b;class w extends u{constructor(e){super(e)}get(e,t){const r=[],n=e.readUInt16LE(t);let a=t+2;for(let t=0;t<n;t+=1){const t=e.readUInt16LE(a);a+=2;const n=s.AsfUtil.parseUnicodeAttr(e.slice(a,a+t));a+=t;const i=e.readUInt16LE(a);a+=2;const o=e.readUInt16LE(a);a+=2;const l=e.slice(a,a+o);a+=o,this.postProcessTag(r,n,i,l)}return r}}w.guid=o.default.ExtendedContentDescriptionObject,t.ExtendedContentDescriptionObjectState=w;class T extends u{constructor(e){super(e)}get(e,t){return{startTime:i.UINT64_LE.get(e,t),endTime:i.UINT64_LE.get(e,t+8),dataBitrate:e.readInt32LE(t+12),bufferSize:e.readInt32LE(t+16),initialBufferFullness:e.readInt32LE(t+20),alternateDataBitrate:e.readInt32LE(t+24),alternateBufferSize:e.readInt32LE(t+28),alternateInitialBufferFullness:e.readInt32LE(t+32),maximumObjectSize:e.readInt32LE(t+36),flags:{reliableFlag:a.getBit(e,t+40,0),seekableFlag:a.getBit(e,t+40,1),resendLiveCleanpointsFlag:a.getBit(e,t+40,2)},streamNumber:e.readInt16LE(t+42),streamLanguageId:e.readInt16LE(t+44),averageTimePerFrame:e.readInt32LE(t+52),streamNameCount:e.readInt32LE(t+54),payloadExtensionSystems:e.readInt32LE(t+56),streamNames:[],streamPropertiesObject:null}}}T.guid=o.default.ExtendedStreamPropertiesObject,t.ExtendedStreamPropertiesObjectState=T;class v extends u{constructor(e){super(e)}get(e,t){const r=[],a=n.from(e),i=a.readUInt16LE(t);let o=t+2;for(let e=0;e<i;e+=1){o+=4;const e=a.readUInt16LE(o);o+=2;const t=a.readUInt16LE(o);o+=2;const n=a.readUInt32LE(o);o+=4;const i=s.AsfUtil.parseUnicodeAttr(a.slice(o,o+e));o+=e;const l=a.slice(o,o+n);o+=n,this.postProcessTag(r,i,t,l)}return r}}v.guid=o.default.MetadataObject,t.MetadataObjectState=v;class _ extends v{constructor(e){super(e)}}_.guid=o.default.MetadataLibraryObject,t.MetadataLibraryObjectState=_;class E{static fromBase64(e){return this.fromBuffer(n.from(e,"base64"))}static fromBuffer(e){return new E(e.length).get(e,0)}constructor(e){this.len=e}get(e,t){const r=e.readUInt8(t++),n=e.readInt32LE(t);let a=5;for(;0!==e.readUInt16BE(a);)a+=2;const i=e.slice(5,a).toString("utf16le");for(;0!==e.readUInt16BE(a);)a+=2;const o=e.slice(5,a).toString("utf16le");return{type:l.AttachedPictureType[r],format:i,description:o,size:n,data:e.slice(a+4)}}}t.WmPictureToken=E},4259:(e,t,r)=>{const{ArrayIsArray:n,ObjectSetPrototypeOf:a}=r(4134),{EventEmitter:i}=r(7007);function o(e){i.call(this,e)}function s(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?n(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}a(o.prototype,i.prototype),a(o,i),o.prototype.pipe=function(e,t){const r=this;function n(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function a(){r.readable&&r.resume&&r.resume()}r.on("data",n),e.on("drain",a),e._isStdio||t&&!1===t.end||(r.on("end",l),r.on("close",c));let o=!1;function l(){o||(o=!0,e.end())}function c(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){d(),0===i.listenerCount(this,"error")&&this.emit("error",e)}function d(){r.removeListener("data",n),e.removeListener("drain",a),r.removeListener("end",l),r.removeListener("close",c),r.removeListener("error",u),e.removeListener("error",u),r.removeListener("end",d),r.removeListener("close",d),e.removeListener("close",d)}return s(r,"error",u),s(e,"error",u),r.on("end",d),r.on("close",d),e.on("close",d),e.emit("pipe",r),e},e.exports={Stream:o,prependListener:s}},4272:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.OggParser=t.SegmentTable=void 0;const a=r(1028),i=r(5534),o=r(7833),s=r(6378),l=r(3232),c=r(6373),u=r(2668),d=r(8736),p=r(2724),f=r(4660),h=(0,o.default)("music-metadata:parser:ogg");class m{static sum(e,t,r){let n=0;for(let a=t;a<t+r;++a)n+=e[a];return n}constructor(e){this.len=e.page_segments}get(e,t){return{totalPageSize:m.sum(e,t,this.len)}}}t.SegmentTable=m;class g extends c.BasicParser{async parse(){h("pos=%s, parsePage()",this.tokenizer.position);try{let e;do{if(e=await this.tokenizer.readToken(g.Header),"OggS"!==e.capturePattern)throw new Error("Invalid Ogg capture pattern");this.metadata.setFormat("container","Ogg"),this.header=e,this.pageNumber=e.pageSequenceNo,h("page#=%s, Ogg.id=%s",e.pageSequenceNo,e.capturePattern);const t=await this.tokenizer.readToken(new m(e));h("totalPageSize=%s",t.totalPageSize);const r=await this.tokenizer.readToken(new a.Uint8ArrayType(t.totalPageSize));if(h("firstPage=%s, lastPage=%s, continued=%s",e.headerType.firstPage,e.headerType.lastPage,e.headerType.continued),e.headerType.firstPage){const e=new a.StringType(7,"ascii").get(n.from(r),0);switch(e){case"vorbis":h("Set page consumer to Ogg/Vorbis"),this.pageConsumer=new u.VorbisParser(this.metadata,this.options);break;case"OpusHea":h("Set page consumer to Ogg/Opus"),this.pageConsumer=new d.OpusParser(this.metadata,this.options,this.tokenizer);break;case"Speex  ":h("Set page consumer to Ogg/Speex"),this.pageConsumer=new p.SpeexParser(this.metadata,this.options,this.tokenizer);break;case"fishead":case"\0theora":h("Set page consumer to Ogg/Theora"),this.pageConsumer=new f.TheoraParser(this.metadata,this.options,this.tokenizer);break;default:throw new Error("gg audio-codec not recognized (id="+e+")")}}this.pageConsumer.parsePage(e,r)}while(!e.headerType.lastPage)}catch(e){if(e instanceof i.EndOfStreamError)this.metadata.addWarning("Last OGG-page is not marked with last-page flag"),h("End-of-stream"),this.metadata.addWarning("Last OGG-page is not marked with last-page flag"),this.header&&this.pageConsumer.calculateDuration(this.header);else{if(!e.message.startsWith("FourCC"))throw e;this.pageNumber>0&&(this.metadata.addWarning("Invalid FourCC ID, maybe last OGG-page is not marked with last-page flag"),this.pageConsumer.flush())}}}}g.Header={len:27,get:(e,t)=>({capturePattern:l.FourCcToken.get(e,t),version:a.UINT8.get(e,t+4),headerType:{continued:s.getBit(e,t+5,0),firstPage:s.getBit(e,t+5,1),lastPage:s.getBit(e,t+5,2)},absoluteGranulePosition:Number(a.UINT64_LE.get(e,t+6)),streamSerialNumber:a.UINT32_LE.get(e,t+14),pageSequenceNo:a.UINT32_LE.get(e,t+18),pageChecksum:a.UINT32_LE.get(e,t+22),page_segments:a.UINT8.get(e,t+26)})},t.OggParser=g},4432:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Common=void 0;const n=r(1028),a=r(3232);t.Common=class{constructor(e,t){this.isAifc=t;const r=t?22:18;if(e.chunkSize<r)throw new Error(`COMMON CHUNK size should always be at least ${r}`);this.len=e.chunkSize}get(e,t){const r=e.readUInt16BE(t+8)-16398,i=e.readUInt16BE(t+8+2),o={numChannels:e.readUInt16BE(t),numSampleFrames:e.readUInt32BE(t+2),sampleSize:e.readUInt16BE(t+6),sampleRate:r<0?i>>Math.abs(r):i<<r};if(this.isAifc){if(o.compressionType=a.FourCcToken.get(e,t+18),this.len>22){const r=e.readInt8(t+22);if(r>0){if(23+r+(r+1)%2!==this.len)throw new Error("Illegal pstring length");o.compressionName=new n.StringType(r,"binary").get(e,t+23)}else o.compressionName=void 0}}else o.compressionName="PCM";return o}}},4660:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TheoraParser=void 0;const n=r(7833),a=r(7143),i=(0,n.default)("music-metadata:parser:ogg:theora");t.TheoraParser=class{constructor(e,t,r){this.metadata=e,this.tokenizer=r}parsePage(e,t){e.headerType.firstPage&&this.parseFirstPage(e,t)}flush(){i("flush")}calculateDuration(e){i("duration calculation not implemented")}parseFirstPage(e,t){i("First Ogg/Theora page"),this.metadata.setFormat("codec","Theora");const r=a.IdentificationHeader.get(t,0);this.metadata.setFormat("bitrate",r.nombr)}}},4726:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isBitSet=t.parseTagFlags=t.TagField=t.TagItemHeader=t.TagFooter=t.Header=t.DescriptorParser=t.DataType=void 0;const n=r(1028),a=r(3232);var i;function o(e){return{containsHeader:s(e,31),containsFooter:s(e,30),isHeader:s(e,31),readOnly:s(e,0),dataType:(6&e)>>1}}function s(e,t){return!!(e&1<<t)}(i=t.DataType||(t.DataType={}))[i.text_utf8=0]="text_utf8",i[i.binary=1]="binary",i[i.external_info=2]="external_info",i[i.reserved=3]="reserved",t.DescriptorParser={len:52,get:(e,t)=>({ID:a.FourCcToken.get(e,t),version:n.UINT32_LE.get(e,t+4)/1e3,descriptorBytes:n.UINT32_LE.get(e,t+8),headerBytes:n.UINT32_LE.get(e,t+12),seekTableBytes:n.UINT32_LE.get(e,t+16),headerDataBytes:n.UINT32_LE.get(e,t+20),apeFrameDataBytes:n.UINT32_LE.get(e,t+24),apeFrameDataBytesHigh:n.UINT32_LE.get(e,t+28),terminatingDataBytes:n.UINT32_LE.get(e,t+32),fileMD5:new n.Uint8ArrayType(16).get(e,t+36)})},t.Header={len:24,get:(e,t)=>({compressionLevel:n.UINT16_LE.get(e,t),formatFlags:n.UINT16_LE.get(e,t+2),blocksPerFrame:n.UINT32_LE.get(e,t+4),finalFrameBlocks:n.UINT32_LE.get(e,t+8),totalFrames:n.UINT32_LE.get(e,t+12),bitsPerSample:n.UINT16_LE.get(e,t+16),channel:n.UINT16_LE.get(e,t+18),sampleRate:n.UINT32_LE.get(e,t+20)})},t.TagFooter={len:32,get:(e,t)=>({ID:new n.StringType(8,"ascii").get(e,t),version:n.UINT32_LE.get(e,t+8),size:n.UINT32_LE.get(e,t+12),fields:n.UINT32_LE.get(e,t+16),flags:o(n.UINT32_LE.get(e,t+20))})},t.TagItemHeader={len:8,get:(e,t)=>({size:n.UINT32_LE.get(e,t),flags:o(n.UINT32_LE.get(e,t+4))})},t.TagField=e=>new n.Uint8ArrayType(e.size-t.TagFooter.len),t.parseTagFlags=o,t.isBitSet=s},4824:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CombinedTagMapper=void 0;const n=r(7925),a=r(3814),i=r(8626),o=r(6664),s=r(1158),l=r(7802),c=r(7806),u=r(609),d=r(5896),p=r(5047);t.CombinedTagMapper=class{constructor(){this.tagMappers={},[new n.ID3v1TagMapper,new o.ID3v22TagMapper,new a.ID3v24TagMapper,new l.MP4TagMapper,new l.MP4TagMapper,new c.VorbisTagMapper,new s.APEv2TagMapper,new i.AsfTagMapper,new u.RiffInfoTagMapper,new d.MatroskaTagMapper,new p.AiffTagMapper].forEach(e=>{this.registerTagMapper(e)})}mapTag(e,t,r){if(this.tagMappers[e])return this.tagMappers[e].mapGenericTag(t,r);throw new Error("No generic tag mapper defined for tag-format: "+e)}registerTagMapper(e){for(const t of e.tagTypes)this.tagMappers[t]=e}}},5047:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AiffTagMapper=void 0;const n=r(8872),a={NAME:"title",AUTH:"artist","(c) ":"copyright",ANNO:"comment"};class i extends n.CommonTagMapper{constructor(){super(["AIFF"],a)}}t.AiffTagMapper=i},5056:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MpcSv7Parser=void 0;const n=r(7833),a=r(6373),i=r(9156),o=r(5279),s=r(7086),l=(0,n.default)("music-metadata:parser:musepack");class c extends a.BasicParser{constructor(){super(...arguments),this.audioLength=0}async parse(){const e=await this.tokenizer.readToken(s.Header);if("MP+"!==e.signature)throw new Error("Unexpected magic number");l(`stream-version=${e.streamMajorVersion}.${e.streamMinorVersion}`),this.metadata.setFormat("container","Musepack, SV7"),this.metadata.setFormat("sampleRate",e.sampleFrequency);const t=1152*(e.frameCount-1)+e.lastFrameLength;this.metadata.setFormat("numberOfSamples",t),this.duration=t/e.sampleFrequency,this.metadata.setFormat("duration",this.duration),this.bitreader=new o.BitReader(this.tokenizer),this.metadata.setFormat("numberOfChannels",e.midSideStereo||e.intensityStereo?2:1);const r=await this.bitreader.read(8);return this.metadata.setFormat("codec",(r/100).toFixed(2)),await this.skipAudioData(e.frameCount),l(`End of audio stream, switching to APEv2, offset=${this.tokenizer.position}`),i.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options)}async skipAudioData(e){for(;e-- >0;){const e=await this.bitreader.read(20);this.audioLength+=20+e,await this.bitreader.ignore(e)}const t=await this.bitreader.read(11);this.audioLength+=t,this.metadata.setFormat("bitrate",this.audioLength/this.duration)}}t.MpcSv7Parser=c},5279:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BitReader=void 0;const n=r(1028);t.BitReader=class{constructor(e){this.tokenizer=e,this.pos=0,this.dword=void 0}async read(e){for(;void 0===this.dword;)this.dword=await this.tokenizer.readToken(n.UINT32_LE);let t=this.dword;return this.pos+=e,this.pos<32?(t>>>=32-this.pos,t&(1<<e)-1):(this.pos-=32,0===this.pos?(this.dword=void 0,t&(1<<e)-1):(this.dword=await this.tokenizer.readToken(n.UINT32_LE),this.pos&&(t<<=this.pos,t|=this.dword>>>32-this.pos),t&(1<<e)-1))}async ignore(e){if(this.pos>0){const t=32-this.pos;this.dword=void 0,e-=t,this.pos=0}const t=e%32,r=(e-t)/32;return await this.tokenizer.ignore(4*r),this.read(t)}}},5291:(e,t,r)=>{const{MathFloor:n,NumberIsInteger:a}=r(4134),{validateInteger:i}=r(277),{ERR_INVALID_ARG_VALUE:o}=r(6371).codes;let s=16384,l=16;function c(e){return e?l:s}e.exports={getHighWaterMark:function(e,t,r,i){const s=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,i,r);if(null!=s){if(!a(s)||s<0)throw new o(i?`options.${r}`:"options.highWaterMark",s);return n(s)}return c(e.objectMode)},getDefaultHighWaterMark:c,setDefaultHighWaterMark:function(e,t){i(t,"value",0),e?l=t:s=t}}},5379:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RandomUint8ArrayReader=void 0,t.RandomUint8ArrayReader=class{constructor(e){this.uint8Array=e,this.fileSize=e.length}async randomRead(e,t,r,n){return e.set(this.uint8Array.subarray(n,n+r),t),r}}},5384:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChunkHeader64=void 0;const n=r(1028),a=r(3232);t.ChunkHeader64={len:12,get:(e,t)=>({chunkID:a.FourCcToken.get(e,t),chunkSize:n.INT64_BE.get(e,t+4)})}},5458:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=5458,e.exports=t},5506:(e,t,r)=>{const{Buffer:n}=r(8287),{ObjectDefineProperty:a,ObjectKeys:i,ReflectApply:o}=r(4134),{promisify:{custom:s}}=r(7760),{streamReturningOperators:l,promiseReturningOperators:c}=r(823),{codes:{ERR_ILLEGAL_CONSTRUCTOR:u}}=r(6371),d=r(7830),{setDefaultHighWaterMark:p,getDefaultHighWaterMark:f}=r(5291),{pipeline:h}=r(7758),{destroyer:m}=r(3515),g=r(6238),y=r(3095),b=r(6115),w=e.exports=r(4259).Stream;w.isDestroyed=b.isDestroyed,w.isDisturbed=b.isDisturbed,w.isErrored=b.isErrored,w.isReadable=b.isReadable,w.isWritable=b.isWritable,w.Readable=r(7576);for(const v of i(l)){const _=l[v];function E(...e){if(new.target)throw u();return w.Readable.from(o(_,this,e))}a(E,"name",{__proto__:null,value:_.name}),a(E,"length",{__proto__:null,value:_.length}),a(w.Readable.prototype,v,{__proto__:null,value:E,enumerable:!1,configurable:!0,writable:!0})}for(const S of i(c)){const I=c[S];function k(...e){if(new.target)throw u();return o(I,this,e)}a(k,"name",{__proto__:null,value:I.name}),a(k,"length",{__proto__:null,value:I.length}),a(w.Readable.prototype,S,{__proto__:null,value:k,enumerable:!1,configurable:!0,writable:!0})}w.Writable=r(8584),w.Duplex=r(3370),w.Transform=r(7382),w.PassThrough=r(6524),w.pipeline=h;const{addAbortSignal:T}=r(4147);w.addAbortSignal=T,w.finished=g,w.destroy=m,w.compose=d,w.setDefaultHighWaterMark=p,w.getDefaultHighWaterMark=f,a(w,"promises",{__proto__:null,configurable:!0,enumerable:!0,get:()=>y}),a(h,s,{__proto__:null,enumerable:!0,get:()=>y.pipeline}),a(g,s,{__proto__:null,enumerable:!0,get:()=>y.finished}),w.Stream=w,w._isUint8Array=function(e){return e instanceof Uint8Array},w._uint8ArrayToBuffer=function(e){return n.from(e.buffer,e.byteOffset,e.byteLength)}},5523:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EndOfStreamError=t.defaultMessages=void 0,t.defaultMessages="End-Of-Stream";class r extends Error{constructor(){super(t.defaultMessages)}}t.EndOfStreamError=r},5534:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fromBuffer=t.fromStream=t.EndOfStreamError=void 0;const n=r(6132),a=r(906);var i=r(8705);Object.defineProperty(t,"EndOfStreamError",{enumerable:!0,get:function(){return i.EndOfStreamError}}),t.fromStream=function(e,t){return t=t||{},new n.ReadStreamTokenizer(e,t)},t.fromBuffer=function(e,t){return new a.BufferTokenizer(e,t)}},5568:e=>{const{AbortController:t,AbortSignal:r}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0;e.exports=t,e.exports.AbortSignal=r,e.exports.default=t},5606:e=>{var t,r,n=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var s,l=[],c=!1,u=-1;function d(){c&&s&&(c=!1,s.length?l=s.concat(l):u=-1,l.length&&p())}function p(){if(!c){var e=o(d);c=!0;for(var t=l.length;t;){for(s=l,l=[];++u<t;)s&&s[u].run();u=-1,t=l.length}s=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function h(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new f(e,t)),1!==l.length||c||o(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=h,n.addListener=h,n.once=h,n.off=h,n.removeListener=h,n.removeAllListeners=h,n.emit=h,n.prependListener=h,n.prependOnceListener=h,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},5896:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MatroskaTagMapper=void 0;const n=r(4151),a={"segment:title":"title","album:ARTIST":"albumartist","album:ARTISTSORT":"albumartistsort","album:TITLE":"album","album:DATE_RECORDED":"originaldate","album:PART_NUMBER":"disk","album:TOTAL_PARTS":"totaltracks","track:ARTIST":"artist","track:ARTISTSORT":"artistsort","track:TITLE":"title","track:PART_NUMBER":"track","track:MUSICBRAINZ_TRACKID":"musicbrainz_recordingid","track:MUSICBRAINZ_ALBUMID":"musicbrainz_albumid","track:MUSICBRAINZ_ARTISTID":"musicbrainz_artistid","track:PUBLISHER":"label","track:GENRE":"genre","track:ENCODER":"encodedby","track:ENCODER_OPTIONS":"encodersettings","edition:TOTAL_PARTS":"totaldiscs",picture:"picture"};class i extends n.CaseInsensitiveTagMap{constructor(){super(["matroska"],a)}}t.MatroskaTagMapper=i},6015:(e,t,r)=>{t.Xs=t.wZ=void 0;const n=r(7833),a=r(6501),i=r(6943);n("music-metadata-browser:main");r(6501);t.wZ=a.parseStream,t.Xs=async function(e,r){const n={mimeType:e.type,size:e.size};return e instanceof File&&(n.path=e.name),async function(e,r,n){const a=new i.ReadableWebToNodeStream(e),o=await(0,t.wZ)(a,"string"==typeof r?{mimeType:r}:r,n);return await a.close(),o}(e.stream?e.stream():function(e){const t=new FileReader;return new ReadableStream({start(r){t.onloadend=e=>{let t=e.target.result;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),r.enqueue(t),r.close()},t.onerror=e=>{r.close()},t.onabort=e=>{r.close()},t.readAsArrayBuffer(e)}})}(e),{mimeType:e.type,size:e.size},r)}},6115:(e,t,r)=>{const{SymbolAsyncIterator:n,SymbolIterator:a,SymbolFor:i}=r(4134),o=i("nodejs.stream.destroyed"),s=i("nodejs.stream.errored"),l=i("nodejs.stream.readable"),c=i("nodejs.stream.writable"),u=i("nodejs.stream.disturbed"),d=i("nodejs.webstream.isClosedPromise"),p=i("nodejs.webstream.controllerErrorFunction");function f(e,t=!1){var r;return!(!e||"function"!=typeof e.pipe||"function"!=typeof e.on||t&&("function"!=typeof e.pause||"function"!=typeof e.resume)||e._writableState&&!1===(null===(r=e._readableState)||void 0===r?void 0:r.readable)||e._writableState&&!e._readableState)}function h(e){var t;return!(!e||"function"!=typeof e.write||"function"!=typeof e.on||e._readableState&&!1===(null===(t=e._writableState)||void 0===t?void 0:t.writable))}function m(e){return e&&(e._readableState||e._writableState||"function"==typeof e.write&&"function"==typeof e.on||"function"==typeof e.pipe&&"function"==typeof e.on)}function g(e){return!(!e||m(e)||"function"!=typeof e.pipeThrough||"function"!=typeof e.getReader||"function"!=typeof e.cancel)}function y(e){return!(!e||m(e)||"function"!=typeof e.getWriter||"function"!=typeof e.abort)}function b(e){return!(!e||m(e)||"object"!=typeof e.readable||"object"!=typeof e.writable)}function w(e){if(!m(e))return null;const t=e._writableState,r=e._readableState,n=t||r;return!!(e.destroyed||e[o]||null!=n&&n.destroyed)}function T(e){if(!h(e))return null;if(!0===e.writableEnded)return!0;const t=e._writableState;return(null==t||!t.errored)&&("boolean"!=typeof(null==t?void 0:t.ended)?null:t.ended)}function v(e,t){if(!f(e))return null;const r=e._readableState;return(null==r||!r.errored)&&("boolean"!=typeof(null==r?void 0:r.endEmitted)?null:!!(r.endEmitted||!1===t&&!0===r.ended&&0===r.length))}function _(e){return e&&null!=e[l]?e[l]:"boolean"!=typeof(null==e?void 0:e.readable)?null:!w(e)&&f(e)&&e.readable&&!v(e)}function E(e){return e&&null!=e[c]?e[c]:"boolean"!=typeof(null==e?void 0:e.writable)?null:!w(e)&&h(e)&&e.writable&&!T(e)}function S(e){return"boolean"==typeof e._closed&&"boolean"==typeof e._defaultKeepAlive&&"boolean"==typeof e._removedConnection&&"boolean"==typeof e._removedContLen}function I(e){return"boolean"==typeof e._sent100&&S(e)}e.exports={isDestroyed:w,kIsDestroyed:o,isDisturbed:function(e){var t;return!(!e||!(null!==(t=e[u])&&void 0!==t?t:e.readableDidRead||e.readableAborted))},kIsDisturbed:u,isErrored:function(e){var t,r,n,a,i,o,l,c,u,d;return!(!e||!(null!==(t=null!==(r=null!==(n=null!==(a=null!==(i=null!==(o=e[s])&&void 0!==o?o:e.readableErrored)&&void 0!==i?i:e.writableErrored)&&void 0!==a?a:null===(l=e._readableState)||void 0===l?void 0:l.errorEmitted)&&void 0!==n?n:null===(c=e._writableState)||void 0===c?void 0:c.errorEmitted)&&void 0!==r?r:null===(u=e._readableState)||void 0===u?void 0:u.errored)&&void 0!==t?t:null===(d=e._writableState)||void 0===d?void 0:d.errored))},kIsErrored:s,isReadable:_,kIsReadable:l,kIsClosedPromise:d,kControllerErrorFunction:p,kIsWritable:c,isClosed:function(e){if(!m(e))return null;if("boolean"==typeof e.closed)return e.closed;const t=e._writableState,r=e._readableState;return"boolean"==typeof(null==t?void 0:t.closed)||"boolean"==typeof(null==r?void 0:r.closed)?(null==t?void 0:t.closed)||(null==r?void 0:r.closed):"boolean"==typeof e._closed&&S(e)?e._closed:null},isDuplexNodeStream:function(e){return!(!e||"function"!=typeof e.pipe||!e._readableState||"function"!=typeof e.on||"function"!=typeof e.write)},isFinished:function(e,t){return m(e)?!(!w(e)&&(!1!==(null==t?void 0:t.readable)&&_(e)||!1!==(null==t?void 0:t.writable)&&E(e))):null},isIterable:function(e,t){return null!=e&&(!0===t?"function"==typeof e[n]:!1===t?"function"==typeof e[a]:"function"==typeof e[n]||"function"==typeof e[a])},isReadableNodeStream:f,isReadableStream:g,isReadableEnded:function(e){if(!f(e))return null;if(!0===e.readableEnded)return!0;const t=e._readableState;return!(!t||t.errored)&&("boolean"!=typeof(null==t?void 0:t.ended)?null:t.ended)},isReadableFinished:v,isReadableErrored:function(e){var t,r;return m(e)?e.readableErrored?e.readableErrored:null!==(t=null===(r=e._readableState)||void 0===r?void 0:r.errored)&&void 0!==t?t:null:null},isNodeStream:m,isWebStream:function(e){return g(e)||y(e)||b(e)},isWritable:E,isWritableNodeStream:h,isWritableStream:y,isWritableEnded:T,isWritableFinished:function(e,t){if(!h(e))return null;if(!0===e.writableFinished)return!0;const r=e._writableState;return(null==r||!r.errored)&&("boolean"!=typeof(null==r?void 0:r.finished)?null:!!(r.finished||!1===t&&!0===r.ended&&0===r.length))},isWritableErrored:function(e){var t,r;return m(e)?e.writableErrored?e.writableErrored:null!==(t=null===(r=e._writableState)||void 0===r?void 0:r.errored)&&void 0!==t?t:null:null},isServerRequest:function(e){var t;return"boolean"==typeof e._consuming&&"boolean"==typeof e._dumped&&void 0===(null===(t=e.req)||void 0===t?void 0:t.upgradeOrConnect)},isServerResponse:I,willEmitClose:function(e){if(!m(e))return null;const t=e._writableState,r=e._readableState,n=t||r;return!n&&I(e)||!!(n&&n.autoDestroy&&n.emitClose&&!1===n.closed)},isTransformStream:b}},6132:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReadStreamTokenizer=void 0;const n=r(9838),a=r(8705);class i extends n.AbstractTokenizer{constructor(e,t){super(t),this.streamReader=new a.StreamReader(e)}async getFileInfo(){return this.fileInfo}async readBuffer(e,t){const r=this.normalizeOptions(e,t),n=r.position-this.position;if(n>0)return await this.ignore(n),this.readBuffer(e,t);if(n<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(0===r.length)return 0;const i=await this.streamReader.read(e,r.offset,r.length);if(this.position+=i,(!t||!t.mayBeLess)&&i<r.length)throw new a.EndOfStreamError;return i}async peekBuffer(e,t){const r=this.normalizeOptions(e,t);let n=0;if(r.position){const t=r.position-this.position;if(t>0){const a=new Uint8Array(r.length+t);return n=await this.peekBuffer(a,{mayBeLess:r.mayBeLess}),e.set(a.subarray(t),r.offset),n-t}if(t<0)throw new Error("Cannot peek from a negative offset in a stream")}if(r.length>0){try{n=await this.streamReader.peek(e,r.offset,r.length)}catch(e){if(t&&t.mayBeLess&&e instanceof a.EndOfStreamError)return 0;throw e}if(!r.mayBeLess&&n<r.length)throw new a.EndOfStreamError}return n}async ignore(e){const t=Math.min(256e3,e),r=new Uint8Array(t);let n=0;for(;n<e;){const a=e-n,i=await this.readBuffer(r,{length:Math.min(t,a)});if(i<0)return i;n+=i}return n}}t.ReadStreamTokenizer=i},6185:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayGain=void 0;const n=r(6378);var a,i;!function(e){e[e.not_set=0]="not_set",e[e.radio=1]="radio",e[e.audiophile=2]="audiophile"}(a||(a={})),function(e){e[e.unspecified=0]="unspecified",e[e.engineer=1]="engineer",e[e.user=2]="user",e[e.automatic=3]="automatic",e[e.rms_average=4]="rms_average"}(i||(i={})),t.ReplayGain={len:2,get:(e,t)=>{const r=n.getBitAllignedNumber(e,t,0,3),a=n.getBitAllignedNumber(e,t,6,1),i=n.getBitAllignedNumber(e,t,7,9)/10;if(r>0)return{type:n.getBitAllignedNumber(e,t,0,3),origin:n.getBitAllignedNumber(e,t,3,3),adjustment:a?-i:i}}}},6238:(e,t,r)=>{const n=r(5606),{AbortError:a,codes:i}=r(6371),{ERR_INVALID_ARG_TYPE:o,ERR_STREAM_PREMATURE_CLOSE:s}=i,{kEmptyObject:l,once:c}=r(7760),{validateAbortSignal:u,validateFunction:d,validateObject:p,validateBoolean:f}=r(277),{Promise:h,PromisePrototypeThen:m,SymbolDispose:g}=r(4134),{isClosed:y,isReadable:b,isReadableNodeStream:w,isReadableStream:T,isReadableFinished:v,isReadableErrored:_,isWritable:E,isWritableNodeStream:S,isWritableStream:I,isWritableFinished:k,isWritableErrored:A,isNodeStream:C,willEmitClose:x,kIsClosedPromise:B}=r(6115);let D;const P=()=>{};function R(e,t,i){var f,h;if(2===arguments.length?(i=t,t=l):null==t?t=l:p(t,"options"),d(i,"callback"),u(t.signal,"options.signal"),i=c(i),T(e)||I(e))return function(e,t,i){let o=!1,s=P;if(t.signal)if(s=()=>{o=!0,i.call(e,new a(void 0,{cause:t.signal.reason}))},t.signal.aborted)n.nextTick(s);else{D=D||r(7760).addAbortListener;const n=D(t.signal,s),a=i;i=c((...t)=>{n[g](),a.apply(e,t)})}const l=(...t)=>{o||n.nextTick(()=>i.apply(e,t))};return m(e[B].promise,l,l),P}(e,t,i);if(!C(e))throw new o("stream",["ReadableStream","WritableStream","Stream"],e);const R=null!==(f=t.readable)&&void 0!==f?f:w(e),M=null!==(h=t.writable)&&void 0!==h?h:S(e),F=e._writableState,L=e._readableState,O=()=>{e.writable||z()};let N=x(e)&&w(e)===R&&S(e)===M,U=k(e,!1);const z=()=>{U=!0,e.destroyed&&(N=!1),(!N||e.readable&&!R)&&(R&&!j||i.call(e))};let j=v(e,!1);const W=()=>{j=!0,e.destroyed&&(N=!1),(!N||e.writable&&!M)&&(M&&!U||i.call(e))},$=t=>{i.call(e,t)};let H=y(e);const G=()=>{H=!0;const t=A(e)||_(e);return t&&"boolean"!=typeof t?i.call(e,t):R&&!j&&w(e,!0)&&!v(e,!1)?i.call(e,new s):!M||U||k(e,!1)?void i.call(e):i.call(e,new s)},X=()=>{H=!0;const t=A(e)||_(e);if(t&&"boolean"!=typeof t)return i.call(e,t);i.call(e)},V=()=>{e.req.on("finish",z)};!function(e){return e.setHeader&&"function"==typeof e.abort}(e)?M&&!F&&(e.on("end",O),e.on("close",O)):(e.on("complete",z),N||e.on("abort",G),e.req?V():e.on("request",V)),N||"boolean"!=typeof e.aborted||e.on("aborted",G),e.on("end",W),e.on("finish",z),!1!==t.error&&e.on("error",$),e.on("close",G),H?n.nextTick(G):null!=F&&F.errorEmitted||null!=L&&L.errorEmitted?N||n.nextTick(X):(R||N&&!b(e)||!U&&!1!==E(e))&&(M||N&&!E(e)||!j&&!1!==b(e))?L&&e.req&&e.aborted&&n.nextTick(X):n.nextTick(X);const q=()=>{i=P,e.removeListener("aborted",G),e.removeListener("complete",z),e.removeListener("abort",G),e.removeListener("request",V),e.req&&e.req.removeListener("finish",z),e.removeListener("end",O),e.removeListener("close",O),e.removeListener("finish",z),e.removeListener("end",W),e.removeListener("error",$),e.removeListener("close",G)};if(t.signal&&!H){const o=()=>{const r=i;q(),r.call(e,new a(void 0,{cause:t.signal.reason}))};if(t.signal.aborted)n.nextTick(o);else{D=D||r(7760).addAbortListener;const n=D(t.signal,o),a=i;i=c((...t)=>{n[g](),a.apply(e,t)})}}return q}e.exports=R,e.exports.finished=function(e,t){var r;let n=!1;return null===t&&(t=l),null!==(r=t)&&void 0!==r&&r.cleanup&&(f(t.cleanup,"cleanup"),n=t.cleanup),new h((r,a)=>{const i=R(e,t,e=>{n&&i(),e?a(e):r()})})}},6371:(e,t,r)=>{const{format:n,inspect:a}=r(9231),{AggregateError:i}=r(4134),o=globalThis.AggregateError||i,s=Symbol("kIsNodeError"),l=["string","function","number","object","Function","Object","boolean","bigint","symbol"],c=/^([A-Z][a-z0-9]*)+$/,u={};function d(e,t){if(!e)throw new u.ERR_INTERNAL_ASSERTION(t)}function p(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function f(e,t,r){r||(r=Error);class a extends r{constructor(...r){super(function(e,t,r){if("function"==typeof t)return d(t.length<=r.length,`Code: ${e}; The provided arguments length (${r.length}) does not match the required ones (${t.length}).`),t(...r);const a=(t.match(/%[dfijoOs]/g)||[]).length;return d(a===r.length,`Code: ${e}; The provided arguments length (${r.length}) does not match the required ones (${a}).`),0===r.length?t:n(t,...r)}(e,t,r))}toString(){return`${this.name} [${e}]: ${this.message}`}}Object.defineProperties(a.prototype,{name:{value:r.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${e}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),a.prototype.code=e,a.prototype[s]=!0,u[e]=a}function h(e){const t="__node_internal_"+e.name;return Object.defineProperty(e,"name",{value:t}),e}class m extends Error{constructor(e="The operation was aborted",t=void 0){if(void 0!==t&&"object"!=typeof t)throw new u.ERR_INVALID_ARG_TYPE("options","Object",t);super(e,t),this.code="ABORT_ERR",this.name="AbortError"}}f("ERR_ASSERTION","%s",Error),f("ERR_INVALID_ARG_TYPE",(e,t,r)=>{d("string"==typeof e,"'name' must be a string"),Array.isArray(t)||(t=[t]);let n="The ";e.endsWith(" argument")?n+=`${e} `:n+=`"${e}" ${e.includes(".")?"property":"argument"} `,n+="must be ";const i=[],o=[],s=[];for(const e of t)d("string"==typeof e,"All expected entries have to be of type string"),l.includes(e)?i.push(e.toLowerCase()):c.test(e)?o.push(e):(d("object"!==e,'The value "object" should be written as "Object"'),s.push(e));if(o.length>0){const e=i.indexOf("object");-1!==e&&(i.splice(i,e,1),o.push("Object"))}if(i.length>0){switch(i.length){case 1:n+=`of type ${i[0]}`;break;case 2:n+=`one of type ${i[0]} or ${i[1]}`;break;default:{const e=i.pop();n+=`one of type ${i.join(", ")}, or ${e}`}}(o.length>0||s.length>0)&&(n+=" or ")}if(o.length>0){switch(o.length){case 1:n+=`an instance of ${o[0]}`;break;case 2:n+=`an instance of ${o[0]} or ${o[1]}`;break;default:{const e=o.pop();n+=`an instance of ${o.join(", ")}, or ${e}`}}s.length>0&&(n+=" or ")}switch(s.length){case 0:break;case 1:s[0].toLowerCase()!==s[0]&&(n+="an "),n+=`${s[0]}`;break;case 2:n+=`one of ${s[0]} or ${s[1]}`;break;default:{const e=s.pop();n+=`one of ${s.join(", ")}, or ${e}`}}if(null==r)n+=`. Received ${r}`;else if("function"==typeof r&&r.name)n+=`. Received function ${r.name}`;else if("object"==typeof r){var u;null!==(u=r.constructor)&&void 0!==u&&u.name?n+=`. Received an instance of ${r.constructor.name}`:n+=`. Received ${a(r,{depth:-1})}`}else{let e=a(r,{colors:!1});e.length>25&&(e=`${e.slice(0,25)}...`),n+=`. Received type ${typeof r} (${e})`}return n},TypeError),f("ERR_INVALID_ARG_VALUE",(e,t,r="is invalid")=>{let n=a(t);return n.length>128&&(n=n.slice(0,128)+"..."),`The ${e.includes(".")?"property":"argument"} '${e}' ${r}. Received ${n}`},TypeError),f("ERR_INVALID_RETURN_VALUE",(e,t,r)=>{var n;return`Expected ${e} to be returned from the "${t}" function but got ${null!=r&&null!==(n=r.constructor)&&void 0!==n&&n.name?`instance of ${r.constructor.name}`:"type "+typeof r}.`},TypeError),f("ERR_MISSING_ARGS",(...e)=>{let t;d(e.length>0,"At least one arg needs to be specified");const r=e.length;switch(e=(Array.isArray(e)?e:[e]).map(e=>`"${e}"`).join(" or "),r){case 1:t+=`The ${e[0]} argument`;break;case 2:t+=`The ${e[0]} and ${e[1]} arguments`;break;default:{const r=e.pop();t+=`The ${e.join(", ")}, and ${r} arguments`}}return`${t} must be specified`},TypeError),f("ERR_OUT_OF_RANGE",(e,t,r)=>{let n;if(d(t,'Missing "range" argument'),Number.isInteger(r)&&Math.abs(r)>2**32)n=p(String(r));else if("bigint"==typeof r){n=String(r);const e=BigInt(2)**BigInt(32);(r>e||r<-e)&&(n=p(n)),n+="n"}else n=a(r);return`The value of "${e}" is out of range. It must be ${t}. Received ${n}`},RangeError),f("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),f("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),f("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),f("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),f("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),f("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),f("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),f("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),f("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),f("ERR_STREAM_WRITE_AFTER_END","write after end",Error),f("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),e.exports={AbortError:m,aggregateTwoErrors:h(function(e,t){if(e&&t&&e!==t){if(Array.isArray(t.errors))return t.errors.push(e),t;const r=new o([t,e],t.message);return r.code=t.code,r}return e||t}),hideStackFrames:h,codes:u}},6373:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BasicParser=void 0,t.BasicParser=class{init(e,t,r){return this.metadata=e,this.tokenizer=t,this.options=r,this}}},6378:(e,t,r)=>{var n=r(8287).Buffer;function a(e,t,r,n){const i=r%8;let o=e[t+~~(r/8)];o&=255>>i;const s=8-i,l=n-s;return l<0?o>>=8-i-n:l>0&&(o<<=l,o|=a(e,t,r+s,l)),o}function i(e){return 10*Math.log10(e)}function o(e){return Math.pow(10,e/10)}Object.defineProperty(t,"__esModule",{value:!0}),t.toRatio=t.dbToRatio=t.ratioToDb=t.a2hex=t.isBitSet=t.getBitAllignedNumber=t.stripNulls=t.decodeString=t.trimRightNull=t.findZero=t.getBit=void 0,t.getBit=function(e,t,r){return!!(e[t]&1<<r)},t.findZero=function(e,t,r,n){let a=t;if("utf16le"===n){for(;0!==e[a]||0!==e[a+1];){if(a>=r)return r;a+=2}return a}for(;0!==e[a];){if(a>=r)return r;a++}return a},t.trimRightNull=function(e){const t=e.indexOf("\0");return-1===t?e:e.substr(0,t)},t.decodeString=function e(t,r){if(255===t[0]&&254===t[1])return e(t.subarray(2),r);if("utf16le"===r&&254===t[0]&&255===t[1]){if(1&t.length)throw new Error("Expected even number of octets for 16-bit unicode string");return e(function(e){const t=e.length;if(1&t)throw new Error("Buffer length must be even");for(let r=0;r<t;r+=2){const t=e[r];e[r]=e[r+1],e[r+1]=t}return e}(t),r)}return n.from(t).toString(r)},t.stripNulls=function(e){return(e=e.replace(/^\x00+/g,"")).replace(/\x00+$/g,"")},t.getBitAllignedNumber=a,t.isBitSet=function(e,t,r){return 1===a(e,t,r,1)},t.a2hex=function(e){const t=[];for(let r=0,n=e.length;r<n;r++){const n=Number(e.charCodeAt(r)).toString(16);t.push(1===n.length?"0"+n:n)}return t.join(" ")},t.ratioToDb=i,t.dbToRatio=o,t.toRatio=function(e){const t=e.split(" ").map(e=>e.trim().toLowerCase());if(t.length>=1){const e=parseFloat(t[0]);return 2===t.length&&"db"===t[1]?{dB:e,ratio:o(e)}:{dB:i(e),ratio:e}}}},6501:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scanAppendingHeaders=t.selectCover=t.ratingToStars=t.orderTags=t.parseFromTokenizer=t.parseBuffer=t.parseStream=void 0;const n=r(5534),a=r(7727),i=r(5379),o=r(9156),s=r(3512),l=r(3595);function c(e,t){return a.ParserFactory.parseOnContentType(e,t)}async function u(e,t={}){let r=e.fileSize;await(0,s.hasID3v1Header)(e)&&(r-=128,r-=await(0,l.getLyricsHeaderLength)(e)),t.apeHeader=await o.APEv2Parser.findApeFooterOffset(e,r)}t.parseStream=function(e,t,r={}){return c(n.fromStream(e,"string"==typeof t?{mimeType:t}:t),r)},t.parseBuffer=async function(e,t,r={}){const a=new i.RandomUint8ArrayReader(e);return await u(a,r),c(n.fromBuffer(e,"string"==typeof t?{mimeType:t}:t),r)},t.parseFromTokenizer=c,t.orderTags=function(e){const t={};for(const r of e)(t[r.id]=t[r.id]||[]).push(r.value);return t},t.ratingToStars=function(e){return void 0===e?0:1+Math.round(4*e)},t.selectCover=function(e){return e?e.reduce((e,t)=>t.name&&t.name.toLowerCase()in["front","cover","cover (front)"]?t:e):null},t.scanAppendingHeaders=u},6524:(e,t,r)=>{const{ObjectSetPrototypeOf:n}=r(4134);e.exports=i;const a=r(7382);function i(e){if(!(this instanceof i))return new i(e);a.call(this,e)}n(i.prototype,a.prototype),n(i,a),i.prototype._transform=function(e,t,r){r(null,e)}},6532:(e,t,r)=>{const n=r(5606),{PromisePrototypeThen:a,SymbolAsyncIterator:i,SymbolIterator:o}=r(4134),{Buffer:s}=r(8287),{ERR_INVALID_ARG_TYPE:l,ERR_STREAM_NULL_VALUES:c}=r(6371).codes;e.exports=function(e,t,r){let u,d;if("string"==typeof t||t instanceof s)return new e({objectMode:!0,...r,read(){this.push(t),this.push(null)}});if(t&&t[i])d=!0,u=t[i]();else{if(!t||!t[o])throw new l("iterable",["Iterable"],t);d=!1,u=t[o]()}const p=new e({objectMode:!0,highWaterMark:1,...r});let f=!1;return p._read=function(){f||(f=!0,async function(){for(;;){try{const{value:e,done:t}=d?await u.next():u.next();if(t)p.push(null);else{const t=e&&"function"==typeof e.then?await e:e;if(null===t)throw f=!1,new c;if(p.push(t))continue;f=!1}}catch(e){p.destroy(e)}break}}())},p._destroy=function(e,t){a(async function(e){const t=null!=e,r="function"==typeof u.throw;if(t&&r){const{value:t,done:r}=await u.throw(e);if(await t,r)return}if("function"==typeof u.return){const{value:e}=await u.return();await e}}(e),()=>n.nextTick(t,e),r=>n.nextTick(t,r||e))},p}},6549:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BroadcastAudioExtensionChunk=void 0;const n=r(1028),a=r(6378);t.BroadcastAudioExtensionChunk={len:420,get:(e,t)=>({description:(0,a.stripNulls)(new n.StringType(256,"ascii").get(e,t)).trim(),originator:(0,a.stripNulls)(new n.StringType(32,"ascii").get(e,t+256)).trim(),originatorReference:(0,a.stripNulls)(new n.StringType(32,"ascii").get(e,t+288)).trim(),originationDate:(0,a.stripNulls)(new n.StringType(10,"ascii").get(e,t+320)).trim(),originationTime:(0,a.stripNulls)(new n.StringType(8,"ascii").get(e,t+330)).trim(),timeReferenceLow:n.UINT32_LE.get(e,t+338),timeReferenceHigh:n.UINT32_LE.get(e,t+342),version:n.UINT16_LE.get(e,t+346),umid:new n.Uint8ArrayType(64).get(e,t+348),loudnessValue:n.UINT16_LE.get(e,t+412),maxTruePeakLevel:n.UINT16_LE.get(e,t+414),maxMomentaryLoudness:n.UINT16_LE.get(e,t+416),maxShortTermLoudness:n.UINT16_LE.get(e,t+418)})}},6585:e=>{var t=1e3,r=60*t,n=60*r,a=24*n,i=7*a;function o(e,t,r,n){var a=t>=1.5*r;return Math.round(e/r)+" "+n+(a?"s":"")}e.exports=function(e,s){s=s||{};var l,c,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(o){var s=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return s*i;case"days":case"day":case"d":return s*a;case"hours":case"hour":case"hrs":case"hr":case"h":return s*n;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===u&&isFinite(e))return s.long?(l=e,(c=Math.abs(l))>=a?o(l,c,a,"day"):c>=n?o(l,c,n,"hour"):c>=r?o(l,c,r,"minute"):c>=t?o(l,c,t,"second"):l+" ms"):function(e){var i=Math.abs(e);return i>=a?Math.round(e/a)+"d":i>=n?Math.round(e/n)+"h":i>=r?Math.round(e/r)+"m":i>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},6664:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ID3v22TagMapper=t.id3v22TagMap=void 0;const n=r(4151);t.id3v22TagMap={TT2:"title",TP1:"artist",TP2:"albumartist",TAL:"album",TYE:"year",COM:"comment",TRK:"track",TPA:"disk",TCO:"genre",PIC:"picture",TCM:"composer",TOR:"originaldate",TOT:"originalalbum",TXT:"lyricist",TP3:"conductor",TPB:"label",TT1:"grouping",TT3:"subtitle",TLA:"language",TCR:"copyright",WCP:"license",TEN:"encodedby",TSS:"encodersettings",WAR:"website","COM:iTunPGAP":"gapless",PCS:"podcast",TCP:"compilation",TDR:"date",TS2:"albumartistsort",TSA:"albumsort",TSC:"composersort",TSP:"artistsort",TST:"titlesort",WFD:"podcasturl",TBP:"bpm"};class a extends n.CaseInsensitiveTagMap{constructor(){super(["ID3v2.2"],t.id3v22TagMap)}}t.ID3v22TagMapper=a},6706:(e,t,r)=>{const n=r(5606),a=r(8287),{isReadable:i,isWritable:o,isIterable:s,isNodeStream:l,isReadableNodeStream:c,isWritableNodeStream:u,isDuplexNodeStream:d,isReadableStream:p,isWritableStream:f}=r(6115),h=r(6238),{AbortError:m,codes:{ERR_INVALID_ARG_TYPE:g,ERR_INVALID_RETURN_VALUE:y}}=r(6371),{destroyer:b}=r(3515),w=r(3370),T=r(7576),v=r(8584),{createDeferredPromise:_}=r(7760),E=r(6532),S=globalThis.Blob||a.Blob,I=void 0!==S?function(e){return e instanceof S}:function(e){return!1},k=globalThis.AbortController||r(5568).AbortController,{FunctionPrototypeCall:A}=r(4134);class C extends w{constructor(e){super(e),!1===(null==e?void 0:e.readable)&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),!1===(null==e?void 0:e.writable)&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}function x(e){const t=e.readable&&"function"!=typeof e.readable.read?T.wrap(e.readable):e.readable,r=e.writable;let n,a,s,l,c,u=!!i(t),d=!!o(r);function p(e){const t=l;l=null,t?t(e):e&&c.destroy(e)}return c=new C({readableObjectMode:!(null==t||!t.readableObjectMode),writableObjectMode:!(null==r||!r.writableObjectMode),readable:u,writable:d}),d&&(h(r,e=>{d=!1,e&&b(t,e),p(e)}),c._write=function(e,t,a){r.write(e,t)?a():n=a},c._final=function(e){r.end(),a=e},r.on("drain",function(){if(n){const e=n;n=null,e()}}),r.on("finish",function(){if(a){const e=a;a=null,e()}})),u&&(h(t,e=>{u=!1,e&&b(t,e),p(e)}),t.on("readable",function(){if(s){const e=s;s=null,e()}}),t.on("end",function(){c.push(null)}),c._read=function(){for(;;){const e=t.read();if(null===e)return void(s=c._read);if(!c.push(e))return}}),c._destroy=function(e,i){e||null===l||(e=new m),s=null,n=null,a=null,null===l?i(e):(l=i,b(r,e),b(t,e))},c}e.exports=function e(t,r){if(d(t))return t;if(c(t))return x({readable:t});if(u(t))return x({writable:t});if(l(t))return x({writable:!1,readable:!1});if(p(t))return x({readable:T.fromWeb(t)});if(f(t))return x({writable:v.fromWeb(t)});if("function"==typeof t){const{value:e,write:a,final:i,destroy:o}=function(e){let{promise:t,resolve:r}=_();const a=new k,i=a.signal;return{value:e(async function*(){for(;;){const e=t;t=null;const{chunk:a,done:o,cb:s}=await e;if(n.nextTick(s),o)return;if(i.aborted)throw new m(void 0,{cause:i.reason});({promise:t,resolve:r}=_()),yield a}}(),{signal:i}),write(e,t,n){const a=r;r=null,a({chunk:e,done:!1,cb:n})},final(e){const t=r;r=null,t({done:!0,cb:e})},destroy(e,t){a.abort(),t(e)}}}(t);if(s(e))return E(C,e,{objectMode:!0,write:a,final:i,destroy:o});const l=null==e?void 0:e.then;if("function"==typeof l){let t;const r=A(l,e,e=>{if(null!=e)throw new y("nully","body",e)},e=>{b(t,e)});return t=new C({objectMode:!0,readable:!1,write:a,final(e){i(async()=>{try{await r,n.nextTick(e,null)}catch(t){n.nextTick(e,t)}})},destroy:o})}throw new y("Iterable, AsyncIterable or AsyncFunction",r,e)}if(I(t))return e(t.arrayBuffer());if(s(t))return E(C,t,{objectMode:!0,writable:!1});if(p(null==t?void 0:t.readable)&&f(null==t?void 0:t.writable))return C.fromWeb(t);if("object"==typeof(null==t?void 0:t.writable)||"object"==typeof(null==t?void 0:t.readable))return x({readable:null!=t&&t.readable?c(null==t?void 0:t.readable)?null==t?void 0:t.readable:e(t.readable):void 0,writable:null!=t&&t.writable?u(null==t?void 0:t.writable)?null==t?void 0:t.writable:e(t.writable):void 0});const a=null==t?void 0:t.then;if("function"==typeof a){let e;return A(a,t,t=>{null!=t&&e.push(t),e.push(null)},t=>{b(e,t)}),e=new C({objectMode:!0,writable:!1,read(){}})}throw new g(r,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],t)}},6879:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WaveParser=void 0;const n=r(5534),a=r(1028),i=r(7833),o=r(9090),s=r(9019),l=r(8344),c=r(6378),u=r(3232),d=r(6373),p=r(6549),f=(0,i.default)("music-metadata:parser:RIFF");class h extends d.BasicParser{async parse(){const e=await this.tokenizer.readToken(o.Header);if(f(`pos=${this.tokenizer.position}, parse: chunkID=${e.chunkID}`),"RIFF"===e.chunkID)return this.parseRiffChunk(e.chunkSize).catch(e=>{if(!(e instanceof n.EndOfStreamError))throw e})}async parseRiffChunk(e){const t=await this.tokenizer.readToken(u.FourCcToken);if(this.metadata.setFormat("container",t),"WAVE"===t)return this.readWaveChunk(e-u.FourCcToken.len);throw new Error(`Unsupported RIFF format: RIFF/${t}`)}async readWaveChunk(e){for(;e>=o.Header.len;){const t=await this.tokenizer.readToken(o.Header);switch(e-=o.Header.len+t.chunkSize,t.chunkSize>e&&this.metadata.addWarning("Data chunk size exceeds file size"),this.header=t,f(`pos=${this.tokenizer.position}, readChunk: chunkID=RIFF/WAVE/${t.chunkID}`),t.chunkID){case"LIST":await this.parseListTag(t);break;case"fact":this.metadata.setFormat("lossless",!1),this.fact=await this.tokenizer.readToken(new s.FactChunk(t));break;case"fmt ":const e=await this.tokenizer.readToken(new s.Format(t));let r=s.WaveFormat[e.wFormatTag];r||(f("WAVE/non-PCM format="+e.wFormatTag),r="non-PCM ("+e.wFormatTag+")"),this.metadata.setFormat("codec",r),this.metadata.setFormat("bitsPerSample",e.wBitsPerSample),this.metadata.setFormat("sampleRate",e.nSamplesPerSec),this.metadata.setFormat("numberOfChannels",e.nChannels),this.metadata.setFormat("bitrate",e.nBlockAlign*e.nSamplesPerSec*8),this.blockAlign=e.nBlockAlign;break;case"id3 ":case"ID3 ":const i=await this.tokenizer.readToken(new a.Uint8ArrayType(t.chunkSize)),o=n.fromBuffer(i);await(new l.ID3v2Parser).parse(this.metadata,o,this.options);break;case"data":!1!==this.metadata.format.lossless&&this.metadata.setFormat("lossless",!0);let c=t.chunkSize;if(this.tokenizer.fileInfo.size){const e=this.tokenizer.fileInfo.size-this.tokenizer.position;e<c&&(this.metadata.addWarning("data chunk length exceeding file length"),c=e)}const u=this.fact?this.fact.dwSampleLength:4294967295===c?void 0:c/this.blockAlign;u&&(this.metadata.setFormat("numberOfSamples",u),this.metadata.setFormat("duration",u/this.metadata.format.sampleRate)),"ADPCM"===this.metadata.format.codec?this.metadata.setFormat("bitrate",352e3):this.metadata.setFormat("bitrate",this.blockAlign*this.metadata.format.sampleRate*8),await this.tokenizer.ignore(t.chunkSize);break;case"bext":const d=await this.tokenizer.readToken(p.BroadcastAudioExtensionChunk);Object.keys(d).forEach(e=>{this.metadata.addTag("exif","bext."+e,d[e])});const h=t.chunkSize-p.BroadcastAudioExtensionChunk.len;await this.tokenizer.ignore(h);break;case"\0\0\0\0":f(`Ignore padding chunk: RIFF/${t.chunkID} of ${t.chunkSize} bytes`),this.metadata.addWarning("Ignore chunk: RIFF/"+t.chunkID),await this.tokenizer.ignore(t.chunkSize);break;default:f(`Ignore chunk: RIFF/${t.chunkID} of ${t.chunkSize} bytes`),this.metadata.addWarning("Ignore chunk: RIFF/"+t.chunkID),await this.tokenizer.ignore(t.chunkSize)}this.header.chunkSize%2==1&&(f("Read odd padding byte"),await this.tokenizer.ignore(1))}}async parseListTag(e){const t=await this.tokenizer.readToken(new a.StringType(4,"binary"));return f("pos=%s, parseListTag: chunkID=RIFF/WAVE/LIST/%s",this.tokenizer.position,t),"INFO"===t?this.parseRiffInfoTags(e.chunkSize-4):(this.metadata.addWarning("Ignore chunk: RIFF/WAVE/LIST/"+t),f("Ignoring chunkID=RIFF/WAVE/LIST/"+t),this.tokenizer.ignore(e.chunkSize-4).then())}async parseRiffInfoTags(e){for(;e>=8;){const t=await this.tokenizer.readToken(o.Header),r=new o.ListInfoTagValue(t),n=await this.tokenizer.readToken(r);this.addTag(t.chunkID,c.stripNulls(n)),e-=8+r.len}if(0!==e)throw Error("Illegal remaining size: "+e)}addTag(e,t){this.metadata.addTag("exif",e,t)}}t.WaveParser=h},6943:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReadableWebToNodeStream=void 0;const n=r(9198);class a extends n.Readable{constructor(e){super(),this.bytesRead=0,this.released=!1,this.reader=e.getReader()}_read(){this.released?this.push(null):this.pendingRead=this.reader.read().then(e=>{delete this.pendingRead,e.done||this.released?this.push(null):(this.bytesRead+=e.value.length,this.push(e.value))}).catch(e=>{this.destroy(e)})}async waitForReadToComplete(){this.pendingRead&&await this.pendingRead}async close(){await this.syncAndRelease()}async syncAndRelease(){this.released=!0,await this.waitForReadToComplete(),await this.reader.releaseLock()}}t.ReadableWebToNodeStream=a},7007:e=>{var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise(function(r,n){function a(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",a),r([].slice.call(arguments))}m(e,t,i,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,a)})},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function c(e,t,r,n){var a,i,o,c;if(s(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),o=i[t]),void 0===o)o=i[t]=r,++e._eventsCount;else if("function"==typeof o?o=i[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(a=l(e))>0&&o.length>a&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,c=u,console&&console.warn&&console.warn(c)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},a=u.bind(n);return a.listener=r,n.wrapFn=a,a}function p(e,t,r){var n=e._events;if(void 0===n)return[];var a=n[t];return void 0===a?[]:"function"==typeof a?r?[a.listener||a]:[a]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(a):h(a,a.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function h(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function m(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function a(i){n.once&&e.removeEventListener(t,a),r(i)})}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return l(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var a="error"===e,i=this._events;if(void 0!==i)a=a&&void 0===i.error;else if(!a)return!1;if(a){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var c=l.length,u=h(l,c);for(r=0;r<c;++r)n(u[r],this,t)}return!0},i.prototype.addListener=function(e,t){return c(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return c(this,e,t,!0)},i.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,n,a,i,o;if(s(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(a=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){o=r[i].listener,a=i;break}if(a<0)return this;0===a?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,a),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var a,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(a=i[n])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},i.prototype.listeners=function(e){return p(this,e,!0)},i.prototype.rawListeners=function(e){return p(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},i.prototype.listenerCount=f,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7086:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.Header=void 0;const a=r(1028),i=r(6378);t.Header={len:24,get:(e,t)=>{const r={signature:n.from(e).toString("latin1",t,t+3),streamMinorVersion:i.getBitAllignedNumber(e,t+3,0,4),streamMajorVersion:i.getBitAllignedNumber(e,t+3,4,4),frameCount:a.UINT32_LE.get(e,t+4),maxLevel:a.UINT16_LE.get(e,t+8),sampleFrequency:[44100,48e3,37800,32e3][i.getBitAllignedNumber(e,t+10,0,2)],link:i.getBitAllignedNumber(e,t+10,2,2),profile:i.getBitAllignedNumber(e,t+10,4,4),maxBand:i.getBitAllignedNumber(e,t+11,0,6),intensityStereo:i.isBitSet(e,t+11,6),midSideStereo:i.isBitSet(e,t+11,7),titlePeak:a.UINT16_LE.get(e,t+12),titleGain:a.UINT16_LE.get(e,t+14),albumPeak:a.UINT16_LE.get(e,t+16),albumGain:a.UINT16_LE.get(e,t+18),lastFrameLength:a.UINT32_LE.get(e,t+20)>>>20&2047,trueGapless:i.isBitSet(e,t+23,0)};return r.lastFrameLength=r.trueGapless?a.UINT32_LE.get(e,20)>>>20&2047:0,r}}},7143:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IdentificationHeader=void 0;const n=r(1028);t.IdentificationHeader={len:42,get:(e,t)=>({id:new n.StringType(7,"ascii").get(e,t),vmaj:e.readUInt8(t+7),vmin:e.readUInt8(t+8),vrev:e.readUInt8(t+9),vmbw:e.readUInt16BE(t+10),vmbh:e.readUInt16BE(t+17),nombr:n.UINT24_BE.get(e,t+37),nqual:e.readUInt8(t+40)})}},7270:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractID3Parser=void 0;const n=r(5534),a=r(7833),i=r(2298),o=r(8344),s=r(3512),l=r(6373),c=(0,a.default)("music-metadata:parser:ID3");class u extends l.BasicParser{constructor(){super(...arguments),this.id3parser=new o.ID3v2Parser}static async startsWithID3v2Header(e){return"ID3"===(await e.peekToken(i.ID3v2Header)).fileIdentifier}async parse(){try{await this.parseID3v2()}catch(e){if(!(e instanceof n.EndOfStreamError))throw e;c("End-of-stream")}}finalize(){}async parseID3v2(){if(await this.tryReadId3v2Headers(),c("End of ID3v2 header, go to MPEG-parser: pos=%s",this.tokenizer.position),await this.postId3v2Parse(),this.options.skipPostHeaders&&this.metadata.hasAny())this.finalize();else{const e=new s.ID3v1Parser;await e.init(this.metadata,this.tokenizer,this.options).parse(),this.finalize()}}async tryReadId3v2Headers(){if("ID3"===(await this.tokenizer.peekToken(i.ID3v2Header)).fileIdentifier)return c("Found ID3v2 header, pos=%s",this.tokenizer.position),await this.id3parser.parse(this.metadata,this.tokenizer,this.options),this.tryReadId3v2Headers()}}t.AbstractID3Parser=u},7338:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TrackType=void 0;var n=r(14);Object.defineProperty(t,"TrackType",{enumerable:!0,get:function(){return n.TrackType}})},7382:(e,t,r)=>{const{ObjectSetPrototypeOf:n,Symbol:a}=r(4134);e.exports=c;const{ERR_METHOD_NOT_IMPLEMENTED:i}=r(6371).codes,o=r(3370),{getHighWaterMark:s}=r(5291);n(c.prototype,o.prototype),n(c,o);const l=a("kCallback");function c(e){if(!(this instanceof c))return new c(e);const t=e?s(this,e,"readableHighWaterMark",!0):null;0===t&&(e={...e,highWaterMark:null,readableHighWaterMark:t,writableHighWaterMark:e.writableHighWaterMark||0}),o.call(this,e),this._readableState.sync=!1,this[l]=null,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function u(e){"function"!=typeof this._flush||this.destroyed?(this.push(null),e&&e()):this._flush((t,r)=>{t?e?e(t):this.destroy(t):(null!=r&&this.push(r),this.push(null),e&&e())})}function d(){this._final!==u&&u.call(this)}c.prototype._final=u,c.prototype._transform=function(e,t,r){throw new i("_transform()")},c.prototype._write=function(e,t,r){const n=this._readableState,a=this._writableState,i=n.length;this._transform(e,t,(e,t)=>{e?r(e):(null!=t&&this.push(t),a.ended||i===n.length||n.length<n.highWaterMark?r():this[l]=r)})},c.prototype._read=function(){if(this[l]){const e=this[l];this[l]=null,e()}}},7526:(e,t)=>{t.byteLength=function(e){var t=s(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,i=s(e),o=i[0],l=i[1],c=new a(function(e,t,r){return 3*(t+r)/4-r}(0,o,l)),u=0,d=l>0?o-4:o;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===l&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[u++]=255&t),1===l&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,a=n%3,i=[],o=16383,s=0,l=n-a;s<l;s+=o)i.push(c(e,s,s+o>l?l:s+o));return 1===a?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===a&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),i.join("")};for(var r=[],n=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)r[o]=i[o],n[i.charCodeAt(o)]=o;function s(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[63&e]}function c(e,t,r){for(var n,a=[],i=t;i<r;i+=3)n=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),a.push(l(n));return a.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},7550:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.ChapterText=t.StcoAtom=t.StszAtom=t.StscAtom=t.SampleToChunkToken=t.SttsAtom=t.TimeToSampleToken=t.SoundSampleDescriptionV0=t.SoundSampleDescriptionVersion=t.StsdAtom=t.TrackHeaderAtom=t.NameAtom=t.DataAtom=t.MvhdAtom=t.MdhdAtom=t.FixedLengthAtom=t.mhdr=t.tkhd=t.ftyp=t.ExtendedSize=t.Header=void 0;const a=r(1028),i=r(7833),o=r(3232),s=(0,i.default)("music-metadata:parser:MP4:atom");t.Header={len:8,get:(e,t)=>{const r=a.UINT32_BE.get(e,t);if(r<0)throw new Error("Invalid atom header length");return{length:BigInt(r),name:new a.StringType(4,"binary").get(e,t+4)}},put:(e,t,r)=>(a.UINT32_BE.put(e,t,Number(r.length)),o.FourCcToken.put(e,t+4,r.name))},t.ExtendedSize=a.UINT64_BE,t.ftyp={len:4,get:(e,t)=>({type:new a.StringType(4,"ascii").get(e,t)})},t.tkhd={len:4,get:(e,t)=>({type:new a.StringType(4,"ascii").get(e,t)})},t.mhdr={len:8,get:(e,t)=>({version:a.UINT8.get(e,t),flags:a.UINT24_BE.get(e,t+1),nextItemID:a.UINT32_BE.get(e,t+4)})};class l{constructor(e,t,r){if(this.len=e,e<t)throw new Error(`Atom ${r} expected to be ${t}, but specifies ${e} bytes long.`);e>t&&s(`Warning: atom ${r} expected to be ${t}, but was actually ${e} bytes long.`)}}t.FixedLengthAtom=l;const c=(e,t)=>{const r=a.UINT32_BE.get(e,t)-2082844800;return new Date(1e3*r)};t.MdhdAtom=class extends l{constructor(e){super(e,24,"mdhd"),this.len=e}get(e,t){return{version:a.UINT8.get(e,t+0),flags:a.UINT24_BE.get(e,t+1),creationTime:c(e,t+4),modificationTime:c(e,t+8),timeScale:a.UINT32_BE.get(e,t+12),duration:a.UINT32_BE.get(e,t+16),language:a.UINT16_BE.get(e,t+20),quality:a.UINT16_BE.get(e,t+22)}}},t.MvhdAtom=class extends l{constructor(e){super(e,100,"mvhd"),this.len=e}get(e,t){return{version:a.UINT8.get(e,t),flags:a.UINT24_BE.get(e,t+1),creationTime:c(e,t+4),modificationTime:c(e,t+8),timeScale:a.UINT32_BE.get(e,t+12),duration:a.UINT32_BE.get(e,t+16),preferredRate:a.UINT32_BE.get(e,t+20),preferredVolume:a.UINT16_BE.get(e,t+24),previewTime:a.UINT32_BE.get(e,t+72),previewDuration:a.UINT32_BE.get(e,t+76),posterTime:a.UINT32_BE.get(e,t+80),selectionTime:a.UINT32_BE.get(e,t+84),selectionDuration:a.UINT32_BE.get(e,t+88),currentTime:a.UINT32_BE.get(e,t+92),nextTrackID:a.UINT32_BE.get(e,t+96)}}},t.DataAtom=class{constructor(e){this.len=e}get(e,t){return{type:{set:a.UINT8.get(e,t+0),type:a.UINT24_BE.get(e,t+1)},locale:a.UINT24_BE.get(e,t+4),value:n.from(new a.Uint8ArrayType(this.len-8).get(e,t+8))}}},t.NameAtom=class{constructor(e){this.len=e}get(e,t){return{version:a.UINT8.get(e,t),flags:a.UINT24_BE.get(e,t+1),name:new a.StringType(this.len-4,"utf-8").get(e,t+4)}}},t.TrackHeaderAtom=class{constructor(e){this.len=e}get(e,t){return{version:a.UINT8.get(e,t),flags:a.UINT24_BE.get(e,t+1),creationTime:c(e,t+4),modificationTime:c(e,t+8),trackId:a.UINT32_BE.get(e,t+12),duration:a.UINT32_BE.get(e,t+20),layer:a.UINT16_BE.get(e,t+24),alternateGroup:a.UINT16_BE.get(e,t+26),volume:a.UINT16_BE.get(e,t+28)}}};class u{constructor(e){this.len=e}get(e,t){return{dataFormat:o.FourCcToken.get(e,t),dataReferenceIndex:a.UINT16_BE.get(e,t+10),description:new a.Uint8ArrayType(this.len-12).get(e,t+12)}}}t.StsdAtom=class{constructor(e){this.len=e}get(e,t){const r=((e,t)=>({version:a.UINT8.get(e,t),flags:a.UINT24_BE.get(e,t+1),numberOfEntries:a.UINT32_BE.get(e,t+4)}))(e,t);t+=8;const n=[];for(let i=0;i<r.numberOfEntries;++i){const r=a.UINT32_BE.get(e,t);t+=a.UINT32_BE.len,n.push(new u(r).get(e,t)),t+=r}return{header:r,table:n}}},t.SoundSampleDescriptionVersion={len:8,get:(e,t)=>({version:a.INT16_BE.get(e,t),revision:a.INT16_BE.get(e,t+2),vendor:a.INT32_BE.get(e,t+4)})},t.SoundSampleDescriptionV0={len:12,get:(e,t)=>({numAudioChannels:a.INT16_BE.get(e,t+0),sampleSize:a.INT16_BE.get(e,t+2),compressionId:a.INT16_BE.get(e,t+4),packetSize:a.INT16_BE.get(e,t+6),sampleRate:a.UINT16_BE.get(e,t+8)+a.UINT16_BE.get(e,t+10)/1e4})};class d{constructor(e,t){this.len=e,this.token=t}get(e,t){const r=a.INT32_BE.get(e,t+4);return{version:a.INT8.get(e,t+0),flags:a.INT24_BE.get(e,t+1),numberOfEntries:r,entries:p(e,this.token,t+8,this.len-8,r)}}}function p(e,t,r,n,a){if(s(`remainingLen=${n}, numberOfEntries=${a} * token-len=${t.len}`),0===n)return[];if(n!==a*t.len)throw new Error("mismatch number-of-entries with remaining atom-length");const i=[];for(let n=0;n<a;++n)i.push(t.get(e,r)),r+=t.len;return i}t.TimeToSampleToken={len:8,get:(e,t)=>({count:a.INT32_BE.get(e,t+0),duration:a.INT32_BE.get(e,t+4)})},t.SttsAtom=class extends d{constructor(e){super(e,t.TimeToSampleToken),this.len=e}},t.SampleToChunkToken={len:12,get:(e,t)=>({firstChunk:a.INT32_BE.get(e,t),samplesPerChunk:a.INT32_BE.get(e,t+4),sampleDescriptionId:a.INT32_BE.get(e,t+8)})},t.StscAtom=class extends d{constructor(e){super(e,t.SampleToChunkToken),this.len=e}},t.StszAtom=class{constructor(e){this.len=e}get(e,t){const r=a.INT32_BE.get(e,t+8);return{version:a.INT8.get(e,t),flags:a.INT24_BE.get(e,t+1),sampleSize:a.INT32_BE.get(e,t+4),numberOfEntries:r,entries:p(e,a.INT32_BE,t+12,this.len-12,r)}}},t.StcoAtom=class extends d{constructor(e){super(e,a.INT32_BE),this.len=e}},t.ChapterText=class{constructor(e){this.len=e}get(e,t){const r=a.INT16_BE.get(e,t+0);return new a.StringType(r,"utf-8").get(e,t+2)}}},7576:(e,t,r)=>{const n=r(5606),{ArrayPrototypeIndexOf:a,NumberIsInteger:i,NumberIsNaN:o,NumberParseInt:s,ObjectDefineProperties:l,ObjectKeys:c,ObjectSetPrototypeOf:u,Promise:d,SafeSet:p,SymbolAsyncDispose:f,SymbolAsyncIterator:h,Symbol:m}=r(4134);e.exports=V,V.ReadableState=X;const{EventEmitter:g}=r(7007),{Stream:y,prependListener:b}=r(4259),{Buffer:w}=r(8287),{addAbortSignal:T}=r(4147),v=r(6238);let _=r(7760).debuglog("stream",e=>{_=e});const E=r(345),S=r(3515),{getHighWaterMark:I,getDefaultHighWaterMark:k}=r(5291),{aggregateTwoErrors:A,codes:{ERR_INVALID_ARG_TYPE:C,ERR_METHOD_NOT_IMPLEMENTED:x,ERR_OUT_OF_RANGE:B,ERR_STREAM_PUSH_AFTER_EOF:D,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:P},AbortError:R}=r(6371),{validateObject:M}=r(277),F=m("kPaused"),{StringDecoder:L}=r(3141),O=r(6532);u(V.prototype,y.prototype),u(V,y);const N=()=>{},{errorOrDestroy:U}=S,z=1,j=16,W=32,$=2048,H=4096;function G(e){return{enumerable:!1,get(){return 0!==(this.state&e)},set(t){t?this.state|=e:this.state&=~e}}}function X(e,t,n){"boolean"!=typeof n&&(n=t instanceof r(3370)),this.state=$|H|j|W,e&&e.objectMode&&(this.state|=z),n&&e&&e.readableObjectMode&&(this.state|=z),this.highWaterMark=e?I(this,e,"readableHighWaterMark",n):k(!1),this.buffer=new E,this.length=0,this.pipes=[],this.flowing=null,this[F]=null,e&&!1===e.emitClose&&(this.state&=~$),e&&!1===e.autoDestroy&&(this.state&=~H),this.errored=null,this.defaultEncoding=e&&e.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,e&&e.encoding&&(this.decoder=new L(e.encoding),this.encoding=e.encoding)}function V(e){if(!(this instanceof V))return new V(e);const t=this instanceof r(3370);this._readableState=new X(e,this,t),e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.construct&&(this._construct=e.construct),e.signal&&!t&&T(e.signal,this)),y.call(this,e),S.construct(this,()=>{this._readableState.needReadable&&Q(this,this._readableState)})}function q(e,t,r,n){_("readableAddChunk",t);const a=e._readableState;let i;if(0===(a.state&z)&&("string"==typeof t?(r=r||a.defaultEncoding,a.encoding!==r&&(n&&a.encoding?t=w.from(t,r).toString(a.encoding):(t=w.from(t,r),r=""))):t instanceof w?r="":y._isUint8Array(t)?(t=y._uint8ArrayToBuffer(t),r=""):null!=t&&(i=new C("chunk",["string","Buffer","Uint8Array"],t))),i)U(e,i);else if(null===t)a.state&=-9,function(e,t){if(_("onEofChunk"),!t.ended){if(t.decoder){const e=t.decoder.end();e&&e.length&&(t.buffer.push(e),t.length+=t.objectMode?1:e.length)}t.ended=!0,t.sync?Z(e):(t.needReadable=!1,t.emittedReadable=!0,J(e))}}(e,a);else if(0!==(a.state&z)||t&&t.length>0)if(n)if(4&a.state)U(e,new P);else{if(a.destroyed||a.errored)return!1;Y(e,a,t,!0)}else if(a.ended)U(e,new D);else{if(a.destroyed||a.errored)return!1;a.state&=-9,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||0!==t.length?Y(e,a,t,!1):Q(e,a)):Y(e,a,t,!1)}else n||(a.state&=-9,Q(e,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function Y(e,t,r,n){t.flowing&&0===t.length&&!t.sync&&e.listenerCount("data")>0?(65536&t.state?t.awaitDrainWriters.clear():t.awaitDrainWriters=null,t.dataEmitted=!0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),64&t.state&&Z(e)),Q(e,t)}function K(e,t){return e<=0||0===t.length&&t.ended?0:0!==(t.state&z)?1:o(e)?t.flowing&&t.length?t.buffer.first().length:t.length:e<=t.length?e:t.ended?t.length:0}function Z(e){const t=e._readableState;_("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(_("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(J,e))}function J(e){const t=e._readableState;_("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||t.errored||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,ae(e)}function Q(e,t){!t.readingMore&&t.constructed&&(t.readingMore=!0,n.nextTick(ee,e,t))}function ee(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){const r=t.length;if(_("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function te(e){const t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!1===t[F]?t.flowing=!0:e.listenerCount("data")>0?e.resume():t.readableListening||(t.flowing=null)}function re(e){_("readable nexttick read 0"),e.read(0)}function ne(e,t){_("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),ae(e),t.flowing&&!t.reading&&e.read(0)}function ae(e){const t=e._readableState;for(_("flow",t.flowing);t.flowing&&null!==e.read(););}function ie(e,t){"function"!=typeof e.read&&(e=V.wrap(e,{objectMode:!0}));const r=async function*(e,t){let r,n=N;function a(t){this===e?(n(),n=N):n=t}e.on("readable",a);const i=v(e,{writable:!1},e=>{r=e?A(r,e):null,n(),n=N});try{for(;;){const t=e.destroyed?null:e.read();if(null!==t)yield t;else{if(r)throw r;if(null===r)return;await new d(a)}}}catch(e){throw r=A(r,e),r}finally{!r&&!1===(null==t?void 0:t.destroyOnReturn)||void 0!==r&&!e._readableState.autoDestroy?(e.off("readable",a),i()):S.destroyer(e,null)}}(e,t);return r.stream=e,r}function oe(e,t){if(0===t.length)return null;let r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r}function se(e){const t=e._readableState;_("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick(le,t,e))}function le(e,t){if(_("endReadableNT",e.endEmitted,e.length),!e.errored&&!e.closeEmitted&&!e.endEmitted&&0===e.length)if(e.endEmitted=!0,t.emit("end"),t.writable&&!1===t.allowHalfOpen)n.nextTick(ce,t);else if(e.autoDestroy){const e=t._writableState;(!e||e.autoDestroy&&(e.finished||!1===e.writable))&&t.destroy()}}function ce(e){e.writable&&!e.writableEnded&&!e.destroyed&&e.end()}let ue;function de(){return void 0===ue&&(ue={}),ue}l(X.prototype,{objectMode:G(z),ended:G(2),endEmitted:G(4),reading:G(8),constructed:G(j),sync:G(W),needReadable:G(64),emittedReadable:G(128),readableListening:G(256),resumeScheduled:G(512),errorEmitted:G(1024),emitClose:G($),autoDestroy:G(H),destroyed:G(8192),closed:G(16384),closeEmitted:G(32768),multiAwaitDrain:G(65536),readingMore:G(1<<17),dataEmitted:G(1<<18)}),V.prototype.destroy=S.destroy,V.prototype._undestroy=S.undestroy,V.prototype._destroy=function(e,t){t(e)},V.prototype[g.captureRejectionSymbol]=function(e){this.destroy(e)},V.prototype[f]=function(){let e;return this.destroyed||(e=this.readableEnded?null:new R,this.destroy(e)),new d((t,r)=>v(this,n=>n&&n!==e?r(n):t(null)))},V.prototype.push=function(e,t){return q(this,e,t,!1)},V.prototype.unshift=function(e,t){return q(this,e,t,!0)},V.prototype.isPaused=function(){const e=this._readableState;return!0===e[F]||!1===e.flowing},V.prototype.setEncoding=function(e){const t=new L(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;const r=this._readableState.buffer;let n="";for(const e of r)n+=t.write(e);return r.clear(),""!==n&&r.push(n),this._readableState.length=n.length,this},V.prototype.read=function(e){_("read",e),void 0===e?e=NaN:i(e)||(e=s(e,10));const t=this._readableState,r=e;if(e>t.highWaterMark&&(t.highWaterMark=function(e){if(e>1073741824)throw new B("size","<= 1GiB",e);return e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,++e}(e)),0!==e&&(t.state&=-129),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return _("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?se(this):Z(this),null;if(0===(e=K(e,t))&&t.ended)return 0===t.length&&se(this),null;let n,a=!!(64&t.state);if(_("need readable",a),(0===t.length||t.length-e<t.highWaterMark)&&(a=!0,_("length less than watermark",a)),t.ended||t.reading||t.destroyed||t.errored||!t.constructed)a=!1,_("reading, ended or constructing",a);else if(a){_("do read"),t.state|=8|W,0===t.length&&(t.state|=64);try{this._read(t.highWaterMark)}catch(e){U(this,e)}t.state&=~W,t.reading||(e=K(r,t))}return n=e>0?oe(e,t):null,null===n?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.multiAwaitDrain?t.awaitDrainWriters.clear():t.awaitDrainWriters=null),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&se(this)),null===n||t.errorEmitted||t.closeEmitted||(t.dataEmitted=!0,this.emit("data",n)),n},V.prototype._read=function(e){throw new x("_read()")},V.prototype.pipe=function(e,t){const r=this,a=this._readableState;1===a.pipes.length&&(a.multiAwaitDrain||(a.multiAwaitDrain=!0,a.awaitDrainWriters=new p(a.awaitDrainWriters?[a.awaitDrainWriters]:[]))),a.pipes.push(e),_("pipe count=%d opts=%j",a.pipes.length,t);const i=t&&!1===t.end||e===n.stdout||e===n.stderr?m:o;function o(){_("onend"),e.end()}let s;a.endEmitted?n.nextTick(i):r.once("end",i),e.on("unpipe",function t(n,i){_("onunpipe"),n===r&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,_("cleanup"),e.removeListener("close",f),e.removeListener("finish",h),s&&e.removeListener("drain",s),e.removeListener("error",d),e.removeListener("unpipe",t),r.removeListener("end",o),r.removeListener("end",m),r.removeListener("data",u),l=!0,s&&a.awaitDrainWriters&&(!e._writableState||e._writableState.needDrain)&&s())});let l=!1;function c(){l||(1===a.pipes.length&&a.pipes[0]===e?(_("false write response, pause",0),a.awaitDrainWriters=e,a.multiAwaitDrain=!1):a.pipes.length>1&&a.pipes.includes(e)&&(_("false write response, pause",a.awaitDrainWriters.size),a.awaitDrainWriters.add(e)),r.pause()),s||(s=function(e,t){return function(){const r=e._readableState;r.awaitDrainWriters===t?(_("pipeOnDrain",1),r.awaitDrainWriters=null):r.multiAwaitDrain&&(_("pipeOnDrain",r.awaitDrainWriters.size),r.awaitDrainWriters.delete(t)),r.awaitDrainWriters&&0!==r.awaitDrainWriters.size||!e.listenerCount("data")||e.resume()}}(r,e),e.on("drain",s))}function u(t){_("ondata");const r=e.write(t);_("dest.write",r),!1===r&&c()}function d(t){if(_("onerror",t),m(),e.removeListener("error",d),0===e.listenerCount("error")){const r=e._writableState||e._readableState;r&&!r.errorEmitted?U(e,t):e.emit("error",t)}}function f(){e.removeListener("finish",h),m()}function h(){_("onfinish"),e.removeListener("close",f),m()}function m(){_("unpipe"),r.unpipe(e)}return r.on("data",u),b(e,"error",d),e.once("close",f),e.once("finish",h),e.emit("pipe",r),!0===e.writableNeedDrain?c():a.flowing||(_("pipe resume"),r.resume()),e},V.prototype.unpipe=function(e){const t=this._readableState;if(0===t.pipes.length)return this;if(!e){const e=t.pipes;t.pipes=[],this.pause();for(let t=0;t<e.length;t++)e[t].emit("unpipe",this,{hasUnpiped:!1});return this}const r=a(t.pipes,e);return-1===r||(t.pipes.splice(r,1),0===t.pipes.length&&this.pause(),e.emit("unpipe",this,{hasUnpiped:!1})),this},V.prototype.on=function(e,t){const r=y.prototype.on.call(this,e,t),a=this._readableState;return"data"===e?(a.readableListening=this.listenerCount("readable")>0,!1!==a.flowing&&this.resume()):"readable"===e&&(a.endEmitted||a.readableListening||(a.readableListening=a.needReadable=!0,a.flowing=!1,a.emittedReadable=!1,_("on readable",a.length,a.reading),a.length?Z(this):a.reading||n.nextTick(re,this))),r},V.prototype.addListener=V.prototype.on,V.prototype.removeListener=function(e,t){const r=y.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(te,this),r},V.prototype.off=V.prototype.removeListener,V.prototype.removeAllListeners=function(e){const t=y.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||n.nextTick(te,this),t},V.prototype.resume=function(){const e=this._readableState;return e.flowing||(_("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(ne,e,t))}(this,e)),e[F]=!1,this},V.prototype.pause=function(){return _("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(_("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[F]=!0,this},V.prototype.wrap=function(e){let t=!1;e.on("data",r=>{!this.push(r)&&e.pause&&(t=!0,e.pause())}),e.on("end",()=>{this.push(null)}),e.on("error",e=>{U(this,e)}),e.on("close",()=>{this.destroy()}),e.on("destroy",()=>{this.destroy()}),this._read=()=>{t&&e.resume&&(t=!1,e.resume())};const r=c(e);for(let t=1;t<r.length;t++){const n=r[t];void 0===this[n]&&"function"==typeof e[n]&&(this[n]=e[n].bind(e))}return this},V.prototype[h]=function(){return ie(this)},V.prototype.iterator=function(e){return void 0!==e&&M(e,"options"),ie(this,e)},l(V.prototype,{readable:{__proto__:null,get(){const e=this._readableState;return!(!e||!1===e.readable||e.destroyed||e.errorEmitted||e.endEmitted)},set(e){this._readableState&&(this._readableState.readable=!!e)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!(!1===this._readableState.readable||!this._readableState.destroyed&&!this._readableState.errored||this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return!!this._readableState&&this._readableState.objectMode}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return!!this._readableState&&this._readableState.closed}},destroyed:{__proto__:null,enumerable:!1,get(){return!!this._readableState&&this._readableState.destroyed},set(e){this._readableState&&(this._readableState.destroyed=e)}},readableEnded:{__proto__:null,enumerable:!1,get(){return!!this._readableState&&this._readableState.endEmitted}}}),l(X.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return!1!==this[F]},set(e){this[F]=!!e}}}),V._fromList=oe,V.from=function(e,t){return O(V,e,t)},V.fromWeb=function(e,t){return de().newStreamReadableFromReadableStream(e,t)},V.toWeb=function(e,t){return de().newReadableStreamFromStreamReadable(e,t)},V.wrap=function(e,t){var r,n;return new V({objectMode:null===(r=null!==(n=e.readableObjectMode)&&void 0!==n?n:e.objectMode)||void 0===r||r,...t,destroy(t,r){S.destroyer(e,t),r(t)}}).wrap(e)}},7636:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Header=void 0;const n=r(1028),a=r(3232);t.Header={len:8,get:(e,t)=>({chunkID:a.FourCcToken.get(e,t),chunkSize:Number(BigInt(n.UINT32_BE.get(e,t+4)))})}},7648:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AsfParser=void 0;const n=r(7833),a=r(7338),i=r(2268),o=r(4256),s=r(6373),l=(0,n.default)("music-metadata:parser:ASF");class c extends s.BasicParser{async parse(){const e=await this.tokenizer.readToken(o.TopLevelHeaderObjectToken);if(!e.objectId.equals(i.default.HeaderObject))throw new Error("expected asf header; but was not found; got: "+e.objectId.str);try{await this.parseObjectHeader(e.numberOfHeaderObjects)}catch(e){l("Error while parsing ASF: %s",e)}}async parseObjectHeader(e){let t;do{const e=await this.tokenizer.readToken(o.HeaderObjectToken);switch(l("header GUID=%s",e.objectId.str),e.objectId.str){case o.FilePropertiesObject.guid.str:const r=await this.tokenizer.readToken(new o.FilePropertiesObject(e));this.metadata.setFormat("duration",Number(r.playDuration/BigInt(1e3))/1e4-Number(r.preroll)/1e3),this.metadata.setFormat("bitrate",r.maximumBitrate);break;case o.StreamPropertiesObject.guid.str:const n=await this.tokenizer.readToken(new o.StreamPropertiesObject(e));this.metadata.setFormat("container","ASF/"+n.streamType);break;case o.HeaderExtensionObject.guid.str:const s=await this.tokenizer.readToken(new o.HeaderExtensionObject);await this.parseExtensionObject(s.extensionDataSize);break;case o.ContentDescriptionObjectState.guid.str:t=await this.tokenizer.readToken(new o.ContentDescriptionObjectState(e)),this.addTags(t);break;case o.ExtendedContentDescriptionObjectState.guid.str:t=await this.tokenizer.readToken(new o.ExtendedContentDescriptionObjectState(e)),this.addTags(t);break;case i.default.CodecListObject.str:const c=await o.readCodecEntries(this.tokenizer);c.forEach(e=>{this.metadata.addStreamInfo({type:e.type.videoCodec?a.TrackType.video:a.TrackType.audio,codecName:e.codecName})});const u=c.filter(e=>e.type.audioCodec).map(e=>e.codecName).join("/");this.metadata.setFormat("codec",u);break;case i.default.StreamBitratePropertiesObject.str:await this.tokenizer.ignore(e.objectSize-o.HeaderObjectToken.len);break;case i.default.PaddingObject.str:l("Padding: %s bytes",e.objectSize-o.HeaderObjectToken.len),await this.tokenizer.ignore(e.objectSize-o.HeaderObjectToken.len);break;default:this.metadata.addWarning("Ignore ASF-Object-GUID: "+e.objectId.str),l("Ignore ASF-Object-GUID: %s",e.objectId.str),await this.tokenizer.readToken(new o.IgnoreObjectState(e))}}while(--e)}addTags(e){e.forEach(e=>{this.metadata.addTag("asf",e.id,e.value)})}async parseExtensionObject(e){do{const t=await this.tokenizer.readToken(o.HeaderObjectToken),r=t.objectSize-o.HeaderObjectToken.len;switch(t.objectId.str){case o.ExtendedStreamPropertiesObjectState.guid.str:await this.tokenizer.readToken(new o.ExtendedStreamPropertiesObjectState(t));break;case o.MetadataObjectState.guid.str:const e=await this.tokenizer.readToken(new o.MetadataObjectState(t));this.addTags(e);break;case o.MetadataLibraryObjectState.guid.str:const n=await this.tokenizer.readToken(new o.MetadataLibraryObjectState(t));this.addTags(n);break;case i.default.PaddingObject.str:await this.tokenizer.ignore(r);break;case i.default.CompatibilityObject.str:this.tokenizer.ignore(r);break;case i.default.ASF_Index_Placeholder_Object.str:await this.tokenizer.ignore(r);break;default:this.metadata.addWarning("Ignore ASF-Object-GUID: "+t.objectId.str),await this.tokenizer.readToken(new o.IgnoreObjectState(t))}e-=t.objectSize}while(e>0)}}t.AsfParser=c},7727:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.ParserFactory=t.parseHttpContentType=void 0;const a=r(9549),i=r(8597),o=r(864),s=r(7833),l=r(3340),c=r(4082),u=r(9156),d=r(7648),p=r(1650),f=r(8296),h=r(3960),m=r(1446),g=r(4272),y=r(6879),b=r(9400),w=r(9432),T=r(2986),v=r(2030),_=(0,s.default)("music-metadata:parser:factory");function E(e){const t=i.parse(e),r=o.parse(t.type);return{type:r.type,subtype:r.subtype,suffix:r.suffix,parameters:t.parameters}}t.parseHttpContentType=E;class S{static async parseOnContentType(e,t){const{mimeType:r,path:n,url:a}=await e.fileInfo,i=S.getParserIdForMimeType(r)||S.getParserIdForExtension(n)||S.getParserIdForExtension(a);return i||_("No parser found for MIME-type / extension: "+r),this.parse(e,i,t)}static async parse(e,t,r){if(!t){_("Guess parser on content...");const r=n.alloc(4100);if(await e.peekBuffer(r,{mayBeLess:!0}),e.fileInfo.path&&(t=this.getParserIdForExtension(e.fileInfo.path)),!t){const e=await a.fromBuffer(r);if(!e)throw new Error("Failed to determine audio format");if(_(`Guessed file type is mime=${e.mime}, extension=${e.ext}`),!(t=S.getParserIdForMimeType(e.mime)))throw new Error("Guessed MIME-type not supported: "+e.mime)}}return async function(e,t,r={}){const n=await S.loadParser(t),a=new l.MetadataCollector(r);return await n.init(a,e,r).parse(),a.toCommonMetadata()}(e,t,r)}static getParserIdForExtension(e){if(e)switch(this.getExtension(e).toLocaleLowerCase()||e){case".mp2":case".mp3":case".m2a":case".aac":return"mpeg";case".ape":return"apev2";case".mp4":case".m4a":case".m4b":case".m4pa":case".m4v":case".m4r":case".3gp":return"mp4";case".wma":case".wmv":case".asf":return"asf";case".flac":return"flac";case".ogg":case".ogv":case".oga":case".ogm":case".ogx":case".opus":case".spx":return"ogg";case".aif":case".aiff":case".aifc":return"aiff";case".wav":case".bwf":return"riff";case".wv":case".wvp":return"wavpack";case".mpc":return"musepack";case".dsf":return"dsf";case".dff":return"dsdiff";case".mka":case".mkv":case".mk3d":case".mks":case".webm":return"matroska"}}static async loadParser(e){switch(e){case"aiff":return new c.AIFFParser;case"adts":case"mpeg":return new h.MpegParser;case"apev2":return new u.APEv2Parser;case"asf":return new d.AsfParser;case"dsf":return new w.DsfParser;case"dsdiff":return new T.DsdiffParser;case"flac":return new p.FlacParser;case"mp4":return new f.MP4Parser;case"musepack":return new m.default;case"ogg":return new g.OggParser;case"riff":return new y.WaveParser;case"wavpack":return new b.WavPackParser;case"matroska":return new v.MatroskaParser;default:throw new Error(`Unknown parser type: ${e}`)}}static getExtension(e){const t=e.lastIndexOf(".");return-1===t?"":e.slice(t)}static getParserIdForMimeType(e){let t;try{t=E(e)}catch(t){return void _(`Invalid HTTP Content-Type header value: ${e}`)}const r=0===t.subtype.indexOf("x-")?t.subtype.substring(2):t.subtype;switch(t.type){case"audio":switch(r){case"mp3":case"mpeg":return"mpeg";case"aac":case"aacp":return"adts";case"flac":return"flac";case"ape":case"monkeys-audio":return"apev2";case"mp4":case"m4a":return"mp4";case"ogg":case"opus":case"speex":return"ogg";case"ms-wma":case"ms-wmv":case"ms-asf":return"asf";case"aiff":case"aif":case"aifc":return"aiff";case"vnd.wave":case"wav":case"wave":return"riff";case"wavpack":return"wavpack";case"musepack":return"musepack";case"matroska":case"webm":return"matroska";case"dsf":return"dsf"}break;case"video":switch(r){case"ms-asf":case"ms-wmv":return"asf";case"m4v":case"mp4":return"mp4";case"ogg":return"ogg";case"matroska":case"webm":return"matroska"}break;case"application":switch(r){case"vnd.ms-asf":return"asf";case"ogg":return"ogg"}}}}t.ParserFactory=S},7758:(e,t,r)=>{const n=r(5606),{ArrayIsArray:a,Promise:i,SymbolAsyncIterator:o,SymbolDispose:s}=r(4134),l=r(6238),{once:c}=r(7760),u=r(3515),d=r(3370),{aggregateTwoErrors:p,codes:{ERR_INVALID_ARG_TYPE:f,ERR_INVALID_RETURN_VALUE:h,ERR_MISSING_ARGS:m,ERR_STREAM_DESTROYED:g,ERR_STREAM_PREMATURE_CLOSE:y},AbortError:b}=r(6371),{validateFunction:w,validateAbortSignal:T}=r(277),{isIterable:v,isReadable:_,isReadableNodeStream:E,isNodeStream:S,isTransformStream:I,isWebStream:k,isReadableStream:A,isReadableFinished:C}=r(6115),x=globalThis.AbortController||r(5568).AbortController;let B,D,P;function R(e,t,r){let n=!1;return e.on("close",()=>{n=!0}),{destroy:t=>{n||(n=!0,u.destroyer(e,t||new g("pipe")))},cleanup:l(e,{readable:t,writable:r},e=>{n=!e})}}function M(e){if(v(e))return e;if(E(e))return async function*(e){D||(D=r(7576)),yield*D.prototype[o].call(e)}(e);throw new f("val",["Readable","Iterable","AsyncIterable"],e)}async function F(e,t,r,{end:n}){let a,o=null;const s=e=>{if(e&&(a=e),o){const e=o;o=null,e()}},c=()=>new i((e,t)=>{a?t(a):o=()=>{a?t(a):e()}});t.on("drain",s);const u=l(t,{readable:!1},s);try{t.writableNeedDrain&&await c();for await(const r of e)t.write(r)||await c();n&&(t.end(),await c()),r()}catch(e){r(a!==e?p(a,e):e)}finally{u(),t.off("drain",s)}}async function L(e,t,r,{end:n}){I(t)&&(t=t.writable);const a=t.getWriter();try{for await(const t of e)await a.ready,a.write(t).catch(()=>{});await a.ready,n&&await a.close(),r()}catch(e){try{await a.abort(e),r(e)}catch(e){r(e)}}}function O(e,t,i){if(1===e.length&&a(e[0])&&(e=e[0]),e.length<2)throw new m("streams");const o=new x,l=o.signal,c=null==i?void 0:i.signal,u=[];function p(){z(new b)}let g,y,w;T(c,"options.signal"),P=P||r(7760).addAbortListener,c&&(g=P(c,p));const C=[];let D,O=0;function U(e){z(e,0===--O)}function z(e,r){var a;if(!e||y&&"ERR_STREAM_PREMATURE_CLOSE"!==y.code||(y=e),y||r){for(;C.length;)C.shift()(y);null===(a=g)||void 0===a||a[s](),o.abort(),r&&(y||u.forEach(e=>e()),n.nextTick(t,y,w))}}for(let $=0;$<e.length;$++){const H=e[$],G=$<e.length-1,X=$>0,V=G||!1!==(null==i?void 0:i.end),q=$===e.length-1;if(S(H)){if(V){const{destroy:K,cleanup:Z}=R(H,G,X);C.push(K),_(H)&&q&&u.push(Z)}function Y(e){e&&"AbortError"!==e.name&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code&&U(e)}H.on("error",Y),_(H)&&q&&u.push(()=>{H.removeListener("error",Y)})}if(0===$)if("function"==typeof H){if(D=H({signal:l}),!v(D))throw new h("Iterable, AsyncIterable or Stream","source",D)}else D=v(H)||E(H)||I(H)?H:d.from(H);else if("function"==typeof H){var j;if(D=I(D)?M(null===(j=D)||void 0===j?void 0:j.readable):M(D),D=H(D,{signal:l}),G){if(!v(D,!0))throw new h("AsyncIterable",`transform[${$-1}]`,D)}else{var W;B||(B=r(6524));const J=new B({objectMode:!0}),Q=null===(W=D)||void 0===W?void 0:W.then;if("function"==typeof Q)O++,Q.call(D,e=>{w=e,null!=e&&J.write(e),V&&J.end(),n.nextTick(U)},e=>{J.destroy(e),n.nextTick(U,e)});else if(v(D,!0))O++,F(D,J,U,{end:V});else{if(!A(D)&&!I(D))throw new h("AsyncIterable or Promise","destination",D);{const re=D.readable||D;O++,F(re,J,U,{end:V})}}D=J;const{destroy:ee,cleanup:te}=R(D,!1,!0);C.push(ee),q&&u.push(te)}}else if(S(H)){if(E(D)){O+=2;const ne=N(D,H,U,{end:V});_(H)&&q&&u.push(ne)}else if(I(D)||A(D)){const ae=D.readable||D;O++,F(ae,H,U,{end:V})}else{if(!v(D))throw new f("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],D);O++,F(D,H,U,{end:V})}D=H}else if(k(H)){if(E(D))O++,L(M(D),H,U,{end:V});else if(A(D)||v(D))O++,L(D,H,U,{end:V});else{if(!I(D))throw new f("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],D);O++,L(D.readable,H,U,{end:V})}D=H}else D=d.from(H)}return(null!=l&&l.aborted||null!=c&&c.aborted)&&n.nextTick(p),D}function N(e,t,r,{end:a}){let i=!1;if(t.on("close",()=>{i||r(new y)}),e.pipe(t,{end:!1}),a){function o(){i=!0,t.end()}C(e)?n.nextTick(o):e.once("end",o)}else r();return l(e,{readable:!0,writable:!1},t=>{const n=e._readableState;t&&"ERR_STREAM_PREMATURE_CLOSE"===t.code&&n&&n.ended&&!n.errored&&!n.errorEmitted?e.once("end",r).once("error",r):r(t)}),l(t,{readable:!1,writable:!0},r)}e.exports={pipelineImpl:O,pipeline:function(...e){return O(e,c(function(e){return w(e[e.length-1],"streams[stream.length - 1]"),e.pop()}(e)))}}},7760:(e,t,r)=>{const n=r(8287),{format:a,inspect:i}=r(9231),{codes:{ERR_INVALID_ARG_TYPE:o}}=r(6371),{kResistStopPropagation:s,AggregateError:l,SymbolDispose:c}=r(4134),u=globalThis.AbortSignal||r(5568).AbortSignal,d=globalThis.AbortController||r(5568).AbortController,p=Object.getPrototypeOf(async function(){}).constructor,f=globalThis.Blob||n.Blob,h=void 0!==f?function(e){return e instanceof f}:function(e){return!1},m=(e,t)=>{if(void 0!==e&&(null===e||"object"!=typeof e||!("aborted"in e)))throw new o(t,"AbortSignal",e)};e.exports={AggregateError:l,kEmptyObject:Object.freeze({}),once(e){let t=!1;return function(...r){t||(t=!0,e.apply(this,r))}},createDeferredPromise:function(){let e,t;return{promise:new Promise((r,n)=>{e=r,t=n}),resolve:e,reject:t}},promisify:e=>new Promise((t,r)=>{e((e,...n)=>e?r(e):t(...n))}),debuglog:()=>function(){},format:a,inspect:i,types:{isAsyncFunction:e=>e instanceof p,isArrayBufferView:e=>ArrayBuffer.isView(e)},isBlob:h,deprecate:(e,t)=>e,addAbortListener:r(7007).addAbortListener||function(e,t){if(void 0===e)throw new o("signal","AbortSignal",e);let r;return m(e,"signal"),(e=>{if("function"!=typeof e)throw new o("listener","Function",e)})(t),e.aborted?queueMicrotask(()=>t()):(e.addEventListener("abort",t,{__proto__:null,once:!0,[s]:!0}),r=()=>{e.removeEventListener("abort",t)}),{__proto__:null,[c](){var e;null===(e=r)||void 0===e||e()}}},AbortSignalAny:u.any||function(e){if(1===e.length)return e[0];const t=new d,r=()=>t.abort();return e.forEach(e=>{m(e,"signals"),e.addEventListener("abort",r,{once:!0})}),t.signal.addEventListener("abort",()=>{e.forEach(e=>e.removeEventListener("abort",r))},{once:!0}),t.signal}},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")},7802:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MP4TagMapper=t.tagType=void 0;const n=r(4151),a={"nam":"title","ART":"artist",aART:"albumartist","----:com.apple.iTunes:Band":"albumartist","alb":"album","day":"date","cmt":"comment","com":"comment",trkn:"track",disk:"disk","gen":"genre",covr:"picture","wrt":"composer","lyr":"lyrics",soal:"albumsort",sonm:"titlesort",soar:"artistsort",soaa:"albumartistsort",soco:"composersort","----:com.apple.iTunes:LYRICIST":"lyricist","----:com.apple.iTunes:CONDUCTOR":"conductor","----:com.apple.iTunes:REMIXER":"remixer","----:com.apple.iTunes:ENGINEER":"engineer","----:com.apple.iTunes:PRODUCER":"producer","----:com.apple.iTunes:DJMIXER":"djmixer","----:com.apple.iTunes:MIXER":"mixer","----:com.apple.iTunes:LABEL":"label","grp":"grouping","----:com.apple.iTunes:SUBTITLE":"subtitle","----:com.apple.iTunes:DISCSUBTITLE":"discsubtitle",cpil:"compilation",tmpo:"bpm","----:com.apple.iTunes:MOOD":"mood","----:com.apple.iTunes:MEDIA":"media","----:com.apple.iTunes:CATALOGNUMBER":"catalognumber",tvsh:"tvShow",tvsn:"tvSeason",tves:"tvEpisode",sosn:"tvShowSort",tven:"tvEpisodeId",tvnn:"tvNetwork",pcst:"podcast",purl:"podcasturl","----:com.apple.iTunes:MusicBrainz Album Status":"releasestatus","----:com.apple.iTunes:MusicBrainz Album Type":"releasetype","----:com.apple.iTunes:MusicBrainz Album Release Country":"releasecountry","----:com.apple.iTunes:SCRIPT":"script","----:com.apple.iTunes:LANGUAGE":"language",cprt:"copyright","cpy":"copyright","----:com.apple.iTunes:LICENSE":"license","too":"encodedby",pgap:"gapless","----:com.apple.iTunes:BARCODE":"barcode","----:com.apple.iTunes:ISRC":"isrc","----:com.apple.iTunes:ASIN":"asin","----:com.apple.iTunes:NOTES":"comment","----:com.apple.iTunes:MusicBrainz Track Id":"musicbrainz_recordingid","----:com.apple.iTunes:MusicBrainz Release Track Id":"musicbrainz_trackid","----:com.apple.iTunes:MusicBrainz Album Id":"musicbrainz_albumid","----:com.apple.iTunes:MusicBrainz Artist Id":"musicbrainz_artistid","----:com.apple.iTunes:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","----:com.apple.iTunes:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","----:com.apple.iTunes:MusicBrainz Work Id":"musicbrainz_workid","----:com.apple.iTunes:MusicBrainz TRM Id":"musicbrainz_trmid","----:com.apple.iTunes:MusicBrainz Disc Id":"musicbrainz_discid","----:com.apple.iTunes:Acoustid Id":"acoustid_id","----:com.apple.iTunes:Acoustid Fingerprint":"acoustid_fingerprint","----:com.apple.iTunes:MusicIP PUID":"musicip_puid","----:com.apple.iTunes:fingerprint":"musicip_fingerprint","----:com.apple.iTunes:replaygain_track_gain":"replaygain_track_gain","----:com.apple.iTunes:replaygain_track_peak":"replaygain_track_peak","----:com.apple.iTunes:replaygain_album_gain":"replaygain_album_gain","----:com.apple.iTunes:replaygain_album_peak":"replaygain_album_peak","----:com.apple.iTunes:replaygain_track_minmax":"replaygain_track_minmax","----:com.apple.iTunes:replaygain_album_minmax":"replaygain_album_minmax","----:com.apple.iTunes:replaygain_undo":"replaygain_undo",gnre:"genre","----:com.apple.iTunes:ALBUMARTISTSORT":"albumartistsort","----:com.apple.iTunes:ARTISTS":"artists","----:com.apple.iTunes:ORIGINALDATE":"originaldate","----:com.apple.iTunes:ORIGINALYEAR":"originalyear",desc:"description",ldes:"longDescription","mvn":"movement","mvi":"movementIndex","mvc":"movementTotal","wrk":"work",catg:"category",egid:"podcastId",hdvd:"hdVideo",keyw:"keywords",shwm:"showMovement",stik:"stik",rate:"rating"};t.tagType="iTunes";class i extends n.CaseInsensitiveTagMap{constructor(){super([t.tagType],a)}postMap(e,t){"rate"===e.id&&(e.value={source:void 0,rating:parseFloat(e.value)/100})}}t.MP4TagMapper=i},7806:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VorbisTagMapper=void 0;const n=r(8872),a={TITLE:"title",ARTIST:"artist",ARTISTS:"artists",ALBUMARTIST:"albumartist","ALBUM ARTIST":"albumartist",ALBUM:"album",DATE:"date",ORIGINALDATE:"originaldate",ORIGINALYEAR:"originalyear",COMMENT:"comment",TRACKNUMBER:"track",DISCNUMBER:"disk",GENRE:"genre",METADATA_BLOCK_PICTURE:"picture",COMPOSER:"composer",LYRICS:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",LYRICIST:"lyricist",WRITER:"writer",CONDUCTOR:"conductor",REMIXER:"remixer",ARRANGER:"arranger",ENGINEER:"engineer",PRODUCER:"producer",DJMIXER:"djmixer",MIXER:"mixer",LABEL:"label",GROUPING:"grouping",SUBTITLE:"subtitle",DISCSUBTITLE:"discsubtitle",TRACKTOTAL:"totaltracks",DISCTOTAL:"totaldiscs",COMPILATION:"compilation",RATING:"rating",BPM:"bpm",KEY:"key",MOOD:"mood",MEDIA:"media",CATALOGNUMBER:"catalognumber",RELEASESTATUS:"releasestatus",RELEASETYPE:"releasetype",RELEASECOUNTRY:"releasecountry",SCRIPT:"script",LANGUAGE:"language",COPYRIGHT:"copyright",LICENSE:"license",ENCODEDBY:"encodedby",ENCODERSETTINGS:"encodersettings",BARCODE:"barcode",ISRC:"isrc",ASIN:"asin",MUSICBRAINZ_TRACKID:"musicbrainz_recordingid",MUSICBRAINZ_RELEASETRACKID:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",ACOUSTID_ID:"acoustid_id",ACOUSTID_ID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",WEBSITE:"website",NOTES:"notes",TOTALTRACKS:"totaltracks",TOTALDISCS:"totaldiscs",DISCOGS_ARTIST_ID:"discogs_artist_id",DISCOGS_ARTISTS:"artists",DISCOGS_ARTIST_NAME:"artists",DISCOGS_ALBUM_ARTISTS:"albumartist",DISCOGS_CATALOG:"catalognumber",DISCOGS_COUNTRY:"releasecountry",DISCOGS_DATE:"originaldate",DISCOGS_LABEL:"label",DISCOGS_LABEL_ID:"discogs_label_id",DISCOGS_MASTER_RELEASE_ID:"discogs_master_release_id",DISCOGS_RATING:"discogs_rating",DISCOGS_RELEASED:"date",DISCOGS_RELEASE_ID:"discogs_release_id",DISCOGS_VOTES:"discogs_votes",CATALOGID:"catalognumber",STYLE:"genre",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",REPLAYGAIN_ALBUM_GAIN:"replaygain_album_gain",REPLAYGAIN_ALBUM_PEAK:"replaygain_album_peak",REPLAYGAIN_MINMAX:"replaygain_track_minmax",REPLAYGAIN_ALBUM_MINMAX:"replaygain_album_minmax",REPLAYGAIN_UNDO:"replaygain_undo"};class i extends n.CommonTagMapper{static toRating(e,t,r){return{source:e?e.toLowerCase():e,rating:parseFloat(t)/r*n.CommonTagMapper.maxRatingScore}}constructor(){super(["vorbis"],a)}postMap(e){if("RATING"===e.id)e.value=i.toRating(void 0,e.value,100);else if(0===e.id.indexOf("RATING:")){const t=e.id.split(":");e.value=i.toRating(t[1],e.value,1),e.id=t[0]}}}t.VorbisTagMapper=i},7830:(e,t,r)=>{const{pipeline:n}=r(7758),a=r(3370),{destroyer:i}=r(3515),{isNodeStream:o,isReadable:s,isWritable:l,isWebStream:c,isTransformStream:u,isWritableStream:d,isReadableStream:p}=r(6115),{AbortError:f,codes:{ERR_INVALID_ARG_VALUE:h,ERR_MISSING_ARGS:m}}=r(6371),g=r(6238);e.exports=function(...e){if(0===e.length)throw new m("streams");if(1===e.length)return a.from(e[0]);const t=[...e];if("function"==typeof e[0]&&(e[0]=a.from(e[0])),"function"==typeof e[e.length-1]){const t=e.length-1;e[t]=a.from(e[t])}for(let r=0;r<e.length;++r)if(o(e[r])||c(e[r])){if(r<e.length-1&&!(s(e[r])||p(e[r])||u(e[r])))throw new h(`streams[${r}]`,t[r],"must be readable");if(r>0&&!(l(e[r])||d(e[r])||u(e[r])))throw new h(`streams[${r}]`,t[r],"must be writable")}let r,y,b,w,T;const v=e[0],_=n(e,function(e){const t=w;w=null,t?t(e):e?T.destroy(e):S||E||T.destroy()}),E=!!(l(v)||d(v)||u(v)),S=!!(s(_)||p(_)||u(_));if(T=new a({writableObjectMode:!(null==v||!v.writableObjectMode),readableObjectMode:!(null==_||!_.readableObjectMode),writable:E,readable:S}),E){if(o(v))T._write=function(e,t,n){v.write(e,t)?n():r=n},T._final=function(e){v.end(),y=e},v.on("drain",function(){if(r){const e=r;r=null,e()}});else if(c(v)){const e=(u(v)?v.writable:v).getWriter();T._write=async function(t,r,n){try{await e.ready,e.write(t).catch(()=>{}),n()}catch(e){n(e)}},T._final=async function(t){try{await e.ready,e.close().catch(()=>{}),y=t}catch(e){t(e)}}}const e=u(_)?_.readable:_;g(e,()=>{if(y){const e=y;y=null,e()}})}if(S)if(o(_))_.on("readable",function(){if(b){const e=b;b=null,e()}}),_.on("end",function(){T.push(null)}),T._read=function(){for(;;){const e=_.read();if(null===e)return void(b=T._read);if(!T.push(e))return}};else if(c(_)){const e=(u(_)?_.readable:_).getReader();T._read=async function(){for(;;)try{const{value:t,done:r}=await e.read();if(!T.push(t))return;if(r)return void T.push(null)}catch{return}}}return T._destroy=function(e,t){e||null===w||(e=new f),b=null,r=null,y=null,null===w?t(e):(w=t,o(_)&&i(_,e))},T}},7833:(e,t,r)=>{var n=r(5606);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,a=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(a=n))}),t.splice(a,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(736)(t);const{formatters:a}=e.exports;a.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},7925:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ID3v1TagMapper=void 0;const n=r(8872),a={title:"title",artist:"artist",album:"album",year:"year",comment:"comment",track:"track",genre:"genre"};class i extends n.CommonTagMapper{constructor(){super(["ID3v1"],a)}}t.ID3v1TagMapper=i},7975:(e,t,r)=>{var n=r(5606);function a(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function i(e,t){for(var r,n="",a=0,i=-1,o=0,s=0;s<=e.length;++s){if(s<e.length)r=e.charCodeAt(s);else{if(47===r)break;r=47}if(47===r){if(i===s-1||1===o);else if(i!==s-1&&2===o){if(n.length<2||2!==a||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var l=n.lastIndexOf("/");if(l!==n.length-1){-1===l?(n="",a=0):a=(n=n.slice(0,l)).length-1-n.lastIndexOf("/"),i=s,o=0;continue}}else if(2===n.length||1===n.length){n="",a=0,i=s,o=0;continue}t&&(n.length>0?n+="/..":n="..",a=2)}else n.length>0?n+="/"+e.slice(i+1,s):n=e.slice(i+1,s),a=s-i-1;i=s,o=0}else 46===r&&-1!==o?++o:o=-1}return n}var o={resolve:function(){for(var e,t="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var s;o>=0?s=arguments[o]:(void 0===e&&(e=n.cwd()),s=e),a(s),0!==s.length&&(t=s+"/"+t,r=47===s.charCodeAt(0))}return t=i(t,!r),r?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(e){if(a(e),0===e.length)return".";var t=47===e.charCodeAt(0),r=47===e.charCodeAt(e.length-1);return 0!==(e=i(e,!t)).length||t||(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return a(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];a(r),r.length>0&&(void 0===e?e=r:e+="/"+r)}return void 0===e?".":o.normalize(e)},relative:function(e,t){if(a(e),a(t),e===t)return"";if((e=o.resolve(e))===(t=o.resolve(t)))return"";for(var r=1;r<e.length&&47===e.charCodeAt(r);++r);for(var n=e.length,i=n-r,s=1;s<t.length&&47===t.charCodeAt(s);++s);for(var l=t.length-s,c=i<l?i:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(47===t.charCodeAt(s+d))return t.slice(s+d+1);if(0===d)return t.slice(s+d)}else i>c&&(47===e.charCodeAt(r+d)?u=d:0===d&&(u=0));break}var p=e.charCodeAt(r+d);if(p!==t.charCodeAt(s+d))break;47===p&&(u=d)}var f="";for(d=r+u+1;d<=n;++d)d!==n&&47!==e.charCodeAt(d)||(0===f.length?f+="..":f+="/..");return f.length>0?f+t.slice(s+u):(s+=u,47===t.charCodeAt(s)&&++s,t.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(a(e),0===e.length)return".";for(var t=e.charCodeAt(0),r=47===t,n=-1,i=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!i){n=o;break}}else i=!1;return-1===n?r?"/":".":r&&1===n?"//":e.slice(0,n)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');a(e);var r,n=0,i=-1,o=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var s=t.length-1,l=-1;for(r=e.length-1;r>=0;--r){var c=e.charCodeAt(r);if(47===c){if(!o){n=r+1;break}}else-1===l&&(o=!1,l=r+1),s>=0&&(c===t.charCodeAt(s)?-1===--s&&(i=r):(s=-1,i=l))}return n===i?i=l:-1===i&&(i=e.length),e.slice(n,i)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!o){n=r+1;break}}else-1===i&&(o=!1,i=r+1);return-1===i?"":e.slice(n,i)},extname:function(e){a(e);for(var t=-1,r=0,n=-1,i=!0,o=0,s=e.length-1;s>=0;--s){var l=e.charCodeAt(s);if(47!==l)-1===n&&(i=!1,n=s+1),46===l?-1===t?t=s:1!==o&&(o=1):-1!==t&&(o=-1);else if(!i){r=s+1;break}}return-1===t||-1===n||0===o||1===o&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var r=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return r?r===t.root?r+n:r+"/"+n:n}(0,e)},parse:function(e){a(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var r,n=e.charCodeAt(0),i=47===n;i?(t.root="/",r=1):r=0;for(var o=-1,s=0,l=-1,c=!0,u=e.length-1,d=0;u>=r;--u)if(47!==(n=e.charCodeAt(u)))-1===l&&(c=!1,l=u+1),46===n?-1===o?o=u:1!==d&&(d=1):-1!==o&&(d=-1);else if(!c){s=u+1;break}return-1===o||-1===l||0===d||1===d&&o===l-1&&o===s+1?-1!==l&&(t.base=t.name=0===s&&i?e.slice(1,l):e.slice(s,l)):(0===s&&i?(t.name=e.slice(1,o),t.base=e.slice(1,l)):(t.name=e.slice(s,o),t.base=e.slice(s,l)),t.ext=e.slice(o,l)),s>0?t.dir=e.slice(0,s-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};o.posix=o,e.exports=o},8058:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MpcSv8Parser=void 0;const n=r(7833),a=r(6373),i=r(9156),o=r(3232),s=r(1032),l=(0,n.default)("music-metadata:parser:musepack");class c extends a.BasicParser{constructor(){super(...arguments),this.audioLength=0}async parse(){if("MPCK"!==await this.tokenizer.readToken(o.FourCcToken))throw new Error("Invalid Magic number");return this.metadata.setFormat("container","Musepack, SV8"),this.parsePacket()}async parsePacket(){const e=new s.StreamReader(this.tokenizer);for(;;){const t=await e.readPacketHeader();switch(l(`packet-header key=${t.key}, payloadLength=${t.payloadLength}`),t.key){case"SH":const r=await e.readStreamHeader(t.payloadLength);this.metadata.setFormat("numberOfSamples",r.sampleCount),this.metadata.setFormat("sampleRate",r.sampleFrequency),this.metadata.setFormat("duration",r.sampleCount/r.sampleFrequency),this.metadata.setFormat("numberOfChannels",r.channelCount);break;case"AP":this.audioLength+=t.payloadLength,await this.tokenizer.ignore(t.payloadLength);break;case"RG":case"EI":case"SO":case"ST":case"CT":await this.tokenizer.ignore(t.payloadLength);break;case"SE":return this.metadata.setFormat("bitrate",8*this.audioLength/this.metadata.format.duration),i.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options);default:throw new Error(`Unexpected header: ${t.key}`)}}}}t.MpcSv8Parser=c},8122:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0,t.Deferred=class{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((e,t)=>{this.reject=t,this.resolve=e})}}},8287:(e,t,r)=>{const n=r(7526),a=r(251),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50;const o=2147483647;function s(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return c(e,t,r)}function c(e,t,r){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|m(e,t);let n=s(r);const a=n.write(e,t);return a!==r&&(n=n.slice(0,a)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Y(e,Uint8Array)){const t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return p(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Y(e,ArrayBuffer)||e&&Y(e.buffer,ArrayBuffer))return f(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(Y(e,SharedArrayBuffer)||e&&Y(e.buffer,SharedArrayBuffer)))return f(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return l.from(n,t,r);const a=function(e){if(l.isBuffer(e)){const t=0|h(e.length),r=s(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||K(e.length)?s(0):p(e):"Buffer"===e.type&&Array.isArray(e.data)?p(e.data):void 0}(e);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return u(e),s(e<0?0:0|h(e))}function p(e){const t=e.length<0?0:0|h(e.length),r=s(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function f(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,l.prototype),n}function h(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function m(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Y(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let a=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return X(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return V(e).length;default:if(a)return n?-1:X(e).length;t=(""+t).toLowerCase(),a=!0}}function g(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return B(this,t,r);case"utf8":case"utf-8":return k(this,t,r);case"ascii":return C(this,t,r);case"latin1":case"binary":return x(this,t,r);case"base64":return I(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function y(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function b(e,t,r,n,a){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),K(r=+r)&&(r=a?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(a)return-1;r=e.length-1}else if(r<0){if(!a)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:w(e,t,r,n,a);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):w(e,[t],r,n,a);throw new TypeError("val must be string, number or Buffer")}function w(e,t,r,n,a){let i,o=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(a){let n=-1;for(i=r;i<s;i++)if(c(e,i)===c(t,-1===n?0:i-n)){if(-1===n&&(n=i),i-n+1===l)return n*o}else-1!==n&&(i-=i-n),n=-1}else for(r+l>s&&(r=s-l),i=r;i>=0;i--){let r=!0;for(let n=0;n<l;n++)if(c(e,i+n)!==c(t,n)){r=!1;break}if(r)return i}return-1}function T(e,t,r,n){r=Number(r)||0;const a=e.length-r;n?(n=Number(n))>a&&(n=a):n=a;const i=t.length;let o;for(n>i/2&&(n=i/2),o=0;o<n;++o){const n=parseInt(t.substr(2*o,2),16);if(K(n))return o;e[r+o]=n}return o}function v(e,t,r,n){return q(X(t,e.length-r),e,r,n)}function _(e,t,r,n){return q(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function E(e,t,r,n){return q(V(t),e,r,n)}function S(e,t,r,n){return q(function(e,t){let r,n,a;const i=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,a=r%256,i.push(a),i.push(n);return i}(t,e.length-r),e,r,n)}function I(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function k(e,t,r){r=Math.min(e.length,r);const n=[];let a=t;for(;a<r;){const t=e[a];let i=null,o=t>239?4:t>223?3:t>191?2:1;if(a+o<=r){let r,n,s,l;switch(o){case 1:t<128&&(i=t);break;case 2:r=e[a+1],128==(192&r)&&(l=(31&t)<<6|63&r,l>127&&(i=l));break;case 3:r=e[a+1],n=e[a+2],128==(192&r)&&128==(192&n)&&(l=(15&t)<<12|(63&r)<<6|63&n,l>2047&&(l<55296||l>57343)&&(i=l));break;case 4:r=e[a+1],n=e[a+2],s=e[a+3],128==(192&r)&&128==(192&n)&&128==(192&s)&&(l=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&s,l>65535&&l<1114112&&(i=l))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),a+=o}return function(e){const t=e.length;if(t<=A)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=A));return r}(n)}t.kMaxLength=o,l.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,r){return c(e,t,r)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,r){return function(e,t,r){return u(e),e<=0?s(e):void 0!==t?"string"==typeof r?s(e).fill(t,r):s(e).fill(t):s(e)}(e,t,r)},l.allocUnsafe=function(e){return d(e)},l.allocUnsafeSlow=function(e){return d(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(Y(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),Y(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let a=0,i=Math.min(r,n);a<i;++a)if(e[a]!==t[a]){r=e[a],n=t[a];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=l.allocUnsafe(t);let a=0;for(r=0;r<e.length;++r){let t=e[r];if(Y(t,Uint8Array))a+t.length>n.length?(l.isBuffer(t)||(t=l.from(t)),t.copy(n,a)):Uint8Array.prototype.set.call(n,t,a);else{if(!l.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,a)}a+=t.length}return n},l.byteLength=m,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)y(this,t,t+1);return this},l.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},l.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},l.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?k(this,0,e):g.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){let e="";const r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},i&&(l.prototype[i]=l.prototype.inspect),l.prototype.compare=function(e,t,r,n,a){if(Y(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===a&&(a=this.length),t<0||r>e.length||n<0||a>this.length)throw new RangeError("out of range index");if(n>=a&&t>=r)return 0;if(n>=a)return-1;if(t>=r)return 1;if(this===e)return 0;let i=(a>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0);const s=Math.min(i,o),c=this.slice(n,a),u=e.slice(t,r);for(let e=0;e<s;++e)if(c[e]!==u[e]){i=c[e],o=u[e];break}return i<o?-1:o<i?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return b(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return b(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const a=this.length-t;if((void 0===r||r>a)&&(r=a),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let i=!1;for(;;)switch(n){case"hex":return T(this,e,t,r);case"utf8":case"utf-8":return v(this,e,t,r);case"ascii":case"latin1":case"binary":return _(this,e,t,r);case"base64":return E(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const A=4096;function C(e,t,r){let n="";r=Math.min(e.length,r);for(let a=t;a<r;++a)n+=String.fromCharCode(127&e[a]);return n}function x(e,t,r){let n="";r=Math.min(e.length,r);for(let a=t;a<r;++a)n+=String.fromCharCode(e[a]);return n}function B(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let a="";for(let n=t;n<r;++n)a+=Z[e[n]];return a}function D(e,t,r){const n=e.slice(t,r);let a="";for(let e=0;e<n.length-1;e+=2)a+=String.fromCharCode(n[e]+256*n[e+1]);return a}function P(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,r,n,a,i){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function M(e,t,r,n,a){W(t,n,a,e,r,7);let i=Number(t&BigInt(4294967295));e[r++]=i,i>>=8,e[r++]=i,i>>=8,e[r++]=i,i>>=8,e[r++]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function F(e,t,r,n,a){W(t,n,a,e,r,7);let i=Number(t&BigInt(4294967295));e[r+7]=i,i>>=8,e[r+6]=i,i>>=8,e[r+5]=i,i>>=8,e[r+4]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function L(e,t,r,n,a,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function O(e,t,r,n,i){return t=+t,r>>>=0,i||L(e,0,r,4),a.write(e,t,r,n,23,4),r+4}function N(e,t,r,n,i){return t=+t,r>>>=0,i||L(e,0,r,8),a.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,l.prototype),n},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);let n=this[e],a=1,i=0;for(;++i<t&&(a*=256);)n+=this[e+i]*a;return n},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);let n=this[e+--t],a=1;for(;t>0&&(a*=256);)n+=this[e+--t]*a;return n},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=J(function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||H(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,a=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(a)<<BigInt(32))}),l.prototype.readBigUInt64BE=J(function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||H(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],a=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(a)}),l.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);let n=this[e],a=1,i=0;for(;++i<t&&(a*=256);)n+=this[e+i]*a;return a*=128,n>=a&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);let n=t,a=1,i=this[e+--n];for(;n>0&&(a*=256);)i+=this[e+--n]*a;return a*=128,i>=a&&(i-=Math.pow(2,8*t)),i},l.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=J(function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||H(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)}),l.prototype.readBigInt64BE=J(function(e){$(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||H(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)}),l.prototype.readFloatLE=function(e,t){return e>>>=0,t||P(e,4,this.length),a.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||P(e,4,this.length),a.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||P(e,8,this.length),a.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||P(e,8,this.length),a.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||R(this,e,t,r,Math.pow(2,8*r)-1,0);let a=1,i=0;for(this[t]=255&e;++i<r&&(a*=256);)this[t+i]=e/a&255;return t+r},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||R(this,e,t,r,Math.pow(2,8*r)-1,0);let a=r-1,i=1;for(this[t+a]=255&e;--a>=0&&(i*=256);)this[t+a]=e/i&255;return t+r},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigUInt64LE=J(function(e,t=0){return M(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=J(function(e,t=0){return F(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);R(this,e,t,r,n-1,-n)}let a=0,i=1,o=0;for(this[t]=255&e;++a<r&&(i*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/i|0)-o&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);R(this,e,t,r,n-1,-n)}let a=r-1,i=1,o=0;for(this[t+a]=255&e;--a>=0&&(i*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/i|0)-o&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigInt64LE=J(function(e,t=0){return M(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=J(function(e,t=0){return F(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeFloatLE=function(e,t,r){return O(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return O(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return N(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return N(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const a=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),a},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{const i=l.isBuffer(e)?e:l.from(e,n),o=i.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<r-t;++a)this[a+t]=i[a%o]}return this};const U={};function z(e,t,r){U[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function j(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function W(e,t,r,n,a,i){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let a;throw a=i>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(i+1)}${n}`:`>= -(2${n} ** ${8*(i+1)-1}${n}) and < 2 ** ${8*(i+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new U.ERR_OUT_OF_RANGE("value",a,e)}!function(e,t,r){$(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||H(t,e.length-(r+1))}(n,a,i)}function $(e,t){if("number"!=typeof e)throw new U.ERR_INVALID_ARG_TYPE(t,"number",e)}function H(e,t,r){if(Math.floor(e)!==e)throw $(e,r),new U.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new U.ERR_BUFFER_OUT_OF_BOUNDS;throw new U.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}z("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),z("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),z("ERR_OUT_OF_RANGE",function(e,t,r){let n=`The value of "${e}" is out of range.`,a=r;return Number.isInteger(r)&&Math.abs(r)>2**32?a=j(String(r)):"bigint"==typeof r&&(a=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(a=j(a)),a+="n"),n+=` It must be ${t}. Received ${a}`,n},RangeError);const G=/[^+/0-9A-Za-z-_]/g;function X(e,t){let r;t=t||1/0;const n=e.length;let a=null;const i=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!a){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&i.push(239,191,189);continue}a=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),a=r;continue}r=65536+(a-55296<<10|r-56320)}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function V(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(G,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,r,n){let a;for(a=0;a<n&&!(a+r>=t.length||a>=e.length);++a)t[a+r]=e[a];return a}function Y(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function K(e){return e!=e}const Z=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let a=0;a<16;++a)t[n+a]=e[r]+e[a]}return t}();function J(e){return"undefined"==typeof BigInt?Q:e}function Q(){throw new Error("BigInt not supported")}},8296:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.MP4Parser=void 0;const a=r(7833),i=r(1028),o=r(6373),s=r(3512),l=r(7338),c=r(1919),u=r(7550),d=(0,a.default)("music-metadata:parser:MP4"),p={raw:{lossy:!1,format:"raw"},MAC3:{lossy:!0,format:"MACE 3:1"},MAC6:{lossy:!0,format:"MACE 6:1"},ima4:{lossy:!0,format:"IMA 4:1"},ulaw:{lossy:!0,format:"uLaw 2:1"},alaw:{lossy:!0,format:"uLaw 2:1"},Qclp:{lossy:!0,format:"QUALCOMM PureVoice"},".mp3":{lossy:!0,format:"MPEG-1 layer 3"},alac:{lossy:!1,format:"ALAC"},"ac-3":{lossy:!0,format:"AC-3"},mp4a:{lossy:!0,format:"MPEG-4/AAC"},mp4s:{lossy:!0,format:"MP4S"},c608:{lossy:!0,format:"CEA-608"},c708:{lossy:!0,format:"CEA-708"}};function f(e,t,r){return r.indexOf(e)===t}class h extends o.BasicParser{constructor(){super(...arguments),this.atomParsers={mvhd:async e=>{const t=await this.tokenizer.readToken(new u.MvhdAtom(e));this.metadata.setFormat("creationTime",t.creationTime),this.metadata.setFormat("modificationTime",t.modificationTime)},mdhd:async e=>{const t=await this.tokenizer.readToken(new u.MdhdAtom(e)),r=this.getTrackDescription();r.creationTime=t.creationTime,r.modificationTime=t.modificationTime,r.timeScale=t.timeScale,r.duration=t.duration},chap:async e=>{const t=this.getTrackDescription(),r=[];for(;e>=i.UINT32_BE.len;)r.push(await this.tokenizer.readNumber(i.UINT32_BE)),e-=i.UINT32_BE.len;t.chapterList=r},tkhd:async e=>{const t=await this.tokenizer.readToken(new u.TrackHeaderAtom(e));this.tracks.push(t)},mdat:async e=>{if(this.audioLengthInBytes=e,this.calculateBitRate(),this.options.includeChapters){const t=this.tracks.filter(e=>e.chapterList);if(1===t.length){const r=t[0].chapterList,n=this.tracks.filter(e=>-1!==r.indexOf(e.trackId));if(1===n.length)return this.parseChapterTrack(n[0],t[0],e)}}await this.tokenizer.ignore(e)},ftyp:async e=>{const t=[];for(;e>0;){const r=await this.tokenizer.readToken(u.ftyp);e-=u.ftyp.len;const n=r.type.replace(/\W/g,"");n.length>0&&t.push(n)}d(`ftyp: ${t.join("/")}`);const r=t.filter(f).join("/");this.metadata.setFormat("container",r)},stsd:async e=>{const t=await this.tokenizer.readToken(new u.StsdAtom(e));this.getTrackDescription().soundSampleDescription=t.table.map(e=>this.parseSoundSampleDescription(e))},stsc:async e=>{const t=await this.tokenizer.readToken(new u.StscAtom(e));this.getTrackDescription().sampleToChunkTable=t.entries},stts:async e=>{const t=await this.tokenizer.readToken(new u.SttsAtom(e));this.getTrackDescription().timeToSampleTable=t.entries},stsz:async e=>{const t=await this.tokenizer.readToken(new u.StszAtom(e)),r=this.getTrackDescription();r.sampleSize=t.sampleSize,r.sampleSizeTable=t.entries},stco:async e=>{const t=await this.tokenizer.readToken(new u.StcoAtom(e));this.getTrackDescription().chunkOffsetTable=t.entries},date:async e=>{const t=await this.tokenizer.readToken(new i.StringType(e,"utf-8"));this.addTag("date",t)}}}static read_BE_Integer(e,t){const r=(t?"INT":"UINT")+8*e.length+(e.length>1?"_BE":""),n=i[r];if(!n)throw new Error('Token for integer type not found: "'+r+'"');return Number(n.get(e,0))}async parse(){this.tracks=[];let e=this.tokenizer.fileInfo.size;for(;!this.tokenizer.fileInfo.size||e>0;){try{if("\0\0\0\0"===(await this.tokenizer.peekToken(u.Header)).name){const e=`Error at offset=${this.tokenizer.position}: box.id=0`;d(e),this.addWarning(e);break}}catch(e){const t=`Error at offset=${this.tokenizer.position}: ${e.message}`;d(t),this.addWarning(t);break}const t=await c.Atom.readAtom(this.tokenizer,(e,t)=>this.handleAtom(e,t),null,e);e-=t.header.length===BigInt(0)?e:Number(t.header.length)}const t=[];this.tracks.forEach(e=>{const r=[];e.soundSampleDescription.forEach(e=>{const t={},n=p[e.dataFormat];if(n?(r.push(n.format),t.codecName=n.format):t.codecName=`<${e.dataFormat}>`,e.description){const{description:r}=e;r.sampleRate>0&&(t.type=l.TrackType.audio,t.audio={samplingFrequency:r.sampleRate,bitDepth:r.sampleSize,channels:r.numAudioChannels})}this.metadata.addStreamInfo(t)}),r.length>=1&&t.push(r.join("/"))}),t.length>0&&this.metadata.setFormat("codec",t.filter(f).join("+"));const r=this.tracks.filter(e=>e.soundSampleDescription.length>=1&&e.soundSampleDescription[0].description&&e.soundSampleDescription[0].description.numAudioChannels>0);if(r.length>=1){const e=r[0];if(e.timeScale>0){const t=e.duration/e.timeScale;this.metadata.setFormat("duration",t)}const t=e.soundSampleDescription[0];if(t.description&&(this.metadata.setFormat("sampleRate",t.description.sampleRate),this.metadata.setFormat("bitsPerSample",t.description.sampleSize),this.metadata.setFormat("numberOfChannels",t.description.numAudioChannels),0===e.timeScale&&e.timeToSampleTable.length>0)){const r=e.timeToSampleTable.map(e=>e.count*e.duration).reduce((e,t)=>e+t)/t.description.sampleRate;this.metadata.setFormat("duration",r)}const n=p[t.dataFormat];n&&this.metadata.setFormat("lossless",!n.lossy),this.calculateBitRate()}}async handleAtom(e,t){if(e.parent)switch(e.parent.header.name){case"ilst":case"<id>":return this.parseMetadataItemData(e)}if(this.atomParsers[e.header.name])return this.atomParsers[e.header.name](t);d(`No parser for atom path=${e.atomPath}, payload-len=${t}, ignoring atom`),await this.tokenizer.ignore(t)}getTrackDescription(){return this.tracks[this.tracks.length-1]}calculateBitRate(){this.audioLengthInBytes&&this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*this.audioLengthInBytes/this.metadata.format.duration)}addTag(e,t){this.metadata.addTag("iTunes",e,t)}addWarning(e){d("Warning: "+e),this.metadata.addWarning(e)}parseMetadataItemData(e){let t=e.header.name;return e.readAtoms(this.tokenizer,async(e,r)=>{const n=e.getPayloadLength(r);switch(e.header.name){case"data":return this.parseValueAtom(t,e);case"name":case"mean":case"rate":const r=await this.tokenizer.readToken(new u.NameAtom(n));t+=":"+r.name;break;default:const a=await this.tokenizer.readToken(new i.BufferType(n));this.addWarning("Unsupported meta-item: "+t+"["+e.header.name+"] => value="+a.toString("hex")+" ascii="+a.toString("ascii"))}},e.getPayloadLength(0))}async parseValueAtom(e,t){const r=await this.tokenizer.readToken(new u.DataAtom(Number(t.header.length)-u.Header.len));if(0!==r.type.set)throw new Error("Unsupported type-set != 0: "+r.type.set);switch(r.type.type){case 0:switch(e){case"trkn":case"disk":const n=i.UINT8.get(r.value,3),a=i.UINT8.get(r.value,5);this.addTag(e,n+"/"+a);break;case"gnre":const o=i.UINT8.get(r.value,1),l=s.Genres[o-1];this.addTag(e,l);break;case"rate":const c=r.value.toString("ascii");this.addTag(e,c);break;default:d("unknown proprietary value type for: "+t.atomPath)}break;case 1:case 18:this.addTag(e,r.value.toString("utf-8"));break;case 13:if(this.options.skipCovers)break;this.addTag(e,{format:"image/jpeg",data:n.from(r.value)});break;case 14:if(this.options.skipCovers)break;this.addTag(e,{format:"image/png",data:n.from(r.value)});break;case 21:this.addTag(e,h.read_BE_Integer(r.value,!0));break;case 22:this.addTag(e,h.read_BE_Integer(r.value,!1));break;case 65:this.addTag(e,r.value.readInt8(0));break;case 66:this.addTag(e,r.value.readInt16BE(0));break;case 67:this.addTag(e,r.value.readInt32BE(0));break;default:this.addWarning(`atom key=${e}, has unknown well-known-type (data-type): ${r.type.type}`)}}parseSoundSampleDescription(e){const t={dataFormat:e.dataFormat,dataReferenceIndex:e.dataReferenceIndex};let r=0;const n=u.SoundSampleDescriptionVersion.get(e.description,r);return r+=u.SoundSampleDescriptionVersion.len,0===n.version||1===n.version?t.description=u.SoundSampleDescriptionV0.get(e.description,r):d(`Warning: sound-sample-description ${n} not implemented`),t}async parseChapterTrack(e,t,r){if(!e.sampleSize&&e.chunkOffsetTable.length!==e.sampleSizeTable.length)throw new Error("Expected equal chunk-offset-table & sample-size-table length.");const n=[];for(let a=0;a<e.chunkOffsetTable.length&&r>0;++a){const i=e.chunkOffsetTable[a]-this.tokenizer.position,o=e.sampleSize>0?e.sampleSize:e.sampleSizeTable[a];if((r-=i+o)<0)throw new Error("Chapter chunk exceeding token length");await this.tokenizer.ignore(i);const s=await this.tokenizer.readToken(new u.ChapterText(o));d(`Chapter ${a+1}: ${s}`);const l={title:s,sampleOffset:this.findSampleOffset(t,this.tokenizer.position)};d(`Chapter title=${l.title}, offset=${l.sampleOffset}/${this.tracks[0].duration}`),n.push(l)}this.metadata.setFormat("chapters",n),await this.tokenizer.ignore(r)}findSampleOffset(e,t){let r=0;e.timeToSampleTable.forEach(e=>{r+=e.count*e.duration}),d(`Total duration=${r}`);let n=0;for(;n<e.chunkOffsetTable.length&&e.chunkOffsetTable[n]<t;)++n;return this.getChunkDuration(n+1,e)}getChunkDuration(e,t){let r=0,n=t.timeToSampleTable[r].count,a=t.timeToSampleTable[r].duration,i=1,o=this.getSamplesPerChunk(i,t.sampleToChunkTable),s=0;for(;i<e;){const e=Math.min(n,o);s+=e*a,n-=e,o-=e,0===o?(++i,o=this.getSamplesPerChunk(i,t.sampleToChunkTable)):(++r,n=t.timeToSampleTable[r].count,a=t.timeToSampleTable[r].duration)}return s}getSamplesPerChunk(e,t){for(let r=0;r<t.length-1;++r)if(e>=t[r].firstChunk&&e<t[r+1].firstChunk)return t[r].samplesPerChunk;return t[t.length-1].samplesPerChunk}}t.MP4Parser=h},8344:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.ID3v2Parser=void 0;const a=r(1028),i=r(6378),o=r(3571),s=r(2298);class l{static removeUnsyncBytes(e){let t=0,r=0;for(;t<e.length-1;)t!==r&&(e[r]=e[t]),t+=255===e[t]&&0===e[t+1]?2:1,r++;return t<e.length&&(e[r++]=e[t]),e.slice(0,r)}static getFrameHeaderLength(e){switch(e){case 2:return 6;case 3:case 4:return 10;default:throw new Error("header versionIndex is incorrect")}}static readFrameFlags(e){return{status:{tag_alter_preservation:i.getBit(e,0,6),file_alter_preservation:i.getBit(e,0,5),read_only:i.getBit(e,0,4)},format:{grouping_identity:i.getBit(e,1,7),compression:i.getBit(e,1,3),encryption:i.getBit(e,1,2),unsynchronisation:i.getBit(e,1,1),data_length_indicator:i.getBit(e,1,0)}}}static readFrameData(e,t,r,n,a){const i=new o.FrameParser(r,a);switch(r){case 2:return i.readData(e,t.id,n);case 3:case 4:return t.flags.format.unsynchronisation&&(e=l.removeUnsyncBytes(e)),t.flags.format.data_length_indicator&&(e=e.slice(4,e.length)),i.readData(e,t.id,n);default:throw new Error("Unexpected majorVer: "+r)}}static makeDescriptionTagName(e,t){return e+(t?":"+t:"")}async parse(e,t,r){this.tokenizer=t,this.metadata=e,this.options=r;const n=await this.tokenizer.readToken(s.ID3v2Header);if("ID3"!==n.fileIdentifier)throw new Error("expected ID3-header file-identifier 'ID3' was not found");return this.id3Header=n,this.headerType="ID3v2."+n.version.major,n.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(n.size)}async parseExtendedHeader(){const e=await this.tokenizer.readToken(s.ExtendedHeader),t=e.size-s.ExtendedHeader.len;return t>0?this.parseExtendedHeaderData(t,e.size):this.parseId3Data(this.id3Header.size-e.size)}async parseExtendedHeaderData(e,t){return await this.tokenizer.ignore(e),this.parseId3Data(this.id3Header.size-t)}async parseId3Data(e){const t=await this.tokenizer.readToken(new a.Uint8ArrayType(e));for(const e of this.parseMetadata(t))if("TXXX"===e.id){if(e.value)for(const t of e.value.text)this.addTag(l.makeDescriptionTagName(e.id,e.value.description),t)}else if("COM"===e.id)for(const t of e.value)this.addTag(l.makeDescriptionTagName(e.id,t.description),t.text);else if("COMM"===e.id)for(const t of e.value)this.addTag(l.makeDescriptionTagName(e.id,t.description),t);else if(Array.isArray(e.value))for(const t of e.value)this.addTag(e.id,t);else this.addTag(e.id,e.value)}addTag(e,t){this.metadata.addTag(this.headerType,e,t)}parseMetadata(e){let t=0;const r=[];for(;t!==e.length;){const n=l.getFrameHeaderLength(this.id3Header.version.major);if(t+n>e.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}const a=e.slice(t,t+=n),i=this.readFrameHeader(a,this.id3Header.version.major),o=e.slice(t,t+=i.length),s=l.readFrameData(o,i,this.id3Header.version.major,!this.options.skipCovers,this.metadata);s&&r.push({id:i.id,value:s})}return r}readFrameHeader(e,t){let r;switch(t){case 2:r={id:n.from(e.slice(0,3)).toString("ascii"),length:a.UINT24_BE.get(e,3)},r.id.match(/[A-Z0-9]{3}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${r.id}`);break;case 3:case 4:r={id:n.from(e.slice(0,4)).toString("ascii"),length:(4===t?s.UINT32SYNCSAFE:a.UINT32_BE).get(e,4),flags:l.readFrameFlags(e.slice(8,10))},r.id.match(/[A-Z0-9]{4}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${r.id}`);break;default:throw new Error("Unexpected majorVer: "+t)}return r}}t.ID3v2Parser=l},8584:(e,t,r)=>{const n=r(5606),{ArrayPrototypeSlice:a,Error:i,FunctionPrototypeSymbolHasInstance:o,ObjectDefineProperty:s,ObjectDefineProperties:l,ObjectSetPrototypeOf:c,StringPrototypeToLowerCase:u,Symbol:d,SymbolHasInstance:p}=r(4134);e.exports=M,M.WritableState=P;const{EventEmitter:f}=r(7007),h=r(4259).Stream,{Buffer:m}=r(8287),g=r(3515),{addAbortSignal:y}=r(4147),{getHighWaterMark:b,getDefaultHighWaterMark:w}=r(5291),{ERR_INVALID_ARG_TYPE:T,ERR_METHOD_NOT_IMPLEMENTED:v,ERR_MULTIPLE_CALLBACK:_,ERR_STREAM_CANNOT_PIPE:E,ERR_STREAM_DESTROYED:S,ERR_STREAM_ALREADY_FINISHED:I,ERR_STREAM_NULL_VALUES:k,ERR_STREAM_WRITE_AFTER_END:A,ERR_UNKNOWN_ENCODING:C}=r(6371).codes,{errorOrDestroy:x}=g;function B(){}c(M.prototype,h.prototype),c(M,h);const D=d("kOnFinished");function P(e,t,n){"boolean"!=typeof n&&(n=t instanceof r(3370)),this.objectMode=!(!e||!e.objectMode),n&&(this.objectMode=this.objectMode||!(!e||!e.writableObjectMode)),this.highWaterMark=e?b(this,e,"writableHighWaterMark",n):w(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const a=!(!e||!1!==e.decodeStrings);this.decodeStrings=!a,this.defaultEncoding=e&&e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=N.bind(void 0,t),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,R(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!e||!1!==e.emitClose,this.autoDestroy=!e||!1!==e.autoDestroy,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[D]=[]}function R(e){e.buffered=[],e.bufferedIndex=0,e.allBuffers=!0,e.allNoop=!0}function M(e){const t=this instanceof r(3370);if(!t&&!o(M,this))return new M(e);this._writableState=new P(e,this,t),e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final),"function"==typeof e.construct&&(this._construct=e.construct),e.signal&&y(e.signal,this)),h.call(this,e),g.construct(this,()=>{const e=this._writableState;e.writing||W(this,e),H(this,e)})}function F(e,t,r,a){const i=e._writableState;if("function"==typeof r)a=r,r=i.defaultEncoding;else{if(r){if("buffer"!==r&&!m.isEncoding(r))throw new C(r)}else r=i.defaultEncoding;"function"!=typeof a&&(a=B)}if(null===t)throw new k;if(!i.objectMode)if("string"==typeof t)!1!==i.decodeStrings&&(t=m.from(t,r),r="buffer");else if(t instanceof m)r="buffer";else{if(!h._isUint8Array(t))throw new T("chunk",["string","Buffer","Uint8Array"],t);t=h._uint8ArrayToBuffer(t),r="buffer"}let o;return i.ending?o=new A:i.destroyed&&(o=new S("write")),o?(n.nextTick(a,o),x(e,o,!0),o):(i.pendingcb++,function(e,t,r,n,a){const i=t.objectMode?1:r.length;t.length+=i;const o=t.length<t.highWaterMark;return o||(t.needDrain=!0),t.writing||t.corked||t.errored||!t.constructed?(t.buffered.push({chunk:r,encoding:n,callback:a}),t.allBuffers&&"buffer"!==n&&(t.allBuffers=!1),t.allNoop&&a!==B&&(t.allNoop=!1)):(t.writelen=i,t.writecb=a,t.writing=!0,t.sync=!0,e._write(r,n,t.onwrite),t.sync=!1),o&&!t.errored&&!t.destroyed}(e,i,t,r,a))}function L(e,t,r,n,a,i,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new S("write")):r?e._writev(a,t.onwrite):e._write(a,i,t.onwrite),t.sync=!1}function O(e,t,r,n){--t.pendingcb,n(r),j(t),x(e,r)}function N(e,t){const r=e._writableState,a=r.sync,i=r.writecb;"function"==typeof i?(r.writing=!1,r.writecb=null,r.length-=r.writelen,r.writelen=0,t?(t.stack,r.errored||(r.errored=t),e._readableState&&!e._readableState.errored&&(e._readableState.errored=t),a?n.nextTick(O,e,r,t,i):O(e,r,t,i)):(r.buffered.length>r.bufferedIndex&&W(e,r),a?null!==r.afterWriteTickInfo&&r.afterWriteTickInfo.cb===i?r.afterWriteTickInfo.count++:(r.afterWriteTickInfo={count:1,cb:i,stream:e,state:r},n.nextTick(U,r.afterWriteTickInfo)):z(e,r,1,i))):x(e,new _)}function U({stream:e,state:t,count:r,cb:n}){return t.afterWriteTickInfo=null,z(e,t,r,n)}function z(e,t,r,n){for(!t.ending&&!e.destroyed&&0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"));r-- >0;)t.pendingcb--,n();t.destroyed&&j(t),H(e,t)}function j(e){if(e.writing)return;for(let r=e.bufferedIndex;r<e.buffered.length;++r){var t;const{chunk:n,callback:a}=e.buffered[r],i=e.objectMode?1:n.length;e.length-=i,a(null!==(t=e.errored)&&void 0!==t?t:new S("write"))}const r=e[D].splice(0);for(let t=0;t<r.length;t++){var n;r[t](null!==(n=e.errored)&&void 0!==n?n:new S("end"))}R(e)}function W(e,t){if(t.corked||t.bufferProcessing||t.destroyed||!t.constructed)return;const{buffered:r,bufferedIndex:n,objectMode:i}=t,o=r.length-n;if(!o)return;let s=n;if(t.bufferProcessing=!0,o>1&&e._writev){t.pendingcb-=o-1;const n=t.allNoop?B:e=>{for(let t=s;t<r.length;++t)r[t].callback(e)},i=t.allNoop&&0===s?r:a(r,s);i.allBuffers=t.allBuffers,L(e,t,!0,t.length,i,"",n),R(t)}else{do{const{chunk:n,encoding:a,callback:o}=r[s];r[s++]=null,L(e,t,!1,i?1:n.length,n,a,o)}while(s<r.length&&!t.writing);s===r.length?R(t):s>256?(r.splice(0,s),t.bufferedIndex=0):t.bufferedIndex=s}t.bufferProcessing=!1}function $(e){return e.ending&&!e.destroyed&&e.constructed&&0===e.length&&!e.errored&&0===e.buffered.length&&!e.finished&&!e.writing&&!e.errorEmitted&&!e.closeEmitted}function H(e,t,r){$(t)&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.finalCalled=!0,function(e,t){let r=!1;function a(a){if(r)x(e,null!=a?a:_());else if(r=!0,t.pendingcb--,a){const r=t[D].splice(0);for(let e=0;e<r.length;e++)r[e](a);x(e,a,t.sync)}else $(t)&&(t.prefinished=!0,e.emit("prefinish"),t.pendingcb++,n.nextTick(G,e,t))}t.sync=!0,t.pendingcb++;try{e._final(a)}catch(e){a(e)}t.sync=!1}(e,t)))}(e,t),0===t.pendingcb&&(r?(t.pendingcb++,n.nextTick((e,t)=>{$(t)?G(e,t):t.pendingcb--},e,t)):$(t)&&(t.pendingcb++,G(e,t))))}function G(e,t){t.pendingcb--,t.finished=!0;const r=t[D].splice(0);for(let e=0;e<r.length;e++)r[e]();if(e.emit("finish"),t.autoDestroy){const t=e._readableState;(!t||t.autoDestroy&&(t.endEmitted||!1===t.readable))&&e.destroy()}}P.prototype.getBuffer=function(){return a(this.buffered,this.bufferedIndex)},s(P.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}}),s(M,p,{__proto__:null,value:function(e){return!!o(this,e)||this===M&&e&&e._writableState instanceof P}}),M.prototype.pipe=function(){x(this,new E)},M.prototype.write=function(e,t,r){return!0===F(this,e,t,r)},M.prototype.cork=function(){this._writableState.corked++},M.prototype.uncork=function(){const e=this._writableState;e.corked&&(e.corked--,e.writing||W(this,e))},M.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=u(e)),!m.isEncoding(e))throw new C(e);return this._writableState.defaultEncoding=e,this},M.prototype._write=function(e,t,r){if(!this._writev)throw new v("_write()");this._writev([{chunk:e,encoding:t}],r)},M.prototype._writev=null,M.prototype.end=function(e,t,r){const a=this._writableState;let o;if("function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e){const r=F(this,e,t);r instanceof i&&(o=r)}return a.corked&&(a.corked=1,this.uncork()),o||(a.errored||a.ending?a.finished?o=new I("end"):a.destroyed&&(o=new S("end")):(a.ending=!0,H(this,a,!0),a.ended=!0)),"function"==typeof r&&(o||a.finished?n.nextTick(r,o):a[D].push(r)),this},l(M.prototype,{closed:{__proto__:null,get(){return!!this._writableState&&this._writableState.closed}},destroyed:{__proto__:null,get(){return!!this._writableState&&this._writableState.destroyed},set(e){this._writableState&&(this._writableState.destroyed=e)}},writable:{__proto__:null,get(){const e=this._writableState;return!(!e||!1===e.writable||e.destroyed||e.errored||e.ending||e.ended)},set(e){this._writableState&&(this._writableState.writable=!!e)}},writableFinished:{__proto__:null,get(){return!!this._writableState&&this._writableState.finished}},writableObjectMode:{__proto__:null,get(){return!!this._writableState&&this._writableState.objectMode}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return!!this._writableState&&this._writableState.ending}},writableNeedDrain:{__proto__:null,get(){const e=this._writableState;return!!e&&!e.destroyed&&!e.ending&&e.needDrain}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!(!1===this._writableState.writable||!this._writableState.destroyed&&!this._writableState.errored||this._writableState.finished)}}});const X=g.destroy;let V;function q(){return void 0===V&&(V={}),V}M.prototype.destroy=function(e,t){const r=this._writableState;return!r.destroyed&&(r.bufferedIndex<r.buffered.length||r[D].length)&&n.nextTick(j,r),X.call(this,e,t),this},M.prototype._undestroy=g.undestroy,M.prototype._destroy=function(e,t){t(e)},M.prototype[f.captureRejectionSymbol]=function(e){this.destroy(e)},M.fromWeb=function(e,t){return q().newStreamWritableFromWritableStream(e,t)},M.toWeb=function(e){return q().newWritableStreamFromStreamWritable(e)}},8597:(e,t)=>{var r=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,n=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,a=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,i=/\\([\u000b\u0020-\u00ff])/g,o=/([\\"])/g,s=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function l(e){var t=String(e);if(a.test(t))return t;if(t.length>0&&!n.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(o,"\\$1")+'"'}function c(e){this.parameters=Object.create(null),this.type=e}t.format=function(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var t=e.parameters,r=e.type;if(!r||!s.test(r))throw new TypeError("invalid type");var n=r;if(t&&"object"==typeof t)for(var i,o=Object.keys(t).sort(),c=0;c<o.length;c++){if(i=o[c],!a.test(i))throw new TypeError("invalid parameter name");n+="; "+i+"="+l(t[i])}return n},t.parse=function(e){if(!e)throw new TypeError("argument string is required");var t="object"==typeof e?function(e){var t;if("function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]),"string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!=typeof t)throw new TypeError("argument string is required to be a string");var n=t.indexOf(";"),a=-1!==n?t.slice(0,n).trim():t.trim();if(!s.test(a))throw new TypeError("invalid media type");var o=new c(a.toLowerCase());if(-1!==n){var l,u,d;for(r.lastIndex=n;u=r.exec(t);){if(u.index!==n)throw new TypeError("invalid parameter format");n+=u[0].length,l=u[1].toLowerCase(),34===(d=u[2]).charCodeAt(0)&&-1!==(d=d.slice(1,-1)).indexOf("\\")&&(d=d.replace(i,"$1")),o.parameters[l]=d}if(n!==t.length)throw new TypeError("invalid parameter format")}return o}},8626:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AsfTagMapper=void 0;const n=r(8872),a={Title:"title",Author:"artist","WM/AlbumArtist":"albumartist","WM/AlbumTitle":"album","WM/Year":"date","WM/OriginalReleaseTime":"originaldate","WM/OriginalReleaseYear":"originalyear",Description:"comment","WM/TrackNumber":"track","WM/PartOfSet":"disk","WM/Genre":"genre","WM/Composer":"composer","WM/Lyrics":"lyrics","WM/AlbumSortOrder":"albumsort","WM/TitleSortOrder":"titlesort","WM/ArtistSortOrder":"artistsort","WM/AlbumArtistSortOrder":"albumartistsort","WM/ComposerSortOrder":"composersort","WM/Writer":"lyricist","WM/Conductor":"conductor","WM/ModifiedBy":"remixer","WM/Engineer":"engineer","WM/Producer":"producer","WM/DJMixer":"djmixer","WM/Mixer":"mixer","WM/Publisher":"label","WM/ContentGroupDescription":"grouping","WM/SubTitle":"subtitle","WM/SetSubTitle":"discsubtitle","WM/IsCompilation":"compilation","WM/SharedUserRating":"rating","WM/BeatsPerMinute":"bpm","WM/Mood":"mood","WM/Media":"media","WM/CatalogNo":"catalognumber","MusicBrainz/Album Status":"releasestatus","MusicBrainz/Album Type":"releasetype","MusicBrainz/Album Release Country":"releasecountry","WM/Script":"script","WM/Language":"language",Copyright:"copyright",LICENSE:"license","WM/EncodedBy":"encodedby","WM/EncodingSettings":"encodersettings","WM/Barcode":"barcode","WM/ISRC":"isrc","MusicBrainz/Track Id":"musicbrainz_recordingid","MusicBrainz/Release Track Id":"musicbrainz_trackid","MusicBrainz/Album Id":"musicbrainz_albumid","MusicBrainz/Artist Id":"musicbrainz_artistid","MusicBrainz/Album Artist Id":"musicbrainz_albumartistid","MusicBrainz/Release Group Id":"musicbrainz_releasegroupid","MusicBrainz/Work Id":"musicbrainz_workid","MusicBrainz/TRM Id":"musicbrainz_trmid","MusicBrainz/Disc Id":"musicbrainz_discid","Acoustid/Id":"acoustid_id","Acoustid/Fingerprint":"acoustid_fingerprint","MusicIP/PUID":"musicip_puid","WM/ARTISTS":"artists","WM/InitialKey":"key",ASIN:"asin","WM/Work":"work","WM/AuthorURL":"website","WM/Picture":"picture"};class i extends n.CommonTagMapper{static toRating(e){return{rating:parseFloat(e+1)/5}}constructor(){super(["asf"],a)}postMap(e){if("WM/SharedUserRating"===e.id){const t=e.id.split(":");e.value=i.toRating(e.value),e.id=t[0]}}}t.AsfTagMapper=i},8705:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamReader=t.EndOfStreamError=void 0;var n=r(5523);Object.defineProperty(t,"EndOfStreamError",{enumerable:!0,get:function(){return n.EndOfStreamError}});var a=r(1510);Object.defineProperty(t,"StreamReader",{enumerable:!0,get:function(){return a.StreamReader}})},8736:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OpusParser=void 0;const n=r(1028),a=r(2668),i=r(1403);class o extends a.VorbisParser{constructor(e,t,r){super(e,t),this.tokenizer=r,this.lastPos=-1}parseFirstPage(e,t){if(this.metadata.setFormat("codec","Opus"),this.idHeader=new i.IdHeader(t.length).get(t,0),"OpusHead"!==this.idHeader.magicSignature)throw new Error("Illegal ogg/Opus magic-signature");this.metadata.setFormat("sampleRate",this.idHeader.inputSampleRate),this.metadata.setFormat("numberOfChannels",this.idHeader.channelCount)}parseFullPage(e){"OpusTags"===new n.StringType(8,"ascii").get(e,0)&&(this.parseUserCommentList(e,8),this.lastPos=this.tokenizer.position-e.length)}calculateDuration(e){if(this.metadata.format.sampleRate&&e.absoluteGranulePosition>=0){const t=e.absoluteGranulePosition-this.idHeader.preSkip;if(this.metadata.setFormat("numberOfSamples",t),this.metadata.setFormat("duration",t/48e3),-1!==this.lastPos&&this.tokenizer.fileInfo.size&&this.metadata.format.duration){const e=this.tokenizer.fileInfo.size-this.lastPos;this.metadata.setFormat("bitrate",8*e/this.metadata.format.duration)}}}}t.OpusParser=o},8872:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommonTagMapper=void 0;class r{static toIntOrNull(e){const t=parseInt(e,10);return isNaN(t)?null:t}static normalizeTrack(e){const t=e.toString().split("/");return{no:parseInt(t[0],10)||null,of:parseInt(t[1],10)||null}}constructor(e,t){this.tagTypes=e,this.tagMap=t}mapGenericTag(e,t){e={id:e.id,value:e.value},this.postMap(e,t);const r=this.getCommonName(e.id);return r?{id:r,value:e.value}:null}getCommonName(e){return this.tagMap[e]}postMap(e,t){}}r.maxRatingScore=1,t.CommonTagMapper=r},9019:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.FactChunk=t.Format=t.WaveFormat=void 0,(r=t.WaveFormat||(t.WaveFormat={}))[r.PCM=1]="PCM",r[r.ADPCM=2]="ADPCM",r[r.IEEE_FLOAT=3]="IEEE_FLOAT",r[r.MPEG_ADTS_AAC=5632]="MPEG_ADTS_AAC",r[r.MPEG_LOAS=5634]="MPEG_LOAS",r[r.RAW_AAC1=255]="RAW_AAC1",r[r.DOLBY_AC3_SPDIF=146]="DOLBY_AC3_SPDIF",r[r.DVM=8192]="DVM",r[r.RAW_SPORT=576]="RAW_SPORT",r[r.ESST_AC3=577]="ESST_AC3",r[r.DRM=9]="DRM",r[r.DTS2=8193]="DTS2",r[r.MPEG=80]="MPEG",t.Format=class{constructor(e){if(e.chunkSize<16)throw new Error("Invalid chunk size");this.len=e.chunkSize}get(e,t){return{wFormatTag:e.readUInt16LE(t),nChannels:e.readUInt16LE(t+2),nSamplesPerSec:e.readUInt32LE(t+4),nAvgBytesPerSec:e.readUInt32LE(t+8),nBlockAlign:e.readUInt16LE(t+12),wBitsPerSample:e.readUInt16LE(t+14)}}},t.FactChunk=class{constructor(e){if(e.chunkSize<4)throw new Error("Invalid fact chunk size.");this.len=e.chunkSize}get(e,t){return{dwSampleLength:e.readUInt32LE(t)}}}},9056:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isUnique=t.isSingleton=t.commonTags=void 0,t.commonTags={year:{multiple:!1},track:{multiple:!1},disk:{multiple:!1},title:{multiple:!1},artist:{multiple:!1},artists:{multiple:!0,unique:!0},albumartist:{multiple:!1},album:{multiple:!1},date:{multiple:!1},originaldate:{multiple:!1},originalyear:{multiple:!1},comment:{multiple:!0,unique:!1},genre:{multiple:!0,unique:!0},picture:{multiple:!0,unique:!0},composer:{multiple:!0,unique:!0},lyrics:{multiple:!0,unique:!1},albumsort:{multiple:!1,unique:!0},titlesort:{multiple:!1,unique:!0},work:{multiple:!1,unique:!0},artistsort:{multiple:!1,unique:!0},albumartistsort:{multiple:!1,unique:!0},composersort:{multiple:!1,unique:!0},lyricist:{multiple:!0,unique:!0},writer:{multiple:!0,unique:!0},conductor:{multiple:!0,unique:!0},remixer:{multiple:!0,unique:!0},arranger:{multiple:!0,unique:!0},engineer:{multiple:!0,unique:!0},producer:{multiple:!0,unique:!0},technician:{multiple:!0,unique:!0},djmixer:{multiple:!0,unique:!0},mixer:{multiple:!0,unique:!0},label:{multiple:!0,unique:!0},grouping:{multiple:!1},subtitle:{multiple:!0},discsubtitle:{multiple:!1},totaltracks:{multiple:!1},totaldiscs:{multiple:!1},compilation:{multiple:!1},rating:{multiple:!0},bpm:{multiple:!1},mood:{multiple:!1},media:{multiple:!1},catalognumber:{multiple:!0,unique:!0},tvShow:{multiple:!1},tvShowSort:{multiple:!1},tvSeason:{multiple:!1},tvEpisode:{multiple:!1},tvEpisodeId:{multiple:!1},tvNetwork:{multiple:!1},podcast:{multiple:!1},podcasturl:{multiple:!1},releasestatus:{multiple:!1},releasetype:{multiple:!0},releasecountry:{multiple:!1},script:{multiple:!1},language:{multiple:!1},copyright:{multiple:!1},license:{multiple:!1},encodedby:{multiple:!1},encodersettings:{multiple:!1},gapless:{multiple:!1},barcode:{multiple:!1},isrc:{multiple:!0},asin:{multiple:!1},musicbrainz_recordingid:{multiple:!1},musicbrainz_trackid:{multiple:!1},musicbrainz_albumid:{multiple:!1},musicbrainz_artistid:{multiple:!0},musicbrainz_albumartistid:{multiple:!0},musicbrainz_releasegroupid:{multiple:!1},musicbrainz_workid:{multiple:!1},musicbrainz_trmid:{multiple:!1},musicbrainz_discid:{multiple:!1},acoustid_id:{multiple:!1},acoustid_fingerprint:{multiple:!1},musicip_puid:{multiple:!1},musicip_fingerprint:{multiple:!1},website:{multiple:!1},"performer:instrument":{multiple:!0,unique:!0},averageLevel:{multiple:!1},peakLevel:{multiple:!1},notes:{multiple:!0,unique:!1},key:{multiple:!1},originalalbum:{multiple:!1},originalartist:{multiple:!1},discogs_artist_id:{multiple:!0,unique:!0},discogs_release_id:{multiple:!1},discogs_label_id:{multiple:!1},discogs_master_release_id:{multiple:!1},discogs_votes:{multiple:!1},discogs_rating:{multiple:!1},replaygain_track_peak:{multiple:!1},replaygain_track_gain:{multiple:!1},replaygain_album_peak:{multiple:!1},replaygain_album_gain:{multiple:!1},replaygain_track_minmax:{multiple:!1},replaygain_album_minmax:{multiple:!1},replaygain_undo:{multiple:!1},description:{multiple:!0},longDescription:{multiple:!1},category:{multiple:!0},hdVideo:{multiple:!1},keywords:{multiple:!0},movement:{multiple:!1},movementIndex:{multiple:!1},movementTotal:{multiple:!1},podcastId:{multiple:!1},showMovement:{multiple:!1},stik:{multiple:!1}},t.isSingleton=function(e){return t.commonTags.hasOwnProperty(e)&&!t.commonTags[e].multiple},t.isUnique=function(e){return!t.commonTags[e].multiple||t.commonTags[e].unique}},9090:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ListInfoTagValue=t.Header=void 0;const n=r(1028);t.Header={len:8,get:(e,t)=>({chunkID:e.toString("binary",t,t+4),chunkSize:n.UINT32_LE.get(e,4)})},t.ListInfoTagValue=class{constructor(e){this.tagHeader=e,this.len=e.chunkSize,this.len+=1&this.len}get(e,t){return new n.StringType(this.tagHeader.chunkSize,"ascii").get(e,t)}}},9128:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.readXingHeader=t.XingHeaderFlags=t.LameEncoderVersion=t.InfoTagHeaderTag=void 0;const a=r(1028),i=r(6378),o=r(9767);t.InfoTagHeaderTag=new a.StringType(4,"ascii"),t.LameEncoderVersion=new a.StringType(6,"ascii"),t.XingHeaderFlags={len:4,get:(e,t)=>({frames:i.isBitSet(e,t,31),bytes:i.isBitSet(e,t,30),toc:i.isBitSet(e,t,29),vbrScale:i.isBitSet(e,t,28)})},t.readXingHeader=async function(e){const r=await e.readToken(t.XingHeaderFlags),i={};if(r.frames&&(i.numFrames=await e.readToken(a.UINT32_BE)),r.bytes&&(i.streamSize=await e.readToken(a.UINT32_BE)),r.toc&&(i.toc=n.alloc(100),await e.readBuffer(i.toc)),r.vbrScale&&(i.vbrScale=await e.readToken(a.UINT32_BE)),"LAME"===await e.peekToken(new a.StringType(4,"ascii"))&&(await e.ignore(4),i.lame={version:await e.readToken(new a.StringType(5,"ascii"))},i.lame.version.match(/\d+.\d+/g))){const t=i.lame.version.match(/\d+.\d+/g)[0].split(".").map(e=>parseInt(e,10));t[0]>=3&&t[1]>=90&&(i.lame.extended=await e.readToken(o.ExtendedLameHeader))}return i}},9156:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.APEv2Parser=void 0;const a=r(7833),i=r(5534),o=r(1028),s=r(6378),l=r(6373),c=r(4726),u=(0,a.default)("music-metadata:parser:APEv2"),d="APEv2",p="APETAGEX";class f extends l.BasicParser{constructor(){super(...arguments),this.ape={}}static tryParseApeHeader(e,t,r){const n=new f;return n.init(e,t,r),n.tryParseApeHeader()}static calculateDuration(e){let t=e.totalFrames>1?e.blocksPerFrame*(e.totalFrames-1):0;return t+=e.finalFrameBlocks,t/e.sampleRate}static async findApeFooterOffset(e,t){const r=n.alloc(c.TagFooter.len);await e.randomRead(r,0,c.TagFooter.len,t-c.TagFooter.len);const a=c.TagFooter.get(r,0);if("APETAGEX"===a.ID)return u(`APE footer header at offset=${t}`),{footer:a,offset:t-a.size}}static parseTagFooter(e,t,r){const n=c.TagFooter.get(t,t.length-c.TagFooter.len);if(n.ID!==p)throw new Error("Unexpected APEv2 Footer ID preamble value.");i.fromBuffer(t);const a=new f;return a.init(e,i.fromBuffer(t),r),a.parseTags(n)}async tryParseApeHeader(){if(this.tokenizer.fileInfo.size&&this.tokenizer.fileInfo.size-this.tokenizer.position<c.TagFooter.len)return void u("No APEv2 header found, end-of-file reached");const e=await this.tokenizer.peekToken(c.TagFooter);if(e.ID===p)return await this.tokenizer.ignore(c.TagFooter.len),this.parseTags(e);if(u(`APEv2 header not found at offset=${this.tokenizer.position}`),this.tokenizer.fileInfo.size){const e=this.tokenizer.fileInfo.size-this.tokenizer.position,t=n.alloc(e);return await this.tokenizer.readBuffer(t),f.parseTagFooter(this.metadata,t,this.options)}}async parse(){const e=await this.tokenizer.readToken(c.DescriptorParser);if("MAC "!==e.ID)throw new Error("Unexpected descriptor ID");this.ape.descriptor=e;const t=e.descriptorBytes-c.DescriptorParser.len,r=await(t>0?this.parseDescriptorExpansion(t):this.parseHeader());return await this.tokenizer.ignore(r.forwardBytes),this.tryParseApeHeader()}async parseTags(e){const t=n.alloc(256);let r=e.size-c.TagFooter.len;u(`Parse APE tags at offset=${this.tokenizer.position}, size=${r}`);for(let a=0;a<e.fields;a++){if(r<c.TagItemHeader.len){this.metadata.addWarning(`APEv2 Tag-header: ${e.fields-a} items remaining, but no more tag data to read.`);break}const i=await this.tokenizer.readToken(c.TagItemHeader);r-=c.TagItemHeader.len+i.size,await this.tokenizer.peekBuffer(t,{length:Math.min(t.length,r)});let l=s.findZero(t,0,t.length);const p=await this.tokenizer.readToken(new o.StringType(l,"ascii"));switch(await this.tokenizer.ignore(1),r-=p.length+1,i.flags.dataType){case c.DataType.text_utf8:{const e=(await this.tokenizer.readToken(new o.StringType(i.size,"utf8"))).split(/\x00/g);for(const t of e)this.metadata.addTag(d,p,t);break}case c.DataType.binary:if(this.options.skipCovers)await this.tokenizer.ignore(i.size);else{const e=n.alloc(i.size);await this.tokenizer.readBuffer(e),l=s.findZero(e,0,e.length);const t=e.toString("utf8",0,l),r=n.from(e.slice(l+1));this.metadata.addTag(d,p,{description:t,data:r})}break;case c.DataType.external_info:u(`Ignore external info ${p}`),await this.tokenizer.ignore(i.size);break;case c.DataType.reserved:u(`Ignore external info ${p}`),this.metadata.addWarning(`APEv2 header declares a reserved datatype for "${p}"`),await this.tokenizer.ignore(i.size)}}}async parseDescriptorExpansion(e){return await this.tokenizer.ignore(e),this.parseHeader()}async parseHeader(){const e=await this.tokenizer.readToken(c.Header);return this.metadata.setFormat("lossless",!0),this.metadata.setFormat("container","Monkey's Audio"),this.metadata.setFormat("bitsPerSample",e.bitsPerSample),this.metadata.setFormat("sampleRate",e.sampleRate),this.metadata.setFormat("numberOfChannels",e.channel),this.metadata.setFormat("duration",f.calculateDuration(e)),{forwardBytes:this.ape.descriptor.seekTableBytes+this.ape.descriptor.headerDataBytes+this.ape.descriptor.apeFrameDataBytes+this.ape.descriptor.terminatingDataBytes}}}t.APEv2Parser=f},9198:(e,t,r)=>{const n=r(5506),a=r(3095),i=n.Readable.destroy;e.exports=n.Readable,e.exports._uint8ArrayToBuffer=n._uint8ArrayToBuffer,e.exports._isUint8Array=n._isUint8Array,e.exports.isDisturbed=n.isDisturbed,e.exports.isErrored=n.isErrored,e.exports.isReadable=n.isReadable,e.exports.Readable=n.Readable,e.exports.Writable=n.Writable,e.exports.Duplex=n.Duplex,e.exports.Transform=n.Transform,e.exports.PassThrough=n.PassThrough,e.exports.addAbortSignal=n.addAbortSignal,e.exports.finished=n.finished,e.exports.destroy=n.destroy,e.exports.destroy=i,e.exports.pipeline=n.pipeline,e.exports.compose=n.compose,Object.defineProperty(n,"promises",{configurable:!0,enumerable:!0,get:()=>a}),e.exports.Stream=n.Stream,e.exports.default=e.exports},9231:e=>{e.exports={format:(e,...t)=>e.replace(/%([sdifj])/g,function(...[e,r]){const n=t.shift();return"f"===r?n.toFixed(6):"j"===r?JSON.stringify(n):"s"===r&&"object"==typeof n?`${n.constructor!==Object?n.constructor.name:""} {}`.trim():n.toString()}),inspect(e){switch(typeof e){case"string":if(e.includes("'")){if(!e.includes('"'))return`"${e}"`;if(!e.includes("`")&&!e.includes("${"))return`\`${e}\``}return`'${e}'`;case"number":return isNaN(e)?"NaN":Object.is(e,-0)?String(e):e;case"bigint":return`${String(e)}n`;case"boolean":case"undefined":return String(e);case"object":return"{}"}}}},9400:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.WavPackParser=void 0;const a=r(1028),i=r(9156),o=r(3232),s=r(6373),l=r(3674),c=(0,r(7833).default)("music-metadata:parser:WavPack");class u extends s.BasicParser{async parse(){return this.audioDataSize=0,await this.parseWavPackBlocks(),i.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options)}async parseWavPackBlocks(){do{if("wvpk"!==await this.tokenizer.peekToken(o.FourCcToken))break;const e=await this.tokenizer.readToken(l.WavPack.BlockHeaderToken);if("wvpk"!==e.BlockID)throw new Error("Invalid WavPack Block-ID");c(`WavPack header blockIndex=${e.blockIndex}, len=${l.WavPack.BlockHeaderToken.len}`),0!==e.blockIndex||this.metadata.format.container||(this.metadata.setFormat("container","WavPack"),this.metadata.setFormat("lossless",!e.flags.isHybrid),this.metadata.setFormat("bitsPerSample",e.flags.bitsPerSample),e.flags.isDSD||(this.metadata.setFormat("sampleRate",e.flags.samplingRate),this.metadata.setFormat("duration",e.totalSamples/e.flags.samplingRate)),this.metadata.setFormat("numberOfChannels",e.flags.isMono?1:2),this.metadata.setFormat("numberOfSamples",e.totalSamples),this.metadata.setFormat("codec",e.flags.isDSD?"DSD":"PCM"));const t=e.blockSize-(l.WavPack.BlockHeaderToken.len-8);await(0===e.blockIndex?this.parseMetadataSubBlock(e,t):this.tokenizer.ignore(t)),e.blockSamples>0&&(this.audioDataSize+=e.blockSize)}while(!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=l.WavPack.BlockHeaderToken.len);this.metadata.setFormat("bitrate",8*this.audioDataSize/this.metadata.format.duration)}async parseMetadataSubBlock(e,t){for(;t>l.WavPack.MetadataIdToken.len;){const r=await this.tokenizer.readToken(l.WavPack.MetadataIdToken),i=await this.tokenizer.readNumber(r.largeBlock?a.UINT24_LE:a.UINT8),o=n.alloc(2*i-(r.isOddSize?1:0));switch(await this.tokenizer.readBuffer(o),c(`Metadata Sub-Blocks functionId=0x${r.functionId.toString(16)}, id.largeBlock=${r.largeBlock},data-size=${o.length}`),r.functionId){case 0:break;case 14:c("ID_DSD_BLOCK");const t=1<<o.readUInt8(0),n=e.flags.samplingRate*t*8;if(!e.flags.isDSD)throw new Error("Only expect DSD block if DSD-flag is set");this.metadata.setFormat("sampleRate",n),this.metadata.setFormat("duration",e.totalSamples/n);break;case 36:c("ID_ALT_TRAILER: trailer for non-wav files");break;case 38:this.metadata.setFormat("audioMD5",o);break;case 47:c(`ID_BLOCK_CHECKSUM: checksum=${o.toString("hex")}`);break;default:c(`Ignore unsupported meta-sub-block-id functionId=0x${r.functionId.toString(16)}`)}t-=l.WavPack.MetadataIdToken.len+(r.largeBlock?a.UINT24_LE.len:a.UINT8.len)+2*i,c(`remainingLength=${t}`),r.isOddSize&&this.tokenizer.ignore(1)}if(0!==t)throw new Error("metadata-sub-block should fit it remaining length")}}t.WavPackParser=u},9432:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DsfParser=void 0;const n=r(7833),a=r(7270),i=r(1426),o=r(8344),s=(0,n.default)("music-metadata:parser:DSF");class l extends a.AbstractID3Parser{async postId3v2Parse(){const e=this.tokenizer.position,t=await this.tokenizer.readToken(i.ChunkHeader);if("DSD "!==t.id)throw new Error("Invalid chunk signature");this.metadata.setFormat("container","DSF"),this.metadata.setFormat("lossless",!0);const r=await this.tokenizer.readToken(i.DsdChunk);if(r.metadataPointer!==BigInt(0))return s(`expect ID3v2 at offset=${r.metadataPointer}`),await this.parseChunks(r.fileSize-t.size),await this.tokenizer.ignore(Number(r.metadataPointer)-this.tokenizer.position-e),(new o.ID3v2Parser).parse(this.metadata,this.tokenizer,this.options);s("No ID3v2 tag present")}async parseChunks(e){for(;e>=i.ChunkHeader.len;){const t=await this.tokenizer.readToken(i.ChunkHeader);if(s(`Parsing chunk name=${t.id} size=${t.size}`),"fmt "===t.id){const e=await this.tokenizer.readToken(i.FormatChunk);this.metadata.setFormat("numberOfChannels",e.channelNum),this.metadata.setFormat("sampleRate",e.samplingFrequency),this.metadata.setFormat("bitsPerSample",e.bitsPerSample),this.metadata.setFormat("numberOfSamples",e.sampleCount),this.metadata.setFormat("duration",Number(e.sampleCount)/e.samplingFrequency);const t=e.bitsPerSample*e.samplingFrequency*e.channelNum;return void this.metadata.setFormat("bitrate",t)}this.tokenizer.ignore(Number(t.size)-i.ChunkHeader.len),e-=t.size}}}t.DsfParser=l},9549:(module,__unused_webpack_exports,__webpack_require__)=>{var Buffer=__webpack_require__(8287).Buffer;const Token=__webpack_require__(1028),strtok3=__webpack_require__(5534),{stringToBytes,tarHeaderChecksumMatches,uint32SyncSafeToken}=__webpack_require__(1110),supported=__webpack_require__(134),minimumBytes=4100;async function fromStream(e){const t=await strtok3.fromStream(e);try{return await fromTokenizer(t)}finally{await t.close()}}async function fromBuffer(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Buffer.isBuffer(e)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Buffer?e:Buffer.from(e);if(t&&t.length>1)return fromTokenizer(strtok3.fromBuffer(t))}function _check(e,t,r){r={offset:0,...r};for(const[n,a]of t.entries())if(r.mask){if(a!==(r.mask[n]&e[n+r.offset]))return!1}else if(a!==e[n+r.offset])return!1;return!0}async function fromTokenizer(e){try{return _fromTokenizer(e)}catch(e){if(!(e instanceof strtok3.EndOfStreamError))throw e}}async function _fromTokenizer(e){let t=Buffer.alloc(minimumBytes);const r=(e,r)=>_check(t,e,r),n=(e,t)=>r(stringToBytes(e),t);if(e.fileInfo.size||(e.fileInfo.size=Number.MAX_SAFE_INTEGER),await e.peekBuffer(t,{length:12,mayBeLess:!0}),r([66,77]))return{ext:"bmp",mime:"image/bmp"};if(r([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(r([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(r([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(r([37,33]))return await e.peekBuffer(t,{length:24,mayBeLess:!0}),n("PS-Adobe-",{offset:2})&&n(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(r([31,160])||r([31,157]))return{ext:"Z",mime:"application/x-compress"};if(r([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(r([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(r([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(r([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(n("ID3")){await e.ignore(6);const a=await e.readToken(uint32SyncSafeToken);return e.position+a>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(a),fromTokenizer(e))}if(n("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((67===t[0]||70===t[0])&&r([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(r([71,73,70]))return{ext:"gif",mime:"image/gif"};if(n("FLIF"))return{ext:"flif",mime:"image/flif"};if(n("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(n("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(n("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(n("FORM"))return{ext:"aif",mime:"audio/aiff"};if(n("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(r([80,75,3,4])){try{for(;e.position+30<e.fileInfo.size;){await e.readBuffer(t,{length:30});const i={compressedSize:t.readUInt32LE(18),uncompressedSize:t.readUInt32LE(22),filenameLength:t.readUInt16LE(26),extraFieldLength:t.readUInt16LE(28)};if(i.filename=await e.readToken(new Token.StringType(i.filenameLength,"utf-8")),await e.ignore(i.extraFieldLength),"META-INF/mozilla.rsa"===i.filename)return{ext:"xpi",mime:"application/x-xpinstall"};if(i.filename.endsWith(".rels")||i.filename.endsWith(".xml"))switch(i.filename.split("/")[0]){case"_rels":default:break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}if(i.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(i.filename.startsWith("3D/")&&i.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if("mimetype"===i.filename&&i.compressedSize===i.uncompressedSize)switch(await e.readToken(new Token.StringType(i.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"}}if(0===i.compressedSize){let o=-1;for(;o<0&&e.position<e.fileInfo.size;)await e.peekBuffer(t,{mayBeLess:!0}),o=t.indexOf("504B0304",0,"hex"),await e.ignore(o>=0?o:t.length)}else await e.ignore(i.compressedSize)}}catch(s){if(!(s instanceof strtok3.EndOfStreamError))throw s}return{ext:"zip",mime:"application/zip"}}if(n("OggS")){await e.ignore(28);const l=Buffer.alloc(8);return await e.readBuffer(l),_check(l,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check(l,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check(l,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check(l,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check(l,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check(l,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(r([80,75])&&(3===t[2]||5===t[2]||7===t[2])&&(4===t[3]||6===t[3]||8===t[3]))return{ext:"zip",mime:"application/zip"};if(n("ftyp",{offset:4})&&96&t[8]){const c=t.toString("binary",8,12).replace("\0"," ").trim();switch(c){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return c.startsWith("3g")?c.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(n("MThd"))return{ext:"mid",mime:"audio/midi"};if(n("wOFF")&&(r([0,1,0,0],{offset:4})||n("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(n("wOF2")&&(r([0,1,0,0],{offset:4})||n("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(r([212,195,178,161])||r([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(n("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(n("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(n("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(r([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(n("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(n("%PDF")){await e.ignore(1350);const u=10485760,d=Buffer.alloc(Math.min(u,e.fileInfo.size));return await e.readBuffer(d,{mayBeLess:!0}),d.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(r([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(r([73,73,42,0]))return n("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:r([28,0,254,0],{offset:8})||r([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:r([8,0,0,0],{offset:4})&&(r([45,0,254,0],{offset:8})||r([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(t=Buffer.alloc(24),await e.peekBuffer(t),(r([16,251,134,1],{offset:4})||r([8,0,0,0],{offset:4}))&&r([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(r([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(n("MAC "))return{ext:"ape",mime:"audio/ape"};if(r([26,69,223,163])){async function p(){const t=await e.peekNumber(Token.UINT8);let r=128,n=0;for(;0===(t&r)&&0!==r;)++n,r>>=1;const a=Buffer.alloc(n+1);return await e.readBuffer(a),a}async function f(){const e=await p(),t=await p();t[0]^=128>>t.length-1;const r=Math.min(6,t.length);return{id:e.readUIntBE(0,e.length),len:t.readUIntBE(t.length-r,r)}}async function h(t,r){for(;r>0;){const t=await f();if(17026===t.id)return e.readToken(new Token.StringType(t.len,"utf-8"));await e.ignore(t.len),--r}}const m=await f();switch(await h(0,m.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(r([82,73,70,70])){if(r([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(r([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(r([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(n("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(r([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(n("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(n("MSCF")||n("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(r([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(r([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(r([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(r([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(n("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(n("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(r([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(n("IMPM"))return{ext:"it",mime:"audio/x-it"};if(n("-lh0-",{offset:2})||n("-lh1-",{offset:2})||n("-lh2-",{offset:2})||n("-lh3-",{offset:2})||n("-lh4-",{offset:2})||n("-lh5-",{offset:2})||n("-lh6-",{offset:2})||n("-lh7-",{offset:2})||n("-lzs-",{offset:2})||n("-lz4-",{offset:2})||n("-lz5-",{offset:2})||n("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(r([0,0,1,186])){if(r([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(r([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(n("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(r([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(n("<?xml "))return{ext:"xml",mime:"application/xml"};if(r([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(r([82,97,114,33,26,7])&&(0===t[6]||1===t[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(n("solid "))return{ext:"stl",mime:"model/stl"};if(n("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(n("!<arch>"))return await e.ignore(8),"debian-binary"===await e.readToken(new Token.StringType(13,"ascii"))?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(r([137,80,78,71,13,10,26,10])){async function g(){return{length:await e.readToken(Token.INT32_BE),type:await e.readToken(new Token.StringType(4,"binary"))}}await e.ignore(8);do{const y=await g();if(y.length<0)return;switch(y.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(y.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(r([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(r([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(r([102,114,101,101],{offset:4})||r([109,100,97,116],{offset:4})||r([109,111,111,118],{offset:4})||r([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(r([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(n("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(r([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(r([48,38,178,117,142,102,207,17,166,217])){async function b(){const t=Buffer.alloc(16);return await e.readBuffer(t),{id:t,size:Number(await e.readToken(Token.UINT64_LE))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const w=await b();let T=w.size-24;if(_check(w.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const v=Buffer.alloc(16);if(T-=await e.readBuffer(v),_check(v,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(v,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(T)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(r([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((r([126,16,4])||r([126,24,4]))&&r([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(r([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(r([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await e.ignore(20),await e.readToken(new Token.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(r([255,10])||r([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(r([0,0,1,186])||r([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(r([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(r([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(r([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(r([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(t,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),n("BEGIN:")){if(n("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(n("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(n("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(n("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(n("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(r([4,0,0,0])&&t.length>=16){const _=t.readUInt32LE(12);if(_>12&&t.length>=_+16)try{const E=t.slice(16,_+16).toString();if(JSON.parse(E).files)return{ext:"asar",mime:"application/x-asar"}}catch(S){}}if(r([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(n("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(r([71],{offset:4})&&(r([71],{offset:192})||r([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(r([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(r([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(r([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(r([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(r([76,80],{offset:34})&&(r([0,0,1],{offset:8})||r([1,0,2],{offset:8})||r([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(r([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await e.peekBuffer(t,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(t))return{ext:"tar",mime:"application/x-tar"};if(r([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(n("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(t.length>=2&&r([255,224],{offset:0,mask:[255,224]})){if(r([16],{offset:1,mask:[22]}))return r([8],{offset:1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(r([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(r([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",async()=>{const e=new stream.PassThrough;let t;t=stream.pipeline?stream.pipeline(readableStream,e,()=>{}):readableStream.pipe(e);const r=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const t=await fromBuffer(r);e.fileType=t}catch(e){reject(e)}resolve(t)})}),fileType={fromStream,fromTokenizer,fromBuffer,stream};Object.defineProperty(fileType,"extensions",{get:()=>new Set(supported.extensions)}),Object.defineProperty(fileType,"mimeTypes",{get:()=>new Set(supported.mimeTypes)}),module.exports=fileType},9767:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedLameHeader=void 0;const n=r(1028),a=r(6378),i=r(6185);t.ExtendedLameHeader={len:27,get:(e,t)=>{const r=n.UINT32_BE.get(e,t+2);return{revision:a.getBitAllignedNumber(e,t,0,4),vbr_method:a.getBitAllignedNumber(e,t,4,4),lowpass_filter:100*n.UINT8.get(e,t+1),track_peak:0===r?void 0:r/Math.pow(2,23),track_gain:i.ReplayGain.get(e,6),album_gain:i.ReplayGain.get(e,8),music_length:n.UINT32_BE.get(e,t+20),music_crc:n.UINT8.get(e,t+24),header_crc:n.UINT16_BE.get(e,t+24)}}}},9838:(e,t,r)=>{var n=r(8287).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractTokenizer=void 0;const a=r(8705);t.AbstractTokenizer=class{constructor(e){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=e||{}}async readToken(e,t=this.position){const r=n.alloc(e.len);if(await this.readBuffer(r,{position:t})<e.len)throw new a.EndOfStreamError;return e.get(r,0)}async peekToken(e,t=this.position){const r=n.alloc(e.len);if(await this.peekBuffer(r,{position:t})<e.len)throw new a.EndOfStreamError;return e.get(r,0)}async readNumber(e){if(await this.readBuffer(this.numBuffer,{length:e.len})<e.len)throw new a.EndOfStreamError;return e.get(this.numBuffer,0)}async peekNumber(e){if(await this.peekBuffer(this.numBuffer,{length:e.len})<e.len)throw new a.EndOfStreamError;return e.get(this.numBuffer,0)}async ignore(e){if(void 0!==this.fileInfo.size){const t=this.fileInfo.size-this.position;if(e>t)return this.position+=t,t}return this.position+=e,e}async close(){}normalizeOptions(e,t){if(t&&void 0!==t.position&&t.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return t?{mayBeLess:!0===t.mayBeLess,offset:t.offset?t.offset:0,length:t.length?t.length:e.length-(t.offset?t.offset:0),position:t.position?t.position:this.position}:{mayBeLess:!1,offset:0,length:e.length,position:this.position}}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.u=e=>e+".app.js",__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;if("string"==typeof import.meta.url&&(e=import.meta.url),!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e})(),__webpack_require__.b=new URL("./",import.meta.url);var __webpack_exports__={};class DSIMenuButton{constructor(e,t){this.div=e,this.div.addEventListener("click",()=>{t()})}set selected(e){e?this.div.classList.contains("dsimenubutton_selected")||this.div.classList.add("dsimenubutton_selected"):this.div.classList.remove("dsimenubutton_selected")}get selected(){return this.div.classList.contains("dsimenubutton_selected")}}class CamButton{constructor(e,t){this.div=e,this.div.addEventListener("click",()=>{t()})}set selected(e){e?this.div.classList.contains("cambutton_selected")||this.div.classList.add("cambutton_selected"):this.div.classList.remove("cambutton_selected")}get selected(){return this.div.classList.contains("cambutton_selected")}}class CamPhoto{constructor(e){this.photo=e,this.url=null}revokeURL(){null!=this.url&&(URL.revokeObjectURL(this.url),this.url=null)}createURL(){return this.revokeURL(),URL.createObjectURL(this.photo)}applyToPreview(){camera_CameraApp.instance.preview.applyPhoto(this),camera_CameraApp.instance.photodate.setDate(new Date(this.photo.lastModified))}}class GridItem{constructor(e){this.id=camera_CameraApp.griditems.length,console.log(this.id),this.div=e,this.div.addEventListener("click",e=>{camera_CameraApp.instance.setGridItem(this.id)}),this.x=0,this.y=0}update(){this.x=window.innerWidth/2-GridItem.GRID_WIDTH/2,this.x+=-160*(camera_CameraApp.instance.currentGridItemSelected-this.id);let e=(this.div.getBoundingClientRect().x+GridItem.GRID_WIDTH/2)/window.innerWidth;e>.5&&(e=1-e),this.y=48*e,-200>this.x+GridItem.GRID_WIDTH||this.x>window.innerWidth+200?this.offscreenStyle():this.onscreenStyle()}offscreenStyle(){this.div.style.display="none"}onscreenStyle(){this.div.style.display="inherit",camera_CameraApp.instance.currentGridItemSelected==this.id?(this.div.style.border="8px ridge #ff9230",this.div.style.outline="2px solid white",this.div.style.borderRadius="8px"):(this.div.style.border="",this.div.style.outline="",this.div.style.borderRadius=""),this.div.style.left=`${this.x}px`,this.div.style.top=`${this.y}px`}}GridItem.GRID_WIDTH=128,GridItem.GRID_HEIGHT=128;const griditems_GridItem=GridItem;class DayGridItem extends griditems_GridItem{constructor(e){let t=document.createElement("div");t.classList.add("griditem","infogriditem");let r=document.createElement("div");r.classList.add("datearrow"),r.innerText="",t.appendChild(r);let n=document.createElement("div");n.classList.add("datemonthday"),n.innerText=e.getDate()+"/"+e.getMonth(),t.appendChild(n);let a=document.createElement("div");a.classList.add("dateyear"),a.innerText=e.getFullYear()+"",t.appendChild(a),document.getElementById("gallery").appendChild(t),super(t)}}class PhotoGridItem extends griditems_GridItem{constructor(e){let t=document.createElement("div");t.classList.add("griditem","griditemphoto"),super(t),this.photo=e,document.getElementById("gallery").appendChild(t)}offscreenStyle(){super.offscreenStyle(),this.div.style.backgroundImage="",this.photo.revokeURL()}onscreenStyle(){super.onscreenStyle(),null==this.photo.url&&(this.photo.url=this.photo.createURL()),this.div.style.backgroundImage=`url(${this.photo.url})`}}class PhotoDateDisplay{constructor(e){this.div=e}setDate(e){this.div.innerText=e.toLocaleString()}}class PreviewPhoto{constructor(e){this.photo=null,this.angle=0,this.img=e}updateAngle(){this.angle=this.angle%360,this.img.style.transformOrigin="center",this.img.style.transform=`rotate(${this.angle}deg)`}applyPhoto(e){this.photo=e,null==e.url&&(e.url=e.createURL()),this.img.src=e.url}download(){if(null==this.photo)return;let e=document.createElement("img");e.src=this.img.src,e.addEventListener("load",()=>{if(null!=this.photo){let t=90==Math.round(this.angle)||270==Math.round(this.angle),r=new OffscreenCanvas(t?e.height:e.width,t?e.width:e.height),n=r.getContext("2d");n.imageSmoothingEnabled=!1,n.clearRect(0,0,r.width,r.height),n.translate(r.width/2,r.height/2),n.rotate(this.angle*Math.PI/180),n.drawImage(e,-e.width/2,-e.height/2),r.convertToBlob({type:this.photo.photo.type,quality:1}).then(e=>{if(null!=this.photo){let t=document.createElement("a");t.download=`${this.photo.photo.name}`,t.href=URL.createObjectURL(e),t.click()}})}})}}var __awaiter=function(e,t,r,n){return new(r||(r=Promise))(function(a,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,s)}l((n=n.apply(e,t||[])).next())})},__asyncValues=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,a){!function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)}(n,a,(t=e[r](t)).done,t.value)})}}},__await=function(e){return this instanceof __await?(this.v=e,this):new __await(e)},__asyncDelegator=function(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,a){t[n]=e[n]?function(t){return(r=!r)?{value:__await(e[n](t)),done:!1}:a?a(t):t}:a}},__asyncGenerator=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(e,t||[]),i=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),n[Symbol.asyncIterator]=function(){return this},n;function o(e,t){a[e]&&(n[e]=function(t){return new Promise(function(r,n){i.push([e,t,r,n])>1||s(e,t)})},t&&(n[e]=t(n[e])))}function s(e,t){try{(r=a[e](t)).value instanceof __await?Promise.resolve(r.value.v).then(l,c):u(i[0][2],r)}catch(e){u(i[0][3],e)}var r}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}};class CameraApp{constructor(){this.currentGridItemSelected=-1,this.photos=[],CameraApp.instance=this,"chrome"in window||alert("Hi, please note that non chromium browsers aren't fully supported, so you may experience issues"),document.getElementById("camerafooter").style.display="inherit",document.getElementById("sdcardscreen-camera").style.display="inherit",document.getElementById("sdcardscreen-camera").style.display="inherit",document.body.style.backgroundImage='url("looping.png")',this.dirselect=document.getElementById("dirselect"),this.preview=new PreviewPhoto(document.getElementById("preview")),this.photodate=new PhotoDateDisplay(document.getElementById("photodate")),this.galleryslider=document.getElementById("galleryslider"),this.sdcardbutton=new CamButton(document.getElementById("sdcardbutton"),()=>{this.sdcardbutton.selected=!0,this.filePick()}),this.rotatebutton=new DSIMenuButton(document.getElementById("rotatebutton"),()=>{this.preview.angle+=90,this.preview.updateAngle()}),this.downloadbutton=new DSIMenuButton(document.getElementById("downloadbutton"),()=>{this.preview.download()})}filePick(){"showDirectoryPicker"in window?window.showDirectoryPicker().then(e=>__awaiter(this,void 0,void 0,function*(){try{yield this.getAllFiles(e)}catch(e){alert("Please ensure you are picking the root of your SD Card and not any folders inside of it."),this.sdcardbutton.selected=!1}})).catch(()=>{this.sdcardbutton.selected=!1}):(this.dirselect.click(),this.dirselect.addEventListener("cancel",e=>{this.sdcardbutton.selected=!1}),this.dirselect.addEventListener("change",()=>{null!=this.dirselect.files&&this.loadPreviewMenu(this.dirselect.files)}))}getAllFiles(e){return __awaiter(this,void 0,void 0,function*(){var t,r,n,a;let i,o=[];i=yield e.getDirectoryHandle("DCIM");try{for(var s,l=!0,c=__asyncValues(this.getFilesRecursively(i));!(t=(s=yield c.next()).done);l=!0){a=s.value,l=!1;const e=a;o.push(e)}}catch(e){r={error:e}}finally{try{l||t||!(n=c.return)||(yield n.call(c))}finally{if(r)throw r.error}}this.loadPreviewMenu(o)})}getFilesRecursively(e){return __asyncGenerator(this,arguments,function*(){var t,r,n,a;if(e instanceof FileSystemFileHandle){const t=yield __await(e.getFile());null!==t&&(yield yield __await(t))}else if(e instanceof FileSystemDirectoryHandle)try{for(var i,o=!0,s=__asyncValues(e.values());!(t=(i=yield __await(s.next())).done);o=!0){a=i.value,o=!1;const e=a;yield __await(yield*__asyncDelegator(__asyncValues(this.getFilesRecursively(e))))}}catch(e){r={error:e}}finally{try{o||t||!(n=s.return)||(yield __await(n.call(s)))}finally{if(r)throw r.error}}})}loadPreviewMenu(e){for(let t=0;t<e.length;t++){const r=e[t];null!=r&&this.parseFile(r)}if(0==this.photos.length)return this.sdcardbutton.selected=!1,void alert("No photos were found.");document.getElementById("sdcardscreen-camera").style.display="none",document.getElementById("albumscreen").style.display="flex",document.getElementById("camerafooter").style.display="none",document.body.style.backgroundImage='url("looping_album.png")',this.photos.sort((e,t)=>e.photo.lastModified-t.photo.lastModified),document.getElementById("photoscount").innerText=""+this.photos.length;for(let e=0;e<this.photos.length;e++){let t=this.photos[e];if(0!=e){let r=this.photos[e-1],n=new Date(t.photo.lastModified);new Date(r.photo.lastModified).getDay()!=n.getDay()&&CameraApp.griditems.push(new DayGridItem(n))}else CameraApp.griditems.push(new DayGridItem(new Date(t.photo.lastModified)));CameraApp.griditems.push(new PhotoGridItem(t))}CameraApp.griditems.push(new griditems_GridItem(document.getElementById("totalphotos"))),this.setGridItem(CameraApp.griditems.length-1),this.galleryslider.max=""+(CameraApp.griditems.length-1),this.galleryslider.addEventListener("input",e=>{this.setGridItem(this.galleryslider.valueAsNumber)}),requestAnimationFrame(CameraApp.instance.updatePreview)}setGridItem(e){this.currentGridItemSelected=e,this.galleryslider.valueAsNumber=this.currentGridItemSelected;let t=CameraApp.griditems[e];t instanceof PhotoGridItem?(this.preview.img.style.opacity="1",this.photodate.div.style.opacity="1",t.photo.applyToPreview()):(this.photodate.div.style.opacity="0",this.preview.img.style.opacity="0")}updatePreview(){for(let e=0;e<CameraApp.griditems.length;e++)CameraApp.griditems[e].update();requestAnimationFrame(e=>{CameraApp.instance.updatePreview()})}parseFile(e){return __awaiter(this,void 0,void 0,function*(){let t=e.name.startsWith("HNI_")&&e.name.endsWith(".JPG"),r=e.name.startsWith("IMG_")&&e.name.endsWith(".PNG");(t||r)&&this.photos.push(new CamPhoto(e))})}}CameraApp.griditems=[];const camera_CameraApp=CameraApp,MIME_TYPE_JAVASCRIPT="text/javascript",MIME_TYPE_WASM="application/wasm",CORE_VERSION="0.12.9",CORE_URL=null;var FFMessageType;!function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.FFPROBE="FFPROBE",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"}(FFMessageType||(FFMessageType={}));const getMessageID=(()=>{let e=0;return()=>e++})(),ERROR_UNKNOWN_MESSAGE_TYPE=new Error("unknown message type"),ERROR_NOT_LOADED=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),ERROR_TERMINATED=new Error("called FFmpeg.terminate()"),ERROR_IMPORT_FAILURE=new Error("failed to import ffmpeg-core.js");class FFmpeg{#e=null;#t={};#r={};#n=[];#a=[];loaded=!1;#i=()=>{this.#e&&(this.#e.onmessage=({data:{id:e,type:t,data:r}})=>{switch(t){case FFMessageType.LOAD:this.loaded=!0,this.#t[e](r);break;case FFMessageType.MOUNT:case FFMessageType.UNMOUNT:case FFMessageType.EXEC:case FFMessageType.FFPROBE:case FFMessageType.WRITE_FILE:case FFMessageType.READ_FILE:case FFMessageType.DELETE_FILE:case FFMessageType.RENAME:case FFMessageType.CREATE_DIR:case FFMessageType.LIST_DIR:case FFMessageType.DELETE_DIR:this.#t[e](r);break;case FFMessageType.LOG:this.#n.forEach(e=>e(r));break;case FFMessageType.PROGRESS:this.#a.forEach(e=>e(r));break;case FFMessageType.ERROR:this.#r[e](r)}delete this.#t[e],delete this.#r[e]})};#o=({type:e,data:t},r=[],n)=>this.#e?new Promise((a,i)=>{const o=getMessageID();this.#e&&this.#e.postMessage({id:o,type:e,data:t},r),this.#t[o]=a,this.#r[o]=i,n?.addEventListener("abort",()=>{i(new DOMException(`Message # ${o} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(ERROR_NOT_LOADED);on(e,t){"log"===e?this.#n.push(t):"progress"===e&&this.#a.push(t)}off(e,t){"log"===e?this.#n=this.#n.filter(e=>e!==t):"progress"===e&&(this.#a=this.#a.filter(e=>e!==t))}load=({classWorkerURL:e,...t}={},{signal:r}={})=>(this.#e||(this.#e=e?new Worker(__webpack_require__(5458)(e),{type:"module"}):new Worker(new URL(__webpack_require__.p+__webpack_require__.u(138),__webpack_require__.b),{type:"module"}),this.#i()),this.#o({type:FFMessageType.LOAD,data:t},void 0,r));exec=(e,t=-1,{signal:r}={})=>this.#o({type:FFMessageType.EXEC,data:{args:e,timeout:t}},void 0,r);ffprobe=(e,t=-1,{signal:r}={})=>this.#o({type:FFMessageType.FFPROBE,data:{args:e,timeout:t}},void 0,r);terminate=()=>{const e=Object.keys(this.#r);for(const t of e)this.#r[t](ERROR_TERMINATED),delete this.#r[t],delete this.#t[t];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(e,t,{signal:r}={})=>{const n=[];return t instanceof Uint8Array&&n.push(t.buffer),this.#o({type:FFMessageType.WRITE_FILE,data:{path:e,data:t}},n,r)};mount=(e,t,r)=>this.#o({type:FFMessageType.MOUNT,data:{fsType:e,options:t,mountPoint:r}},[]);unmount=e=>this.#o({type:FFMessageType.UNMOUNT,data:{mountPoint:e}},[]);readFile=(e,t="binary",{signal:r}={})=>this.#o({type:FFMessageType.READ_FILE,data:{path:e,encoding:t}},void 0,r);deleteFile=(e,{signal:t}={})=>this.#o({type:FFMessageType.DELETE_FILE,data:{path:e}},void 0,t);rename=(e,t,{signal:r}={})=>this.#o({type:FFMessageType.RENAME,data:{oldPath:e,newPath:t}},void 0,r);createDir=(e,{signal:t}={})=>this.#o({type:FFMessageType.CREATE_DIR,data:{path:e}},void 0,t);listDir=(e,{signal:t}={})=>this.#o({type:FFMessageType.LIST_DIR,data:{path:e}},void 0,t);deleteDir=(e,{signal:t}={})=>this.#o({type:FFMessageType.DELETE_DIR,data:{path:e}},void 0,t)}var FFFSType;!function(e){e.MEMFS="MEMFS",e.NODEFS="NODEFS",e.NODERAWFS="NODERAWFS",e.IDBFS="IDBFS",e.WORKERFS="WORKERFS",e.PROXYFS="PROXYFS"}(FFFSType||(FFFSType={}));var path_browserify=__webpack_require__(7975),path_browserify_default=__webpack_require__.n(path_browserify);class MetadataRenderer{constructor(e){this.WIDTH=256,this.HEIGHT=144,this.song=null,this.canvas=e,this.ctx=e.getContext("2d",{alpha:!1}),this.ctx.imageSmoothingEnabled=!1,this.metadatabg=document.getElementById("metadatabg")}setSong(e){this.song=e,this.draw()}draw(){this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.ctx.clearRect(0,0,this.WIDTH,this.HEIGHT),this.ctx.drawImage(this.metadatabg,0,0),this.ctx.font="16px DSIFont",this.ctx.fontKerning="none",this.ctx.textBaseline="hanging",this.ctx.fillStyle="#fff",this.ctx.fillText(this.getFolderText(),24,5),this.ctx.fillStyle="#000",this.drawText(this.getTitleText(),52,30),this.drawText(this.getArtistText(),52,54),this.drawText(this.getAlbumText(),52,78),this.ctx.fillText(this.getTrackText(),52,102),this.ctx.fillText(this.getYearText(),52,126)}drawText(e,t,r){let n=this.ctx.measureText(e);if(t+n.width>this.WIDTH){let r=(this.WIDTH-t)/n.width,a=Math.floor((e.length-1)*r),i=e.substring(0,a),o=this.ctx.measureText(""),s=-1;for(let e=0;e<5;e++)if(this.ctx.measureText(i.substring(i.length-e)).width>o.width){s=e-1;break}i=i.substring(0,i.length-s),e=i+"..."}this.ctx.fillText(e,t,r)}getFolderText(){return null!=this.song&&null!=this.song.parent&&this.song.parent!=SoundApp.root?this.song.parent.name:"/SD Card"}getTitleText(){if(null!=this.song){if(null!=this.song.meta&&null!=this.song.meta.common.title)return this.song.meta.common.title;{let e=this.song.file.name.replace(path_browserify_default().extname(this.song.file.name),"");return e.length>23?e.substring(0,23)+"...":this.song.file.name.replace(path_browserify_default().extname(this.song.file.name),"")}}return"--------"}getArtistText(){return null!=this.song&&null!=this.song.meta&&null!=this.song.meta.common.artist?this.song.meta.common.artist:"--------"}getAlbumText(){return null!=this.song&&null!=this.song.meta&&null!=this.song.meta.common.album?this.song.meta.common.album:"--------"}getTrackText(){return null!=this.song&&null!=this.song.meta&&null!=this.song.meta.common.track?"Track "+(null==this.song.meta.common.track.no?"-":this.song.meta.common.track.no)+" / "+(null==this.song.meta.common.track.of?"-":this.song.meta.common.track.of):"- / -"}getYearText(){return null!=this.song&&null!=this.song.meta&&null!=this.song.meta.common.year?this.song.meta.common.year+"":"----"}}var lib=__webpack_require__(6015),Song_awaiter=function(e,t,r,n){return new(r||(r=Promise))(function(a,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,s)}l((n=n.apply(e,t||[])).next())})};class Song{constructor(e){this.meta=null,this.file=e.file,this.handle=e.handle,this.path=e.path,this.parent=e.parent}static fromFile(e){return new Song({file:e,handle:null,parent:null,path:""})}loadMetadata(){return Song_awaiter(this,void 0,void 0,function*(){let e=null;return null!=this.handle&&(this.file=yield this.handle.getFile()),e=(0,lib.Xs)(this.file),e.then(e=>{this.meta=e}),e})}}class SongPlayer{constructor(){this.avbool=null,this.song=null,this._volume=1,this.video=document.createElement("video"),this.audio=document.createElement("audio"),this.url=null}play(e){this.song=e,this.audio.pause(),this.video.pause(),this.song.file.type.includes("audio")||""==this.song.file.type?(this.audio=document.createElement("audio"),this.audio.addEventListener("loadeddata",this.audio_play),this.audio.src=this.createURL(this.song),this.avbool=!0,this.volume=this.volume):this.song.file.type.includes("video")&&(this.video=document.createElement("video"),this.video.addEventListener("loadeddata",this.video_play),this.video.src=this.createURL(this.song),this.avbool=!1,this.volume=this.volume)}pause(){let e=this.getCurrent();null!=e&&e.pause()}currentTime(){let e=this.getCurrent();return null!=e?e.currentTime:0}duration(){let e=this.getCurrent();return null!=e?e.duration:0}set volume(e){this._volume=e;let t=this.getCurrent();null!=t&&(t.volume=this._volume)}get volume(){return this._volume}getCurrent(){return 1==this.avbool?this.audio:0==this.avbool?this.video:null}createURL(e){return this.url=URL.createObjectURL(e.file),this.url}deleteURL(){null!=this.url&&URL.revokeObjectURL(this.url)}audio_play(e){this.play().then(()=>{SoundApp.instance.waveformCanvas_renderer.initialize(this,SoundApp.instance.songPlayer.song)})}video_play(e){this.play().then(()=>{SoundApp.instance.waveformCanvas_renderer.initialize(this,SoundApp.instance.songPlayer.song)})}}class WaveformRenderer{constructor(e,t){this.audio=null,this.audioCtx=null,this.analyser=null,this.source=null,this.bufferLength=-1,this.dataArray=null,this.canvas=e,this.ctx=e.getContext("2d"),null!=t&&this.initialize(t,null),this.HEIGHT=this.canvas.height,this.WIDTH=this.canvas.width,this.ctx.imageSmoothingEnabled=!1,this.canvas.addEventListener("contextmenu",e=>{e.preventDefault()}),this.canvas.addEventListener("mouseover",e=>{SoundApp.instance.metadataCanvas_renderer.setSong(SoundApp.instance.songPlayer.song)})}initialize(e,t){this.audio=e,this.audioCtx=new AudioContext,this.analyser=this.audioCtx.createAnalyser(),this.source=this.audioCtx.createMediaElementSource(e),this.source.connect(this.analyser),this.analyser.connect(this.audioCtx.destination),this.bufferLength=512,this.dataArray=new Uint8Array(this.bufferLength)}clear(){this.ctx.clearRect(0,0,this.WIDTH,this.HEIGHT)}draw(){this.canvas.width=Math.round(window.innerWidth/8),this.canvas.style.width=Math.round(window.innerWidth/2)+"px",this.canvas.height=Math.round(this.canvas.getBoundingClientRect().height/4),this.HEIGHT=this.canvas.height,this.WIDTH=this.canvas.width,this.clear(),this.renderWaveform()}renderWaveform(){null!=this.analyser&&null!=this.dataArray&&this.analyser.getByteTimeDomainData(this.dataArray),this.drawLine("#304048",0,1),this.drawLine("#608098",0,0)}drawLine(e,t,r){if(-1!=this.bufferLength&&null!=this.dataArray){this.ctx.lineWidth=2,this.ctx.strokeStyle=e,this.ctx.beginPath();const n=this.WIDTH/this.bufferLength;let a=0,i=0;for(let e=0;e<this.bufferLength;e++){const o=this.dataArray[e]/128*Math.round(this.HEIGHT/2);0===e?this.ctx.moveTo(a+t,o+r):this.ctx.lineTo(a+t,o+r),a+=n,i=o}this.ctx.lineTo(this.WIDTH+t,i+r),this.ctx.stroke()}}}const ERROR_RESPONSE_BODY_READER=new Error("failed to get response body reader"),ERROR_INCOMPLETED_DOWNLOAD=new Error("failed to complete download"),HeaderContentLength="Content-Length",readFromBlobOrFile=e=>new Promise((t,r)=>{const n=new FileReader;n.onload=()=>{const{result:e}=n;e instanceof ArrayBuffer?t(new Uint8Array(e)):t(new Uint8Array)},n.onerror=e=>{r(Error(`File could not be read! Code=${e?.target?.error?.code||-1}`))},n.readAsArrayBuffer(e)}),fetchFile=async e=>{let t;if("string"==typeof e)t=/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?atob(e.split(",")[1]).split("").map(e=>e.charCodeAt(0)):await(await fetch(e)).arrayBuffer();else if(e instanceof URL)t=await(await fetch(e)).arrayBuffer();else{if(!(e instanceof File||e instanceof Blob))return new Uint8Array;t=await readFromBlobOrFile(e)}return new Uint8Array(t)},importScript=async e=>new Promise(t=>{const r=document.createElement("script"),n=()=>{r.removeEventListener("load",n),t()};r.src=e,r.type="text/javascript",r.addEventListener("load",n),document.getElementsByTagName("head")[0].appendChild(r)}),downloadWithProgress=async(e,t)=>{const r=await fetch(e);let n;try{const a=parseInt(r.headers.get(HeaderContentLength)||"-1"),i=r.body?.getReader();if(!i)throw ERROR_RESPONSE_BODY_READER;const o=[];let s=0;for(;;){const{done:r,value:n}=await i.read(),l=n?n.length:0;if(r){if(-1!=a&&a!==s)throw ERROR_INCOMPLETED_DOWNLOAD;t&&t({url:e,total:a,received:s,delta:l,done:r});break}o.push(n),s+=l,t&&t({url:e,total:a,received:s,delta:l,done:r})}const l=new Uint8Array(s);let c=0;for(const e of o)l.set(e,c),c+=e.length;n=l.buffer}catch(a){console.log("failed to send download progress event: ",a),n=await r.arrayBuffer(),t&&t({url:e,total:n.byteLength,received:n.byteLength,delta:0,done:!0})}return n},toBlobURL=async(e,t,r=!1,n)=>{const a=r?await downloadWithProgress(e,n):await(await fetch(e)).arrayBuffer(),i=new Blob([a],{type:t});return URL.createObjectURL(i)};class SoundPopupButton{constructor(e,t){this.button=document.createElement("button"),this.button.classList.add("soundpopup_button"),this.button.innerText=e,document.getElementById("soundpopup_buttons").appendChild(this.button),this.button.addEventListener("click",()=>{t()})}}class SoundPopup{static show(){SoundPopup.hide(),document.getElementById("soundpopupbg").style.display="inherit",document.getElementById("soundpopup").style.display="flex",document.getElementById("soundpopup_buttons").textContent=""}static hide(){document.getElementById("soundpopupbg").style.display="none",document.getElementById("soundpopup").style.display="none",document.getElementById("metadatawindow").style.display="none",document.getElementById("progresswindow").style.display="none",document.getElementById("textinputwindow").style.display="none",document.getElementById("songinputwindow").style.display="none"}static openMetadata(e){return SoundPopup.show(),this.setTitle("Edit Metadata"),document.getElementById("metadatawindow").style.display="flex",SoundPopup.metadata=new Promise((t,r)=>{let n=document.getElementById("metadata_title");null!=e.title?n.value=e.title:n.value="";let a=document.getElementById("metadata_artist");null!=e.artist?a.value=e.artist:a.value="";let i=document.getElementById("metadata_album");null!=e.album?i.value=e.album:i.value="";let o=document.getElementById("metadata_track_no"),s=document.getElementById("metadata_track_of");null!=e.track&&(null!=e.track.no?o.valueAsNumber=e.track.no:o.value="",null!=e.track.of?s.valueAsNumber=e.track.of:s.value="");let l=document.getElementById("metadata_year");null!=e.year?l.valueAsNumber=e.year:l.value="",new SoundPopupButton("Cancel",()=>{SoundPopup.hide(),r("cancelled")}),new SoundPopupButton("Next",()=>{SoundPopup.hide(),SoundPopup.openProgress(),t(SoundPopup.getMeta())})}),SoundPopup.metadata}static openSongInput(e="mp4",t,r,n){return SoundPopup.show(),this.setTitle("Upload Songs"),document.getElementById("songinputwindow").style.display="flex",new Promise((a,i)=>{new SoundPopupButton("Cancel",()=>{SoundPopup.hide(),i("cancelled")}),new SoundPopupButton("Next",()=>{SoundPopup.openProgress();let i=document.getElementById("songinput").files;null!=i&&(a(i),t(i),SoundApp.instance.convertFiles(i,e,r,n,!0))})})}static openProgress(){SoundPopup.show(),document.getElementById("soundpopup-title").innerText="Converting...",document.getElementById("progresswindow").style.display="flex"}static openTextInput(e,t,r,n,a){SoundPopup.show(),document.getElementById("textinputwindow").style.display="flex",this.setTitle(e),document.getElementById("textinput-img").src=t;let i=document.getElementById("textinput-sound");return i.placeholder=r,null!=a&&(i.value=a),new Promise((e,t)=>{new SoundPopupButton("Cancel",()=>{SoundPopup.hide(),t("cancelled")}),new SoundPopupButton(n,()=>{SoundPopup.hide(),e(i.value)})})}static setTitle(e){document.getElementById("soundpopup-title").innerText=e}static getMeta(){let e=document.getElementById("metadata_title"),t=document.getElementById("metadata_artist"),r=document.getElementById("metadata_album"),n=document.getElementById("metadata_track_no"),a=document.getElementById("metadata_track_of"),i=document.getElementById("metadata_year"),o=!Number.isNaN(n.valueAsNumber)&&""!=n.value,s=!Number.isNaN(a.valueAsNumber)&&""!=a.value;return{title:""!=e.value?e.value:void 0,artist:""!=t.value?t.value:void 0,album:""!=r.value?r.value:void 0,track:o||s?{no:o?n.valueAsNumber:void 0,of:s?a.valueAsNumber:void 0}:void 0,year:Number.isNaN(i.valueAsNumber)||""==i.value?void 0:i.valueAsNumber}}}class UniFont{static make(e,t){let r=e;return e.split("").forEach((e,n)=>{if(UniFont.NORMAL.includes(e)){let n=UniFont.NORMAL.indexOf(e);t.length>n&&(r=r.replace(e,t[n]))}}),r}}UniFont.NORMAL=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+"),UniFont.BOLD=Array.from(""),UniFont.SMALL_CAPS=Array.from("qsxqsx0123456789@#^+"),UniFont.ITALIC=Array.from(""),UniFont.ITALIC_BOLD=Array.from(""),UniFont.SUPERSCRIPT=Array.from("@#^+");const context_UniFont=UniFont;class CustomContextMenuHandler{constructor(e=0,t=0){this.ctxItemMap=new Map,this.isOpen=!1,this.contextOptions=[],this.x=e,this.y=t,this.ctxMenu=document.getElementById("ctxmenu"),this.ctxMenuItems=document.getElementById("ctxbox"),this.ctxMenu.addEventListener("blur",()=>{this.close()}),this.ctxMenuItems.addEventListener("blur",()=>{this.close()})}clear(){this.ctxItemMap.clear(),this.ctxMenuItems.remove(),this.ctxMenuItems=document.createElement("div"),this.ctxMenuItems.id="ctxbox",this.ctxMenu.appendChild(this.ctxMenuItems)}close(){requestAnimationFrame(()=>{this.isOpen=!1,this.clear(),this.ctxMenu.style.display="none",this.ctxMenuItems.style.display="none"})}show(e,t,r){requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.isOpen=!0,this.ctxMenu.style.display="";let n=0,a=0;null!=t&&null!=r&&(n=t,a=r,this.x=n,this.y=a),this.ctxMenu.style.left=this.x-15+"px",this.ctxMenu.style.top=this.y+"px",this.clear(),e.forEach(e=>{this.add(e,this.x,this.y)}),this.add({text:"Close",font:context_UniFont.BOLD,onselect:()=>{this.close()}},this.x,this.y)})})}add(e,t,r){let n=e.text;null!=e.hasSecondary&&e.hasSecondary&&(n=""+n),null==e.onselect&&(e.onselect=()=>{}),null!=e.title&&e.title&&(e.onselect=()=>{this.show(this.contextOptions,t,r)}),this.ctxItemMap.set(n,e.onselect);let a=document.createElement("div");a.addEventListener("mouseup",t=>{null!=e.onselect&&(e.onselect(),null!=e.hasSecondary&&1==e.hasSecondary||this.close())}),a.addEventListener("touchend",t=>{null!=e.onselect&&(e.onselect(),null!=e.hasSecondary&&1==e.hasSecondary||this.close())}),a.setAttribute("class","ctxitem"),null!=e.desc&&a.setAttribute("title",e.desc),e.font==context_UniFont.BOLD?a.innerHTML="<b>"+n+"</b>":e.font==context_UniFont.ITALIC?a.innerHTML="<i>"+n+"</i>":null!=e.font?(n=context_UniFont.make(n,e.font),a.innerText=n):a.innerText=n,this.ctxMenuItems.appendChild(a)}}class Navbar{constructor(){this.edit=document.getElementById("navbar_edit"),this.edit.addEventListener("click",()=>{null!=SoundApp.instance.songPlayer.song&&SoundApp.instance.contextMenu.show([{text:"Metadata...",onselect:()=>{SoundApp.instance.editCurrentSongMeta()}}],this.edit.getBoundingClientRect().x+10,this.edit.getBoundingClientRect().y+this.edit.getBoundingClientRect().height)})}}class ListItem{constructor(){this.div=document.createElement("div"),this.div.classList.add("listitem"),this.icondiv=document.createElement("div"),this.icondiv.classList.add("listitem_icondiv"),this.div.appendChild(this.icondiv),this.icon=document.createElement("img"),this.icon.classList.add("listitem_icon"),this.icon.src="assets/textures/sound/music.png",this.text=document.createElement("div"),this.text.innerText="Loading song data...",this.text.classList.add("listitem_text"),this.div.appendChild(this.text),this.icondiv.appendChild(this.icon)}}var AddFolderListItem_awaiter=function(e,t,r,n){return new(r||(r=Promise))(function(a,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,s)}l((n=n.apply(e,t||[])).next())})};class AddFolderListItem extends ListItem{constructor(){super(),this.icon.src="assets/textures/sound/custom/add.png",this.text.innerText="Add Folder...",this.div.addEventListener("click",e=>AddFolderListItem_awaiter(this,void 0,void 0,function*(){let e=yield SoundPopup.openTextInput("Create Folder","assets/textures/sound/folder.png","New Folder","Create"),t=yield SoundApp.musicDir.getDirectoryHandle(e,{create:!0});SoundApp.instance.parents.push(t),SoundApp.instance.sortParents(),SoundApp.instance.list.loadFolders()}))}}var AddSongListItem_awaiter=function(e,t,r,n){return new(r||(r=Promise))(function(a,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,s)}l((n=n.apply(e,t||[])).next())})};class AddSongListItem extends ListItem{constructor(e="mp4"){super(),this.icon.src="assets/textures/sound/custom/add.png",this.text.innerText=`Add Song as ${e}...`,this.div.addEventListener("click",t=>AddSongListItem_awaiter(this,void 0,void 0,function*(){let t=[],r=0,n=0;SoundPopup.openSongInput(e,a=>AddSongListItem_awaiter(this,void 0,void 0,function*(){let i=SoundApp.instance.list.parent;if(null!=i){n=a.length;for(let r=0;r<a.length;r++){const n=a[r];t.push(yield i.getFileHandle(n.name.replace(path_browserify_default().extname(n.name),"")+"."+e,{create:!0}))}}SoundPopup.setTitle(`Converting... ${r}/${n}`),SoundPopup.openProgress()}),(e,a)=>AddSongListItem_awaiter(this,void 0,void 0,function*(){for(let i=0;i<t.length;i++){const o=t[i];if(a.name.replace(path_browserify_default().extname(a.name),"")!=o.name.replace(path_browserify_default().extname(o.name),""))continue;let s=yield o.createWritable();yield s.write(e.buffer),yield s.close(),r++,SoundPopup.setTitle(`Converting... ${r}/${n}`);break}}),()=>AddSongListItem_awaiter(this,void 0,void 0,function*(){SoundPopup.hide(),yield SoundApp.instance.getAllFiles(SoundApp.root),SoundApp.instance.list.loadFolders()}))}))}}class BackListItem extends ListItem{constructor(){super(),this.icon.src="assets/textures/sound/album.png",this.text.innerText="Back",this.div.addEventListener("click",e=>{SoundApp.instance.list.loadFolders()})}}class FolderListItem extends ListItem{constructor(e){super(),this.folder=e,this.icon.src="assets/textures/sound/folder.png",this.folder==SoundApp.root?this.text.innerText="/SD Card":this.text.innerText=e.name,this.div.addEventListener("click",t=>{SoundApp.instance.list.loadSongs(e)}),this.folder!=SoundApp.root&&this.div.addEventListener("contextmenu",e=>{e.preventDefault(),SoundApp.instance.contextMenu.show([{text:"Delete",onselect:()=>{confirm('Are you sure you want to delete "'+this.folder.name+'"? All songs inside this folder will also be removed.')&&(this.folder.remove({recursive:!0}),SoundApp.instance.parents.splice(SoundApp.instance.parents.indexOf(this.folder),1),SoundApp.instance.sortParents(),this.div.remove(),SoundApp.instance.list.loadFolders())}}],this.div.getBoundingClientRect().x,this.div.getBoundingClientRect().y)})}}var SongListItem_awaiter=function(e,t,r,n){return new(r||(r=Promise))(function(a,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,s)}l((n=n.apply(e,t||[])).next())})};class SongListItem extends ListItem{constructor(e){super(),this.song=e,this.loadMeta(),this.div.addEventListener("mouseover",e=>{SoundApp.instance.metadataCanvas_renderer.setSong(this.song)}),this.div.addEventListener("click",e=>{console.log("trying to play song"),SoundApp.instance.songPlayer.play(this.song)}),this.div.addEventListener("contextmenu",e=>{e.preventDefault(),null!=this.song.handle&&SoundApp.instance.contextMenu.show([{text:"Delete",onselect:()=>SongListItem_awaiter(this,void 0,void 0,function*(){confirm('Are you sure you want to delete "'+this.song.file.name+'"? This song will be permanently removed.')&&(this.song.handle.remove(),SoundApp.instance.songs.splice(SoundApp.instance.songs.indexOf(this.song),1),this.div.remove(),yield SoundApp.instance.getAllFiles(SoundApp.root),null!=this.song.parent&&SoundApp.instance.list.loadSongs(this.song.parent))})}],this.div.getBoundingClientRect().x,this.div.getBoundingClientRect().y)})}loadMeta(){return SongListItem_awaiter(this,void 0,void 0,function*(){yield this.song.loadMetadata(),null!=this.song.meta&&null!=this.song.meta.common.title?this.text.innerText=this.song.meta.common.title:this.text.innerText=this.song.file.name.replace(path_browserify_default().extname(this.song.file.name),"")})}}class ListManager{constructor(){this.displayingItems=[],this.parent=null,this.listDiv=document.getElementById("songlist"),this.listDiv.addEventListener("contextmenu",e=>{this.listDiv.matches(":hover")&&e.preventDefault()})}addItem(e){this.displayingItems.push(e)}loadSongs(e){this.parent=e,this.clear(),this.addItem(new BackListItem);let t=[];SoundApp.instance.songs.filter(t=>t.parent==e).forEach(e=>t.push(e)),t.sort((e,t)=>e.path.localeCompare(t.path)),t.sort((e,t)=>null!=e.meta&&null!=t.meta&&null!=e.meta.common.album&&null!=t.meta.common.album?e.meta.common.album.localeCompare(t.meta.common.album):e.path.localeCompare(t.path)),t.sort((e,t)=>null!=e.meta&&null!=t.meta&&null!=e.meta.common.track.no&&null!=t.meta.common.track.no?e.meta.common.track.no-t.meta.common.track.no:0),t.forEach(e=>{this.addItem(new SongListItem(e))}),this.parent!==SoundApp.root&&(this.addItem(new AddSongListItem),this.addItem(new AddSongListItem("m4a"))),this.generate()}loadFolders(){this.parent=null,this.clear(),this.addItem(new FolderListItem(SoundApp.root)),SoundApp.instance.parents.forEach(e=>{this.addItem(new FolderListItem(e))}),this.addItem(new AddFolderListItem),this.generate()}clear(){this.listDiv.textContent="",this.displayingItems=[]}generate(){requestAnimationFrame(()=>{this.displayingItems.forEach(e=>{this.listDiv.appendChild(e.div)})})}}var SoundApp_awaiter=function(e,t,r,n){return new(r||(r=Promise))(function(a,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,s)}l((n=n.apply(e,t||[])).next())})},SoundApp_asyncValues=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,a){!function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)}(n,a,(t=e[r](t)).done,t.value)})}}},SoundApp_await=function(e){return this instanceof SoundApp_await?(this.v=e,this):new SoundApp_await(e)},SoundApp_asyncDelegator=function(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,a){t[n]=e[n]?function(t){return(r=!r)?{value:SoundApp_await(e[n](t)),done:!1}:a?a(t):t}:a}},SoundApp_asyncGenerator=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(e,t||[]),i=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),n[Symbol.asyncIterator]=function(){return this},n;function o(e,t){a[e]&&(n[e]=function(t){return new Promise(function(r,n){i.push([e,t,r,n])>1||s(e,t)})},t&&(n[e]=t(n[e])))}function s(e,t){try{(r=a[e](t)).value instanceof SoundApp_await?Promise.resolve(r.value.v).then(l,c):u(i[0][2],r)}catch(e){u(i[0][3],e)}var r}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}};class SoundApp{constructor(){this.folders=[],this.songs=[],this.parents=[],this.loadedSongs=!1,this.lastTimestep=0,this.elapsed=0,SoundApp.instance=this,this.ffmpeg=new FFmpeg,this.songPlayer=new SongPlayer,this.navbar=new Navbar,this.contextMenu=new CustomContextMenuHandler,this.list=new ListManager,this.startupAudio=document.getElementById("startupaudio"),this.startupAudio.volume=1,this.startupAudio.play(),this.waveformCanvas=document.getElementById("waveform"),this.waveformCanvas_renderer=new WaveformRenderer(this.waveformCanvas,this.startupAudio),this.metadataCanvas=document.getElementById("metadatacanvas"),this.metadataCanvas_renderer=new MetadataRenderer(this.metadataCanvas),this.sdcardbutton=new DSIMenuButton(document.getElementById("sdcardbutton-sound"),()=>{"showDirectoryPicker"in window&&window.showDirectoryPicker().then(e=>SoundApp_awaiter(this,void 0,void 0,function*(){try{yield this.getAllFiles(e)}catch(e){console.error(e),alert("Please ensure you are picking the root of your SD Card and not any folders inside of it."),this.sdcardbutton.selected=!1}})).catch(()=>{this.sdcardbutton.selected=!1})}),document.getElementById("soundscreen").style.display="inherit",document.body.style.backgroundImage='url("looping_sound.png")',document.body.style.backgroundSize="50vw auto",requestAnimationFrame(e=>{SoundApp.instance.draw(e),this.metadataCanvas_renderer.draw()}),this.loadFFmpeg()}loadFFmpeg(){return SoundApp_awaiter(this,void 0,void 0,function*(){const e="assets/ffmpeg";this.ffmpeg.on("log",({message:e})=>{console.info(e)}),yield this.ffmpeg.load({coreURL:yield toBlobURL(`${e}/ffmpeg-core.js`,"text/javascript"),wasmURL:yield toBlobURL(`${e}/ffmpeg-core.wasm`,"application/wasm")}),yield this.ffmpeg.exec(["-sample_fmts"]),this.ffmpeg.on("progress",e=>{this.onFFmpegProgress(e.progress,e.time)}),console.log("FFMPEG LOADED")})}onFFmpegProgress(e,t){console.log(`progress: ${e}, time: ${t}`),document.getElementById("conversionprogress").value=1e3*e}uploadAndConvertFileToMp4(){return SoundApp_awaiter(this,void 0,void 0,function*(){yield this.uploadAndConvertFile("mp4")})}uploadAndConvertFileToM4a(){return SoundApp_awaiter(this,void 0,void 0,function*(){yield this.uploadAndConvertFile("m4a")})}uploadAndConvertFileTo3gp(){return SoundApp_awaiter(this,void 0,void 0,function*(){yield this.uploadAndConvertFile("3gp")})}uploadAndConvertFile(){return SoundApp_awaiter(this,arguments,void 0,function*(e="mp4"){let t=yield window.showOpenFilePicker(),r=[];for(let e=0;e<t.length;e++){const n=t[e];let a=yield n.getFile();r.push(a)}yield this.convertFiles(r,e,(t,r)=>SoundApp_awaiter(this,void 0,void 0,function*(){let n=document.createElement("a");n.download=r.name.replace(path_browserify_default().extname(r.name),"")+"."+e,n.href=URL.createObjectURL(new Blob([t.buffer])),n.click()}),()=>{SoundPopup.hide()})})}convertFiles(e){return SoundApp_awaiter(this,arguments,void 0,function*(e,t="mp4",r,n,a=!1){for(let n=0;n<e.length;n++){const i=e[n];let o="input"+path_browserify_default().extname(i.name);const s=new Uint8Array(yield i.arrayBuffer());yield this.ffmpeg.writeFile(o,s);let l=["-i",o,"-acodec","aac","-vn"];try{a?l.push("-map_metadata","0"):this.buildMetadata(yield SoundPopup.openMetadata(yield this.getMetaFromFile(i))).forEach(e=>{l.push("-metadata"),l.push(e)}),l.push("output."+t),yield this.ffmpeg.exec(l);let e=yield this.ffmpeg.readFile("output."+t);e instanceof Uint8Array&&r(e,i)}catch(e){}}n()})}editCurrentSongMeta(){return SoundApp_awaiter(this,void 0,void 0,function*(){if(null!=this.songPlayer.song){let e=this.songPlayer.song,t=this.songPlayer.song.file,r=path_browserify_default().extname(t.name),n="input"+r;if(null!=e.meta&&null!=e.handle){let a={album:e.meta.common.album,artist:e.meta.common.artist,title:e.meta.common.title,track:{no:e.meta.common.track.no,of:e.meta.common.track.of},year:e.meta.common.year};const i=new Uint8Array(yield t.arrayBuffer());yield this.ffmpeg.writeFile(n,i);let o=this.buildMetadata(yield SoundPopup.openMetadata(a)),s=["-i",n];o.forEach(e=>{s.push("-metadata"),s.push(e)}),s.push("-codec","copy","output"+r),yield this.ffmpeg.exec(s),SoundPopup.openProgress();let l=yield this.ffmpeg.readFile("output"+r);if(l instanceof Uint8Array){let t=yield e.handle.createWritable();yield t.write(l.buffer),yield t.close(),SoundPopup.hide()}}}})}getMetaFromFile(e){return SoundApp_awaiter(this,void 0,void 0,function*(){return new Promise((t,r)=>SoundApp_awaiter(this,void 0,void 0,function*(){let r=Song.fromFile(e);if(yield r.loadMetadata(),null!=r.meta){let e={album:r.meta.common.album,artist:r.meta.common.artist,title:r.meta.common.title,track:{no:r.meta.common.track.no,of:r.meta.common.track.of},year:r.meta.common.year};t(e)}else t({})}))})}buildMetadata(e){let t=[];if(null!=e.title&&t.push(`title=${e.title}`),null!=e.artist&&t.push(`artist=${e.artist}`,`author=${e.artist}`,`album_artist=${e.artist}`,`composer=${e.artist}`),null!=e.album&&t.push(`album=${e.album}`),null!=e.track){let r="";null!=e.track.no&&(r+=`${e.track.no}`,null!=e.track.of&&(r+=`/${e.track.of}`)),""!=r&&t.push(`track=${r}`)}return null!=e.year&&t.push(`date=${e.year}`),t}getAllFiles(e){return SoundApp_awaiter(this,void 0,void 0,function*(){var t,r,n,a;SoundApp.root=e,SoundApp.musicDir=yield SoundApp.root.getDirectoryHandle("Music",{create:!0});let i=[];try{for(var o,s=!0,l=SoundApp_asyncValues(this.getFilesRecursively(SoundApp.root,null,null));!(t=(o=yield l.next()).done);s=!0){a=o.value,s=!1;const e=a;null!=e&&(e.file.name.endsWith(".mp4")||e.file.name.endsWith(".m4a")||e.file.name.endsWith(".3gp"))&&i.push(e)}}catch(e){r={error:e}}finally{try{s||t||!(n=l.return)||(yield n.call(l))}finally{if(r)throw r.error}}this.loadSongList(i)})}getFilesRecursively(e,t,r){return SoundApp_asyncGenerator(this,arguments,function*(){var n,a,i,o;if(e instanceof FileSystemFileHandle){null==t?t="":t+=e.name;const n=yield SoundApp_await(e.getFile());null!==n&&(yield yield SoundApp_await({handle:e,file:n,path:t,parent:r}))}else if(e instanceof FileSystemDirectoryHandle){null==t?t="":t+=e.name+"/";try{for(var s,l=!0,c=SoundApp_asyncValues(e.values());!(n=(s=yield SoundApp_await(c.next())).done);l=!0){o=s.value,l=!1;const r=o;yield SoundApp_await(yield*SoundApp_asyncDelegator(SoundApp_asyncValues(this.getFilesRecursively(r,t,e))))}}catch(e){a={error:e}}finally{try{l||n||!(i=c.return)||(yield SoundApp_await(i.call(c)))}finally{if(a)throw a.error}}}})}loadSongList(e){return SoundApp_awaiter(this,void 0,void 0,function*(){this.folders=[],this.songs=[],this.parents=[];let t=document.getElementById("sdcardscreen-sound");null!=t&&(t.style.display="none");let r=document.getElementById("sdcardscreen-sound");null!=r&&(r.style.display="none");let n=document.getElementById("selectsdcard-sound");null!=n&&(n.style.display="none");for(let t=0;t<e.length;t++){let r=new Song(e[t]);null==r.parent||r.parent==SoundApp.root||this.parents.includes(r.parent)||this.parents.push(r.parent),this.songs.push(r)}this.sortParents(),this.loadedSongs=!0,this.list.loadFolders()})}sortParents(){this.parents.sort((e,t)=>e.name.localeCompare(t.name))}draw(e){this.elapsed=e-this.lastTimestep,this.lastTimestep=e,this.waveformCanvas_renderer.draw(),requestAnimationFrame(e=>{SoundApp.instance.draw(e)})}}class DSIUtil{constructor(){this.camera=null,this.sound=null,DSIUtil.instance=this,this.dsicamerabutton=new DSIMenuButton(document.getElementById("dsicamerabutton"),()=>{this.hideMenu(),this.camera=new camera_CameraApp}),this.dsisoundbutton=new DSIMenuButton(document.getElementById("dsisoundbutton"),()=>{"chrome"in window?(this.hideMenu(),this.sound=new SoundApp):alert("Sorry, DSi Sound file uploading only works with Chromium browsers. (e.g Google Chrome, Microsoft Edge). \n This is a limitation of the browsers engine you are using and cannot be fixed for your browser.")})}hideMenu(){document.getElementById("menuscreen").style.display="none",document.getElementById("menufooter").style.display="none"}}let app=new DSIUtil;