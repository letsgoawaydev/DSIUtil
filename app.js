class e{constructor(e,t){this.div=e,this.div.addEventListener("click",()=>{t()})}set selected(e){e?this.div.classList.contains("dsimenubutton_selected")||this.div.classList.add("dsimenubutton_selected"):this.div.classList.remove("dsimenubutton_selected")}get selected(){return this.div.classList.contains("dsimenubutton_selected")}}class t{constructor(e,t){this.div=e,this.div.addEventListener("click",()=>{t()})}set selected(e){e?this.div.classList.contains("cambutton_selected")||this.div.classList.add("cambutton_selected"):this.div.classList.remove("cambutton_selected")}get selected(){return this.div.classList.contains("cambutton_selected")}}class i{constructor(e){this.photo=e,this.url=null}revokeURL(){null!=this.url&&(URL.revokeObjectURL(this.url),this.url=null)}createURL(){return this.revokeURL(),URL.createObjectURL(this.photo)}applyToPreview(){m.instance.preview.applyPhoto(this),m.instance.photodate.setDate(new Date(this.photo.lastModified))}}class s{constructor(e){this.id=m.griditems.length,console.log(this.id),this.div=e,this.div.addEventListener("click",e=>{m.instance.setGridItem(this.id)}),this.x=0,this.y=0}update(){this.x=window.innerWidth/2-s.GRID_WIDTH/2,this.x+=-160*(m.instance.currentGridItemSelected-this.id);let e=(this.div.getBoundingClientRect().x+s.GRID_WIDTH/2)/window.innerWidth;e>.5&&(e=1-e),this.y=48*e,-200>this.x+s.GRID_WIDTH||this.x>window.innerWidth+200?this.offscreenStyle():this.onscreenStyle()}offscreenStyle(){this.div.style.display="none"}onscreenStyle(){this.div.style.display="inherit",m.instance.currentGridItemSelected==this.id?(this.div.style.border="8px ridge #ff9230",this.div.style.outline="2px solid white",this.div.style.borderRadius="8px"):(this.div.style.border="",this.div.style.outline="",this.div.style.borderRadius=""),this.div.style.left=`${this.x}px`,this.div.style.top=`${this.y}px`}}s.GRID_WIDTH=128,s.GRID_HEIGHT=128;const n=s;class r extends n{constructor(e){let t=document.createElement("div");t.classList.add("griditem","infogriditem");let i=document.createElement("div");i.classList.add("datearrow"),i.innerText="ðŸ¡†",t.appendChild(i);let s=document.createElement("div");s.classList.add("datemonthday"),s.innerText=e.getDate()+"/"+e.getMonth(),t.appendChild(s);let n=document.createElement("div");n.classList.add("dateyear"),n.innerText=e.getFullYear()+"",t.appendChild(n),document.getElementById("gallery").appendChild(t),super(t)}}class o extends n{constructor(e){let t=document.createElement("div");t.classList.add("griditem","griditemphoto"),super(t),this.photo=e,document.getElementById("gallery").appendChild(t)}offscreenStyle(){super.offscreenStyle(),this.div.style.backgroundImage="",this.photo.revokeURL()}onscreenStyle(){super.onscreenStyle(),null==this.photo.url&&(this.photo.url=this.photo.createURL()),this.div.style.backgroundImage=`url(${this.photo.url})`}}class l{constructor(e){this.div=e}setDate(e){this.div.innerText=e.toLocaleString()}}class d{constructor(e){this.img=e}applyPhoto(e){null==e.url&&(e.url=e.createURL()),this.img.src=e.url}}var c=function(e,t,i,s){return new(i||(i=Promise))(function(n,r){function o(e){try{d(s.next(e))}catch(e){r(e)}}function l(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(o,l)}d((s=s.apply(e,t||[])).next())})},a=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(i){t[i]=e[i]&&function(t){return new Promise(function(s,n){!function(e,t,i,s){Promise.resolve(s).then(function(t){e({value:t,done:i})},t)}(s,n,(t=e[i](t)).done,t.value)})}}},h=function(e){return this instanceof h?(this.v=e,this):new h(e)},u=function(e){var t,i;return t={},s("next"),s("throw",function(e){throw e}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(s,n){t[s]=e[s]?function(t){return(i=!i)?{value:h(e[s](t)),done:!1}:n?n(t):t}:n}};class y{constructor(){this.currentGridItemSelected=-1,this.photos=[],y.instance=this,"chrome"in window||alert("Hi, please note that non chromium browsers aren't fully supported, so you may experience issues"),document.getElementById("camerafooter").style.display="inherit",document.getElementById("sdcardscreen-camera").style.display="inherit",document.getElementById("sdcardscreen-camera").style.display="inherit",document.body.style.backgroundImage='url("looping.png")',this.dirselect=document.getElementById("dirselect"),this.preview=new d(document.getElementById("preview")),this.photodate=new l(document.getElementById("photodate")),this.galleryslider=document.getElementById("galleryslider"),this.sdcardbutton=new t(document.getElementById("sdcardbutton"),()=>{this.sdcardbutton.selected=!0,this.filePick()})}filePick(){"showDirectoryPicker"in window?window.showDirectoryPicker().then(e=>c(this,void 0,void 0,function*(){try{yield this.getAllFiles(e)}catch(e){alert("Please ensure you are picking the root of your SD Card and not any folders inside of it."),this.sdcardbutton.selected=!1}})).catch(()=>{this.sdcardbutton.selected=!1}):(this.dirselect.click(),this.dirselect.addEventListener("cancel",e=>{this.sdcardbutton.selected=!1}),this.dirselect.addEventListener("change",()=>{null!=this.dirselect.files&&this.loadPreviewMenu(this.dirselect.files)}))}getAllFiles(e){return c(this,void 0,void 0,function*(){var t,i,s,n;let r,o=[];r=yield e.getDirectoryHandle("DCIM");try{for(var l,d=!0,c=a(this.getFilesRecursively(r));!(t=(l=yield c.next()).done);d=!0){n=l.value,d=!1;const e=n;o.push(e)}}catch(e){i={error:e}}finally{try{d||t||!(s=c.return)||(yield s.call(c))}finally{if(i)throw i.error}}this.loadPreviewMenu(o)})}getFilesRecursively(e){return function(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,n=i.apply(e,t||[]),r=[];return s=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),s[Symbol.asyncIterator]=function(){return this},s;function o(e,t){n[e]&&(s[e]=function(t){return new Promise(function(i,s){r.push([e,t,i,s])>1||l(e,t)})},t&&(s[e]=t(s[e])))}function l(e,t){try{(i=n[e](t)).value instanceof h?Promise.resolve(i.value.v).then(d,c):a(r[0][2],i)}catch(e){a(r[0][3],e)}var i}function d(e){l("next",e)}function c(e){l("throw",e)}function a(e,t){e(t),r.shift(),r.length&&l(r[0][0],r[0][1])}}(this,arguments,function*(){var t,i,s,n;if(e instanceof FileSystemFileHandle){const t=yield h(e.getFile());null!==t&&(yield yield h(t))}else if(e instanceof FileSystemDirectoryHandle)try{for(var r,o=!0,l=a(e.values());!(t=(r=yield h(l.next())).done);o=!0){n=r.value,o=!1;const e=n;yield h(yield*u(a(this.getFilesRecursively(e))))}}catch(e){i={error:e}}finally{try{o||t||!(s=l.return)||(yield h(s.call(l)))}finally{if(i)throw i.error}}})}loadPreviewMenu(e){for(let t=0;t<e.length;t++){const i=e[t];null!=i&&this.parseFile(i)}if(0==this.photos.length)return this.sdcardbutton.selected=!1,void alert("No photos were found.");document.getElementById("sdcardscreen-camera").style.display="none",document.getElementById("albumscreen").style.display="flex",document.getElementById("camerafooter").style.display="none",document.body.style.backgroundImage='url("looping_album.png")',this.photos.sort((e,t)=>e.photo.lastModified-t.photo.lastModified),document.getElementById("photoscount").innerText=""+this.photos.length;for(let e=0;e<this.photos.length;e++){let t=this.photos[e];if(0!=e){let i=this.photos[e-1],s=new Date(t.photo.lastModified);new Date(i.photo.lastModified).getDay()!=s.getDay()&&y.griditems.push(new r(s))}else y.griditems.push(new r(new Date(t.photo.lastModified)));y.griditems.push(new o(t))}y.griditems.push(new n(document.getElementById("totalphotos"))),this.setGridItem(y.griditems.length-1),this.galleryslider.max=""+(y.griditems.length-1),this.galleryslider.addEventListener("input",e=>{this.setGridItem(this.galleryslider.valueAsNumber)}),requestAnimationFrame(y.instance.updatePreview)}setGridItem(e){this.currentGridItemSelected=e,this.galleryslider.valueAsNumber=this.currentGridItemSelected;let t=y.griditems[e];t instanceof o?(this.preview.img.style.opacity="1",this.photodate.div.style.opacity="1",t.photo.applyToPreview()):(this.photodate.div.style.opacity="0",this.preview.img.style.opacity="0")}updatePreview(){for(let e=0;e<y.griditems.length;e++)y.griditems[e].update();requestAnimationFrame(e=>{y.instance.updatePreview()})}parseFile(e){return c(this,void 0,void 0,function*(){let t=e.name.startsWith("HNI_")&&e.name.endsWith(".JPG"),s=e.name.startsWith("IMG_")&&e.name.endsWith(".PNG");(t||s)&&this.photos.push(new i(e))})}}y.griditems=[];const m=y;class p{constructor(){this.camera=null,this.sound=null,p.instance=this,this.dsicamerabutton=new e(document.getElementById("dsicamerabutton"),()=>{this.hideMenu(),this.camera=new m}),this.dsisoundbutton=new e(document.getElementById("dsisoundbutton"),()=>{})}hideMenu(){document.getElementById("menuscreen").style.display="none",document.getElementById("menufooter").style.display="none"}}new p;